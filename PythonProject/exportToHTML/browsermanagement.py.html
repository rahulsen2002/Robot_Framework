<html>
<head>
<title>browsermanagement.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
browsermanagement.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright 2008-2011 Nokia Networks</span>
<span class="s0"># Copyright 2011-2016 Ryan Tomac, Ed Manlove and contributors</span>
<span class="s0"># Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0"># you may not use this file except in compliance with the License.</span>
<span class="s0"># You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0"># Unless required by applicable law or agreed to in writing, software</span>
<span class="s0"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0"># See the License for the specific language governing permissions and</span>
<span class="s0"># limitations under the License.</span>

<span class="s2">import </span><span class="s1">time</span>
<span class="s2">import </span><span class="s1">types</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">timedelta</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Optional</span><span class="s3">, </span><span class="s1">Union</span><span class="s3">, </span><span class="s1">Any</span><span class="s3">, </span><span class="s1">List</span>

<span class="s2">from </span><span class="s1">selenium </span><span class="s2">import </span><span class="s1">webdriver</span>
<span class="s2">from </span><span class="s1">selenium</span><span class="s3">.</span><span class="s1">webdriver </span><span class="s2">import </span><span class="s1">FirefoxProfile</span>
<span class="s2">from </span><span class="s1">selenium</span><span class="s3">.</span><span class="s1">webdriver</span><span class="s3">.</span><span class="s1">support</span><span class="s3">.</span><span class="s1">event_firing_webdriver </span><span class="s2">import </span><span class="s1">EventFiringWebDriver</span>

<span class="s2">from </span><span class="s1">SeleniumLibrary</span><span class="s3">.</span><span class="s1">base </span><span class="s2">import </span><span class="s1">keyword</span><span class="s3">, </span><span class="s1">LibraryComponent</span>
<span class="s2">from </span><span class="s1">SeleniumLibrary</span><span class="s3">.</span><span class="s1">locators </span><span class="s2">import </span><span class="s1">WindowManager</span>
<span class="s2">from </span><span class="s1">SeleniumLibrary</span><span class="s3">.</span><span class="s1">utils </span><span class="s2">import </span><span class="s1">timestr_to_secs</span><span class="s3">, </span><span class="s1">secs_to_timestr</span><span class="s3">, </span><span class="s1">_convert_timeout</span><span class="s3">, </span><span class="s1">_convert_delay</span>

<span class="s2">from </span><span class="s3">.</span><span class="s1">webdrivertools </span><span class="s2">import </span><span class="s1">WebDriverCreator</span>


<span class="s2">class </span><span class="s1">BrowserManagementKeywords</span><span class="s3">(</span><span class="s1">LibraryComponent</span><span class="s3">):</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">ctx</span><span class="s3">):</span>
        <span class="s1">LibraryComponent</span><span class="s3">.</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">ctx</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_window_manager </span><span class="s3">= </span><span class="s1">WindowManager</span><span class="s3">(</span><span class="s1">ctx</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_webdriver_creator </span><span class="s3">= </span><span class="s1">WebDriverCreator</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">log_dir</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">close_all_browsers</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Closes all open browsers and resets the browser cache. 
 
        After this keyword, new indexes returned from `Open Browser` keyword 
        are reset to 1. 
 
        This keyword should be used in test or suite teardown to make sure 
        all browsers are closed. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s5">&quot;Closing all browsers.&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">close_all</span><span class="s3">()</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">close_browser</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Closes the current browser.&quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">current</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s5">f&quot;Closing browser with session id </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">session_id</span><span class="s2">}</span><span class="s5">.&quot;</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">close</span><span class="s3">()</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">open_browser</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">url</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">browser</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s5">&quot;firefox&quot;</span><span class="s3">,</span>
        <span class="s1">alias</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">remote_url</span><span class="s3">: </span><span class="s1">Union</span><span class="s3">[</span><span class="s1">bool</span><span class="s3">, </span><span class="s1">str</span><span class="s3">] = </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">desired_capabilities</span><span class="s3">: </span><span class="s1">Union</span><span class="s3">[</span><span class="s1">dict</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">ff_profile_dir</span><span class="s3">: </span><span class="s1">Union</span><span class="s3">[</span><span class="s1">FirefoxProfile</span><span class="s3">, </span><span class="s1">str</span><span class="s3">, </span><span class="s2">None</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">options</span><span class="s3">: </span><span class="s1">Any </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">service_log_path</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">executable_path</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">service</span><span class="s3">: </span><span class="s1">Any </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Opens a new browser instance to the optional ``url``. 
 
        The ``browser`` argument specifies which browser to use. The 
        supported browsers are listed in the table below. The browser names 
        are case-insensitive and some browsers have multiple supported names. 
 
        |    = Browser =    |        = Name(s) =       | 
        | Firefox           | firefox, ff              | 
        | Google Chrome     | googlechrome, chrome, gc | 
        | Headless Firefox  | headlessfirefox          | 
        | Headless Chrome   | headlesschrome           | 
        | Internet Explorer | internetexplorer, ie     | 
        | Edge              | edge                     | 
        | Safari            | safari                   | 
 
        To be able to actually use one of these browsers, you need to have 
        a matching Selenium browser driver available. See the 
        [https://github.com/robotframework/SeleniumLibrary#browser-drivers| 
        project documentation] for more details. 
 
        After opening the browser, it is possible to use optional 
        ``url`` to navigate the browser to the desired address. 
 
        Examples: 
        | `Open Browser` | http://example.com | Chrome  |                                         | 
        | `Open Browser` | http://example.com | Firefox | alias=Firefox                           | 
        | `Open Browser` | http://example.com | Edge    | remote_url=http://127.0.0.1:4444/wd/hub | 
        | `Open Browser` | about:blank        |         |                                         | 
        | `Open Browser` | browser=Chrome     |         |                                         | 
 
        Optional ``alias`` is an alias given for this browser instance and 
        it can be used for switching between browsers. When same ``alias`` 
        is given with two `Open Browser` keywords, the first keyword will 
        open a new browser, but the second one will switch to the already 
        opened browser and will not open a new browser. The ``alias`` 
        definition overrules ``browser`` definition. When same ``alias`` 
        is used but a different ``browser`` is defined, then switch to 
        a browser with same alias is done and new browser is not opened. 
        An alternative approach for switching is using an index returned 
        by this keyword. These indices start from 1, are incremented when new 
        browsers are opened, and reset back to 1 when `Close All Browsers` 
        is called. See `Switch Browser` for more information and examples. 
 
        Alias examples: 
        | ${1_index} =    | `Open Browser` | http://example.com | Chrome  | alias=Chrome     | # Opens new browser because alias is new.         | 
        | ${2_index} =    | `Open Browser` | http://example.com | Firefox |                  | # Opens new browser because alias is not defined. | 
        | ${3_index} =    | `Open Browser` | http://example.com | Chrome  | alias=Chrome     | # Switches to the browser with Chrome alias.      | 
        | ${4_index} =    | `Open Browser` | http://example.com | Chrome  | alias=${1_index} | # Switches to the browser with Chrome alias.      | 
        | Should Be Equal | ${1_index}     | ${3_index}         |         |                  |                                                   | 
        | Should Be Equal | ${1_index}     | ${4_index}         |         |                  |                                                   | 
        | Should Be Equal | ${2_index}     | ${2}               |         |                  |                                                   | 
 
        Optional ``remote_url`` is the URL for a 
        [https://github.com/SeleniumHQ/selenium/wiki/Grid2|Selenium Grid]. 
 
        Optional ``desired_capabilities`` is deprecated and will be removed 
        in the next release. Capabilities of each individual browser is now 
        done through options or services. Please refer to those arguments 
        for configuring specific browsers. 
 
        Optional ``ff_profile_dir`` is the path to the Firefox profile 
        directory if you wish to overwrite the default profile Selenium 
        uses. The ``ff_profile_dir`` can also be an instance of the 
        [https://seleniumhq.github.io/selenium/docs/api/py/webdriver_firefox/selenium.webdriver.firefox.firefox_profile.html|selenium.webdriver.FirefoxProfile] 
        . As a third option, it is possible to use `FirefoxProfile` methods 
        and attributes to define the profile using methods and attributes 
        in the same way as with ``options`` argument. Example: It is possible 
        to use FirefoxProfile `set_preference` to define different 
        profile settings. See ``options`` argument documentation in below 
        how to handle backslash escaping. 
 
        Example for FirefoxProfile 
        | `Open Browser` | http://example.com | Firefox | ff_profile_dir=/path/to/profile                                                  | # Using profile from disk.                       | 
        | `Open Browser` | http://example.com | Firefox | ff_profile_dir=${FirefoxProfile_instance}                                        | # Using instance of FirefoxProfile.              | 
        | `Open Browser` | http://example.com | Firefox | ff_profile_dir=set_preference(&quot;key&quot;, &quot;value&quot;);set_preference(&quot;other&quot;, &quot;setting&quot;) | # Defining profile using FirefoxProfile mehtods. | 
 
        Optional ``options`` argument allows defining browser specific 
        Selenium options. Example for Chrome, the ``options`` argument 
        allows defining the following 
        [https://seleniumhq.github.io/selenium/docs/api/py/webdriver_chrome/selenium.webdriver.chrome.options.html#selenium.webdriver.chrome.options.Options|methods and attributes] 
        and for Firefox these 
        [https://seleniumhq.github.io/selenium/docs/api/py/webdriver_firefox/selenium.webdriver.firefox.options.html?highlight=firefox#selenium.webdriver.firefox.options.Options|methods and attributes] 
        are available. Selenium options are also supported, when ``remote_url`` 
        argument is used. 
 
        The SeleniumLibrary ``options`` argument accepts Selenium 
        options in two different formats: as a string and as Python object 
        which is an instance of the Selenium options class. 
 
        The string format uses a Python like syntax to define Selenium options 
        methods or attributes. 
 
        Example when using 
        [https://seleniumhq.github.io/selenium/docs/api/py/webdriver_chrome/selenium.webdriver.chrome.options.html#selenium.webdriver.chrome.options.Options|Chrome options] 
        method: 
        | `Open Browser` | http://example.com | Chrome | options=add_argument(&quot;--disable-popup-blocking&quot;); add_argument(&quot;--ignore-certificate-errors&quot;) | # Sting format.                    | 
        | `Open Browser` | None               | Chrome | options=binary_location=&quot;/path/to/binary&quot;;add_argument(&quot;remote-debugging-port=port&quot;)          | # Start Chomium-based application. | 
        | `Open Browser` | None               | Chrome | options=binary_location=r&quot;C:\\\\path\\\\to\\\\binary&quot;                                         | # Windows OS path escaping.        | 
 
        ``options`` argument also supports receiving the Selenium 
        options as Python class instance. 
 
        See the `Browser and Driver options` section for more details on how to use 
        the either the string format or Python object syntax with the ``options`` argument. 
 
        Optional ``service_log_path`` will be deprecated in the next release. Please 
        use the browser specific ``service`` attribute instead. The ``service_log_path`` 
        argument defines the name of the file where to write the browser driver logs. 
        If the ``service_log_path``  argument contains a marker ``{index}``, it 
        will be automatically replaced with unique running 
        index preventing files to be overwritten. Indices start's from 1, 
        and how they are represented can be customized using Python's 
        [https://docs.python.org/3/library/string.html#format-string-syntax| 
        format string syntax]. 
 
        Optional ``executable_path``  will be deprecated in the next release. Please 
        use the `executable_path` and, if needed, `port` attribute on the ``service`` 
        argument instead. The ``executable_path`` argument defines the path to the driver 
        executable, example to a chromedriver or a geckodriver. If not defined 
        it is assumed the executable is in the 
        [https://en.wikipedia.org/wiki/PATH_(variable)|$PATH]. 
 
        Optional ``service`` argument allows for managing the local drivers 
        as well as setting some browser specific settings like logging. Service 
        classes are not supported when ``remote_url`` argument is used. See the 
        `Browser and Driver options` section for more details on how to use 
        the ``service`` argument. 
 
        If the provided configuration options are not enough, it is possible 
        to use `Create Webdriver` to customize browser initialization even 
        more. 
 
        The ``service`` argument is new in SeleniumLibrary 6.4. 
        &quot;&quot;&quot;</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">get_index</span><span class="s3">(</span><span class="s1">alias</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">index</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s5">f&quot;Using existing browser from index </span><span class="s2">{</span><span class="s1">index</span><span class="s2">}</span><span class="s5">.&quot;</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">switch_browser</span><span class="s3">(</span><span class="s1">alias</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">url</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">go_to</span><span class="s3">(</span><span class="s1">url</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">index</span>
        <span class="s2">if </span><span class="s1">desired_capabilities</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s5">&quot;desired_capabilities has been deprecated and removed. Please use options to configure browsers as per documentation.&quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">service_log_path</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s5">&quot;service_log_path is being deprecated. Please use service to configure log_output or equivalent service attribute.&quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">executable_path</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s5">&quot;exexcutable_path is being deprecated. Please use service to configure the driver's executable_path as per documentation.&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_make_new_browser</span><span class="s3">(</span>
            <span class="s1">url</span><span class="s3">,</span>
            <span class="s1">browser</span><span class="s3">,</span>
            <span class="s1">alias</span><span class="s3">,</span>
            <span class="s1">remote_url</span><span class="s3">,</span>
            <span class="s1">desired_capabilities</span><span class="s3">,</span>
            <span class="s1">ff_profile_dir</span><span class="s3">,</span>
            <span class="s1">options</span><span class="s3">,</span>
            <span class="s1">service_log_path</span><span class="s3">,</span>
            <span class="s1">executable_path</span><span class="s3">,</span>
            <span class="s1">service</span><span class="s3">,</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_make_new_browser</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">url</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">browser</span><span class="s3">=</span><span class="s5">&quot;firefox&quot;</span><span class="s3">,</span>
        <span class="s1">alias</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">remote_url</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">desired_capabilities</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">ff_profile_dir</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">options</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">service_log_path</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">executable_path</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">service</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s2">if </span><span class="s1">remote_url</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span>
                <span class="s5">f&quot;Opening browser '</span><span class="s2">{</span><span class="s1">browser</span><span class="s2">}</span><span class="s5">' to base url '</span><span class="s2">{</span><span class="s1">url</span><span class="s2">}</span><span class="s5">' through &quot;</span>
                <span class="s5">f&quot;remote server at '</span><span class="s2">{</span><span class="s1">remote_url</span><span class="s2">}</span><span class="s5">'.&quot;</span>
            <span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s5">f&quot;Opening browser '</span><span class="s2">{</span><span class="s1">browser</span><span class="s2">}</span><span class="s5">' to base url '</span><span class="s2">{</span><span class="s1">url</span><span class="s2">}</span><span class="s5">'.&quot;</span><span class="s3">)</span>
        <span class="s1">driver </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_make_driver</span><span class="s3">(</span>
            <span class="s1">browser</span><span class="s3">,</span>
            <span class="s1">desired_capabilities</span><span class="s3">,</span>
            <span class="s1">ff_profile_dir</span><span class="s3">,</span>
            <span class="s1">remote_url</span><span class="s3">,</span>
            <span class="s1">options</span><span class="s3">,</span>
            <span class="s1">service_log_path</span><span class="s3">,</span>
            <span class="s1">executable_path</span><span class="s3">,</span>
            <span class="s1">service</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">driver </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_wrap_event_firing_webdriver</span><span class="s3">(</span><span class="s1">driver</span><span class="s3">)</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">register_driver</span><span class="s3">(</span><span class="s1">driver</span><span class="s3">, </span><span class="s1">alias</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">url</span><span class="s3">:</span>
            <span class="s2">try</span><span class="s3">:</span>
                <span class="s1">driver</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">url</span><span class="s3">)</span>
            <span class="s2">except </span><span class="s1">Exception</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
                    <span class="s5">f&quot;Opened browser with session id </span><span class="s2">{</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">session_id</span><span class="s2">} </span><span class="s5">but failed to open url '</span><span class="s2">{</span><span class="s1">url</span><span class="s2">}</span><span class="s5">'.&quot;</span>
                <span class="s3">)</span>
                <span class="s2">raise</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s5">f&quot;Opened browser with session id </span><span class="s2">{</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">session_id</span><span class="s2">}</span><span class="s5">.&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">index</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">create_webdriver</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">driver_name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">alias</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">dict</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">, **</span><span class="s1">init_kwargs</span>
    <span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Creates an instance of Selenium WebDriver. 
 
        Like `Open Browser`, but allows passing arguments to the created 
        WebDriver instance directly. This keyword should only be used if 
        the functionality provided by `Open Browser` is not adequate. 
 
        ``driver_name`` must be a WebDriver implementation name like Firefox, 
        Chrome, Ie, Edge, Safari, or Remote. 
 
        The initialized WebDriver can be configured either with a Python 
        dictionary ``kwargs`` or by using keyword arguments ``**init_kwargs``. 
        These arguments are passed directly to WebDriver without any 
        processing. See [https://seleniumhq.github.io/selenium/docs/api/py/api.html| 
        Selenium API documentation] for details about the supported arguments. 
 
        Examples: 
        | # Use proxy with Firefox   |                |                              |                                      | 
        | ${proxy}=                  | `Evaluate`     | selenium.webdriver.Proxy()   | modules=selenium, selenium.webdriver | 
        | ${proxy.http_proxy}=       | `Set Variable` | localhost:8888               |                                      | 
        | `Create Webdriver`         | Firefox        | proxy=${proxy}               |                                      | 
 
        Returns the index of this browser instance which can be used later to 
        switch back to it. Index starts from 1 and is reset back to it when 
        `Close All Browsers` keyword is used. See `Switch Browser` for an 
        example. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">kwargs </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">kwargs </span><span class="s3">= {}</span>
        <span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">kwargs</span><span class="s3">, </span><span class="s1">dict</span><span class="s3">):</span>
            <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s5">&quot;kwargs must be a dictionary.&quot;</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">arg_name </span><span class="s2">in </span><span class="s1">kwargs</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">arg_name </span><span class="s2">in </span><span class="s1">init_kwargs</span><span class="s3">:</span>
                <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s5">f&quot;Got multiple values for argument '</span><span class="s2">{</span><span class="s1">arg_name</span><span class="s2">}</span><span class="s5">'.&quot;</span><span class="s3">)</span>
            <span class="s1">init_kwargs</span><span class="s3">[</span><span class="s1">arg_name</span><span class="s3">] = </span><span class="s1">kwargs</span><span class="s3">[</span><span class="s1">arg_name</span><span class="s3">]</span>
        <span class="s1">driver_name </span><span class="s3">= </span><span class="s1">driver_name</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">creation_func </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">webdriver</span><span class="s3">, </span><span class="s1">driver_name</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s5">f&quot;'</span><span class="s2">{</span><span class="s1">driver_name</span><span class="s2">}</span><span class="s5">' is not a valid WebDriver name.&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s5">f&quot;Creating an instance of the </span><span class="s2">{</span><span class="s1">driver_name</span><span class="s2">} </span><span class="s5">WebDriver.&quot;</span><span class="s3">)</span>
        <span class="s1">driver </span><span class="s3">= </span><span class="s1">creation_func</span><span class="s3">(**</span><span class="s1">init_kwargs</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
            <span class="s5">f&quot;Created </span><span class="s2">{</span><span class="s1">driver_name</span><span class="s2">} </span><span class="s5">WebDriver instance with session id </span><span class="s2">{</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">session_id</span><span class="s2">}</span><span class="s5">.&quot;</span>
        <span class="s3">)</span>
        <span class="s1">driver </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_wrap_event_firing_webdriver</span><span class="s3">(</span><span class="s1">driver</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">register_driver</span><span class="s3">(</span><span class="s1">driver</span><span class="s3">, </span><span class="s1">alias</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_wrap_event_firing_webdriver</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">driver</span><span class="s3">):</span>
        <span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">event_firing_webdriver</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">driver</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span><span class="s5">&quot;Wrapping driver to event_firing_webdriver.&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">EventFiringWebDriver</span><span class="s3">(</span><span class="s1">driver</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">event_firing_webdriver</span><span class="s3">())</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">switch_browser</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">index_or_alias</span><span class="s3">: </span><span class="s1">str</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Switches between active browsers using ``index_or_alias``. 
 
        Indices are returned by the `Open Browser` keyword and aliases can 
        be given to it explicitly. Indices start from 1. 
 
        Example: 
        | `Open Browser`        | http://google.com | ff       | 
        | `Location Should Be`  | http://google.com |          | 
        | `Open Browser`        | http://yahoo.com  | ie       | alias=second | 
        | `Location Should Be`  | http://yahoo.com  |          | 
        | `Switch Browser`      | 1                 | # index  | 
        | `Page Should Contain` | I'm feeling lucky |          | 
        | `Switch Browser`      | second            | # alias  | 
        | `Page Should Contain` | More Yahoo!       |          | 
        | `Close All Browsers`  |                   |          | 
 
        Above example expects that there was no other open browsers when 
        opening the first one because it used index ``1`` when switching to 
        it later. If you are not sure about that, you can store the index 
        into a variable as below. 
 
        | ${index} =         | `Open Browser` | http://google.com | 
        | # Do something ... |                |                   | 
        | `Switch Browser`   | ${index}       |                   | 
        &quot;&quot;&quot;</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">switch</span><span class="s3">(</span><span class="s1">index_or_alias</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s1">RuntimeError</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span>
                <span class="s5">f&quot;No browser with index or alias '</span><span class="s2">{</span><span class="s1">index_or_alias</span><span class="s2">}</span><span class="s5">' found.&quot;</span>
            <span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">debug</span><span class="s3">(</span>
            <span class="s5">f&quot;Switched to browser with Selenium session id </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">session_id</span><span class="s2">}</span><span class="s5">.&quot;</span>
        <span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_browser_ids</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; List</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s4">&quot;&quot;&quot;Returns index of all active browser as list. 
 
        Example: 
        | @{browser_ids}= | Get Browser Ids   |                   |                | 
        | FOR             | ${id}             | IN                | @{browser_ids} | 
        |                 | @{window_titles}= | Get Window Titles | browser=${id}  | 
        |                 | Log               | Browser ${id} has these windows: ${window_titles} | | 
        | END             |                   |                   |                | 
 
        See `Switch Browser` for more information and examples. 
 
        New in SeleniumLibrary 4.0 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">active_driver_ids</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_browser_aliases</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; List</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s4">&quot;&quot;&quot;Returns aliases of all active browser that has an alias as NormalizedDict. 
        The dictionary contains the aliases as keys and the index as value. 
        This can be accessed as dictionary ``${aliases.key}`` or as list ``@{aliases}[0]``. 
 
        Example: 
        | `Open Browser` | https://example.com   | alias=BrowserA | | 
        | `Open Browser` | https://example.com   | alias=BrowserB | | 
        | &amp;{aliases}     | `Get Browser Aliases` |                | # &amp;{aliases} = { BrowserA=1|BrowserB=2 } | 
        | `Log`          | ${aliases.BrowserA}   |                | # logs ``1`` | 
        | FOR            | ${alias}              | IN             | @{aliases} | 
        |                | `Log`                 | ${alias}       | # logs ``BrowserA`` and ``BrowserB`` | 
        | END            |                       |                | | 
 
        See `Switch Browser` for more information and examples. 
 
        New in SeleniumLibrary 4.0 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">active_aliases</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_session_id</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Returns the currently active browser session id. 
 
        New in SeleniumLibrary 3.2 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">session_id</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_source</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Returns the entire HTML source of the current page or frame.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">page_source</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_title</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Returns the title of the current page.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">title</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_location</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Returns the current browser window URL.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">current_url</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">location_should_be</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">url</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">message</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Verifies that the current URL is exactly ``url``. 
 
        The ``url`` argument contains the exact url that should exist in browser. 
 
        The ``message`` argument can be used to override the default error 
        message. 
 
        ``message`` argument is new in SeleniumLibrary 3.2.0. 
        &quot;&quot;&quot;</span>
        <span class="s1">actual </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_location</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s1">actual </span><span class="s3">!= </span><span class="s1">url</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">message </span><span class="s2">is None</span><span class="s3">:</span>
                <span class="s1">message </span><span class="s3">= </span><span class="s5">f&quot;Location should have been '</span><span class="s2">{</span><span class="s1">url</span><span class="s2">}</span><span class="s5">' but &quot; f&quot;was '</span><span class="s2">{</span><span class="s1">actual</span><span class="s2">}</span><span class="s5">'.&quot;</span>
            <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s1">message</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s5">f&quot;Current location is '</span><span class="s2">{</span><span class="s1">url</span><span class="s2">}</span><span class="s5">'.&quot;</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">location_should_contain</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">message</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Verifies that the current URL contains ``expected``. 
 
        The ``expected`` argument contains the expected value in url. 
 
        The ``message`` argument can be used to override the default error 
        message. 
 
        ``message`` argument is new in SeleniumLibrary 3.2.0. 
        &quot;&quot;&quot;</span>
        <span class="s1">actual </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_location</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s1">expected </span><span class="s2">not in </span><span class="s1">actual</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">message </span><span class="s2">is None</span><span class="s3">:</span>
                <span class="s1">message </span><span class="s3">= (</span>
                    <span class="s5">f&quot;Location should have contained '</span><span class="s2">{</span><span class="s1">expected</span><span class="s2">}</span><span class="s5">' but &quot;</span>
                    <span class="s5">f&quot;it was '</span><span class="s2">{</span><span class="s1">actual</span><span class="s2">}</span><span class="s5">'.&quot;</span>
                <span class="s3">)</span>
            <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s1">message</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s5">f&quot;Current location contains '</span><span class="s2">{</span><span class="s1">expected</span><span class="s2">}</span><span class="s5">'.&quot;</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">log_location</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Logs and returns the current browser window URL.&quot;&quot;&quot;</span>
        <span class="s1">url </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_location</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s1">url</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">url</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">log_source</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">loglevel</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s5">&quot;INFO&quot;</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Logs and returns the HTML source of the current page or frame. 
 
        The ``loglevel`` argument defines the used log level. Valid log 
        levels are ``WARN``, ``INFO`` (default), ``DEBUG``, ``TRACE`` 
        and ``NONE`` (no logging). 
        &quot;&quot;&quot;</span>
        <span class="s1">source </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_source</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">log</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, </span><span class="s1">loglevel</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">source</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">log_title</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Logs and returns the title of the current page.&quot;&quot;&quot;</span>
        <span class="s1">title </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_title</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s1">title</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">title</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">title_should_be</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">title</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">message</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Verifies that the current page title equals ``title``. 
 
        The ``message`` argument can be used to override the default error 
        message. 
 
        ``message`` argument is new in SeleniumLibrary 3.1. 
        &quot;&quot;&quot;</span>
        <span class="s1">actual </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_title</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s1">actual </span><span class="s3">!= </span><span class="s1">title</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">message </span><span class="s2">is None</span><span class="s3">:</span>
                <span class="s1">message </span><span class="s3">= </span><span class="s5">f&quot;Title should have been '</span><span class="s2">{</span><span class="s1">title</span><span class="s2">}</span><span class="s5">' but was '</span><span class="s2">{</span><span class="s1">actual</span><span class="s2">}</span><span class="s5">'.&quot;</span>
            <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s1">message</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s5">f&quot;Page title is '</span><span class="s2">{</span><span class="s1">title</span><span class="s2">}</span><span class="s5">'.&quot;</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">go_back</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Simulates the user clicking the back button on their browser.&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">back</span><span class="s3">()</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">go_to</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">url</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Navigates the current browser window to the provided ``url``.&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s5">f&quot;Opening url '</span><span class="s2">{</span><span class="s1">url</span><span class="s2">}</span><span class="s5">'&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">url</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">reload_page</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Simulates user reloading page.&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">refresh</span><span class="s3">()</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_selenium_speed</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Gets the delay that is waited after each Selenium command. 
 
        The value is returned as a human-readable string like ``1 second``. 
 
        See the `Selenium Speed` section above for more information. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">secs_to_timestr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">speed</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_selenium_timeout</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Gets the timeout that is used by various keywords. 
 
        The value is returned as a human-readable string like ``1 second``. 
 
        See the `Timeout` section above for more information. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">secs_to_timestr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">timeout</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_selenium_implicit_wait</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Gets the implicit wait value used by Selenium. 
 
        The value is returned as a human-readable string like ``1 second``. 
 
        See the `Implicit wait` section above for more information. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">secs_to_timestr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">implicit_wait</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_selenium_page_load_timeout</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Gets the time to wait for a page load to complete 
        before raising a timeout exception. 
 
        The value is returned as a human-readable string like ``1 second``. 
 
        See the `Page load` section above for more information. 
 
        New in SeleniumLibrary 6.1 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">secs_to_timestr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">page_load_timeout</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">set_selenium_speed</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">value</span><span class="s3">: </span><span class="s1">timedelta</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Sets the delay that is waited after each Selenium command. 
 
        The value can be given as a number that is considered to be 
        seconds or as a human-readable string like ``1 second``. 
        The previous value is returned and can be used to restore 
        the original value later if needed. 
 
        See the `Selenium Speed` section above for more information. 
 
        Example: 
        | `Set Selenium Speed` | 0.5 seconds | 
        &quot;&quot;&quot;</span>
        <span class="s1">old_speed </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_selenium_speed</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">speed </span><span class="s3">= </span><span class="s1">_convert_timeout</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">driver </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">active_drivers</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_monkey_patch_speed</span><span class="s3">(</span><span class="s1">driver</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">old_speed</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">set_selenium_timeout</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">value</span><span class="s3">: </span><span class="s1">timedelta</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Sets the timeout that is used by various keywords. 
 
        The value can be given as a number that is considered to be 
        seconds or as a human-readable string like ``1 second``. 
        The previous value is returned and can be used to restore 
        the original value later if needed. 
 
        See the `Timeout` section above for more information. 
 
        Example: 
        | ${orig timeout} = | `Set Selenium Timeout` | 15 seconds | 
        | `Open page that loads slowly` | 
        | `Set Selenium Timeout` | ${orig timeout} | 
        &quot;&quot;&quot;</span>
        <span class="s1">old_timeout </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_selenium_timeout</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">timeout </span><span class="s3">= </span><span class="s1">_convert_timeout</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">driver </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">active_drivers</span><span class="s3">:</span>
            <span class="s1">driver</span><span class="s3">.</span><span class="s1">set_script_timeout</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">timeout</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">old_timeout</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">set_selenium_implicit_wait</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">value</span><span class="s3">: </span><span class="s1">timedelta</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Sets the implicit wait value used by Selenium. 
 
        The value can be given as a number that is considered to be 
        seconds or as a human-readable string like ``1 second``. 
        The previous value is returned and can be used to restore 
        the original value later if needed. 
 
        This keyword sets the implicit wait for all opened browsers. 
        Use `Set Browser Implicit Wait` to set it only to the current 
        browser. 
 
        See the `Implicit wait` section above for more information. 
 
        Example: 
        | ${orig wait} = | `Set Selenium Implicit Wait` | 10 seconds | 
        | `Perform AJAX call that is slow` | 
        | `Set Selenium Implicit Wait` | ${orig wait} | 
        &quot;&quot;&quot;</span>
        <span class="s1">old_wait </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_selenium_implicit_wait</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">implicit_wait </span><span class="s3">= </span><span class="s1">_convert_timeout</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">driver </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">active_drivers</span><span class="s3">:</span>
            <span class="s1">driver</span><span class="s3">.</span><span class="s1">implicitly_wait</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">implicit_wait</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">old_wait</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">set_action_chain_delay</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">value</span><span class="s3">: </span><span class="s1">timedelta</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Sets the duration of delay in ActionChains() used by SeleniumLibrary. 
 
        The value can be given as a number that is considered to be 
        seconds or as a human-readable string like ``1 second``. 
 
        Value is always stored as milliseconds internally. 
 
        The previous value is returned and can be used to restore 
        the original value later if needed. 
        &quot;&quot;&quot;</span>
        <span class="s1">old_action_chain_delay </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">action_chain_delay</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">action_chain_delay </span><span class="s3">= </span><span class="s1">_convert_delay</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">timestr_to_secs</span><span class="s3">(</span><span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">old_action_chain_delay</span><span class="s2">} </span><span class="s5">milliseconds&quot;</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_action_chain_delay</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Gets the currently stored value for chain_delay_value in timestr format. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">timestr_to_secs</span><span class="s3">(</span><span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">action_chain_delay</span><span class="s2">} </span><span class="s5">milliseconds&quot;</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">set_browser_implicit_wait</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">value</span><span class="s3">: </span><span class="s1">timedelta</span><span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Sets the implicit wait value used by Selenium. 
 
        Same as `Set Selenium Implicit Wait` but only affects the current 
        browser. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">implicitly_wait</span><span class="s3">(</span><span class="s1">_convert_timeout</span><span class="s3">(</span><span class="s1">value</span><span class="s3">))</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">set_selenium_page_load_timeout</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">value</span><span class="s3">: </span><span class="s1">timedelta</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4">&quot;&quot;&quot;Sets the page load timeout value used by Selenium. 
 
        The value can be given as a number that is considered to be 
        seconds or as a human-readable string like ``1 second``. 
        The previous value is returned and can be used to restore 
        the original value later if needed. 
 
        In contrast to `Set Selenium Timeout` and `Set Selenium Implicit Wait`, 
        this keywords sets the time for the Webdriver to wait until the page 
        is loaded before raising a timeout exception. 
 
        See the `Page load` section above for more information. 
 
        Example: 
        | ${orig page load timeout} = | `Set Selenium Page Load Timeout` | 30 seconds | 
        | `Open page that loads slowly` | 
        | `Set Selenium Page Load Timeout` | ${orig page load timeout} | 
 
        New in SeleniumLibrary 6.1 
        &quot;&quot;&quot;</span>
        <span class="s1">old_page_load_timeout </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_selenium_page_load_timeout</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">page_load_timeout </span><span class="s3">= </span><span class="s1">_convert_timeout</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">driver </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">active_drivers</span><span class="s3">:</span>
            <span class="s1">driver</span><span class="s3">.</span><span class="s1">set_page_load_timeout</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">page_load_timeout</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">old_page_load_timeout</span>

    <span class="s2">def </span><span class="s1">_make_driver</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">browser</span><span class="s3">,</span>
        <span class="s1">desired_capabilities</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">profile_dir</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">remote</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">options</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">service_log_path</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">executable_path</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">service</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s1">driver </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_webdriver_creator</span><span class="s3">.</span><span class="s1">create_driver</span><span class="s3">(</span>
            <span class="s1">browser</span><span class="s3">=</span><span class="s1">browser</span><span class="s3">,</span>
            <span class="s1">desired_capabilities</span><span class="s3">=</span><span class="s1">desired_capabilities</span><span class="s3">,</span>
            <span class="s1">remote_url</span><span class="s3">=</span><span class="s1">remote</span><span class="s3">,</span>
            <span class="s1">profile_dir</span><span class="s3">=</span><span class="s1">profile_dir</span><span class="s3">,</span>
            <span class="s1">options</span><span class="s3">=</span><span class="s1">options</span><span class="s3">,</span>
            <span class="s1">service_log_path</span><span class="s3">=</span><span class="s1">service_log_path</span><span class="s3">,</span>
            <span class="s1">executable_path</span><span class="s3">=</span><span class="s1">executable_path</span><span class="s3">,</span>
            <span class="s1">service</span><span class="s3">=</span><span class="s1">service</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">driver</span><span class="s3">.</span><span class="s1">set_script_timeout</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">timeout</span><span class="s3">)</span>
        <span class="s1">driver</span><span class="s3">.</span><span class="s1">implicitly_wait</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">implicit_wait</span><span class="s3">)</span>
        <span class="s1">driver</span><span class="s3">.</span><span class="s1">set_page_load_timeout</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">page_load_timeout</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">speed</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_monkey_patch_speed</span><span class="s3">(</span><span class="s1">driver</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">driver</span>

    <span class="s2">def </span><span class="s1">_monkey_patch_speed</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">driver</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">execute</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">driver_command</span><span class="s3">, </span><span class="s1">params</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_base_execute</span><span class="s3">(</span><span class="s1">driver_command</span><span class="s3">, </span><span class="s1">params</span><span class="s3">)</span>
            <span class="s1">speed </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_speed </span><span class="s2">if </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s5">&quot;_speed&quot;</span><span class="s3">) </span><span class="s2">else </span><span class="s6">0.0</span>
            <span class="s2">if </span><span class="s1">speed </span><span class="s3">&gt; </span><span class="s6">0</span><span class="s3">:</span>
                <span class="s1">time</span><span class="s3">.</span><span class="s1">sleep</span><span class="s3">(</span><span class="s1">speed</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">result</span>

        <span class="s2">if not </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">driver</span><span class="s3">, </span><span class="s5">&quot;_base_execute&quot;</span><span class="s3">):</span>
            <span class="s1">driver</span><span class="s3">.</span><span class="s1">_base_execute </span><span class="s3">= </span><span class="s1">driver</span><span class="s3">.</span><span class="s1">execute</span>
            <span class="s1">driver</span><span class="s3">.</span><span class="s1">execute </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">MethodType</span><span class="s3">(</span><span class="s1">execute</span><span class="s3">, </span><span class="s1">driver</span><span class="s3">)</span>
        <span class="s1">driver</span><span class="s3">.</span><span class="s1">_speed </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">speed</span>
</pre>
</body>
</html>