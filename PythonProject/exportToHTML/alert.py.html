<html>
<head>
<title>alert.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
alert.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright 2008-2011 Nokia Networks</span>
<span class="s0"># Copyright 2011-2016 Ryan Tomac, Ed Manlove and contributors</span>
<span class="s0"># Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0"># you may not use this file except in compliance with the License.</span>
<span class="s0"># You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0"># Unless required by applicable law or agreed to in writing, software</span>
<span class="s0"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0"># See the License for the specific language governing permissions and</span>
<span class="s0"># limitations under the License.</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">timedelta</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Optional</span>

<span class="s2">from </span><span class="s1">selenium</span><span class="s3">.</span><span class="s1">common</span><span class="s3">.</span><span class="s1">exceptions </span><span class="s2">import </span><span class="s1">TimeoutException</span><span class="s3">, </span><span class="s1">WebDriverException</span>
<span class="s2">from </span><span class="s1">selenium</span><span class="s3">.</span><span class="s1">webdriver</span><span class="s3">.</span><span class="s1">support </span><span class="s2">import </span><span class="s1">expected_conditions </span><span class="s2">as </span><span class="s1">EC</span>
<span class="s2">from </span><span class="s1">selenium</span><span class="s3">.</span><span class="s1">webdriver</span><span class="s3">.</span><span class="s1">support</span><span class="s3">.</span><span class="s1">ui </span><span class="s2">import </span><span class="s1">WebDriverWait</span>

<span class="s2">from </span><span class="s1">SeleniumLibrary</span><span class="s3">.</span><span class="s1">base </span><span class="s2">import </span><span class="s1">keyword</span><span class="s3">, </span><span class="s1">LibraryComponent</span>
<span class="s2">from </span><span class="s1">SeleniumLibrary</span><span class="s3">.</span><span class="s1">utils </span><span class="s2">import </span><span class="s1">secs_to_timestr</span>


<span class="s2">class </span><span class="s1">AlertKeywords</span><span class="s3">(</span><span class="s1">LibraryComponent</span><span class="s3">):</span>
    <span class="s1">ACCEPT </span><span class="s3">= </span><span class="s4">&quot;ACCEPT&quot;</span>
    <span class="s1">DISMISS </span><span class="s3">= </span><span class="s4">&quot;DISMISS&quot;</span>
    <span class="s1">LEAVE </span><span class="s3">= </span><span class="s4">&quot;LEAVE&quot;</span>
    <span class="s1">_next_alert_action </span><span class="s3">= </span><span class="s1">ACCEPT</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">input_text_into_alert</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">text</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">action</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s1">ACCEPT</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">timedelta</span><span class="s3">] = </span><span class="s2">None</span>
    <span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot;Types the given ``text`` into an input field in an alert. 
 
        The alert is accepted by default, but that behavior can be controlled 
        by using the ``action`` argument same way as with `Handle Alert`. 
 
        ``timeout`` specifies how long to wait for the alert to appear. 
        If it is not given, the global default `timeout` is used instead. 
 
        New in SeleniumLibrary 3.0. 
        &quot;&quot;&quot;</span>
        <span class="s1">alert </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_wait_alert</span><span class="s3">(</span><span class="s1">timeout</span><span class="s3">)</span>
        <span class="s1">alert</span><span class="s3">.</span><span class="s1">send_keys</span><span class="s3">(</span><span class="s1">text</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_handle_alert</span><span class="s3">(</span><span class="s1">alert</span><span class="s3">, </span><span class="s1">action</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">alert_should_be_present</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">text</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;&quot;</span><span class="s3">,</span>
        <span class="s1">action</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s1">ACCEPT</span><span class="s3">,</span>
        <span class="s1">timeout</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">timedelta</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot;Verifies that an alert is present and by default, accepts it. 
 
        Fails if no alert is present. If ``text`` is a non-empty string, 
        then it is used to verify alert's message. The alert is accepted 
        by default, but that behavior can be controlled by using the 
        ``action`` argument same way as with `Handle Alert`. 
 
        ``timeout`` specifies how long to wait for the alert to appear. 
        If it is not given, the global default `timeout` is used instead. 
 
        ``action`` and ``timeout`` arguments are new in SeleniumLibrary 3.0. 
        In earlier versions, the alert was always accepted and a timeout was 
        hardcoded to one second. 
        &quot;&quot;&quot;</span>
        <span class="s1">message </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">handle_alert</span><span class="s3">(</span><span class="s1">action</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">text </span><span class="s2">and </span><span class="s1">text </span><span class="s3">!= </span><span class="s1">message</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span>
                <span class="s4">f&quot;Alert message should have been '</span><span class="s2">{</span><span class="s1">text</span><span class="s2">}</span><span class="s4">' but it &quot; f&quot;was '</span><span class="s2">{</span><span class="s1">message</span><span class="s2">}</span><span class="s4">'.&quot;</span>
            <span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">alert_should_not_be_present</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">action</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s1">ACCEPT</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">timedelta</span><span class="s3">] = </span><span class="s2">None</span>
    <span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot;Verifies that no alert is present. 
 
        If the alert actually exists, the ``action`` argument determines 
        how it should be handled. By default, the alert is accepted, but 
        it can be also dismissed or left open the same way as with the 
        `Handle Alert` keyword. 
 
        ``timeout`` specifies how long to wait for the alert to appear. 
        By default, is not waited for the alert at all, but a custom time can 
        be given if alert may be delayed. See the `time format` section 
        for information about the syntax. 
 
        New in SeleniumLibrary 3.0. 
        &quot;&quot;&quot;</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">alert </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_wait_alert</span><span class="s3">(</span><span class="s1">timeout</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s1">AssertionError</span><span class="s3">:</span>
            <span class="s2">return</span>
        <span class="s1">text </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_handle_alert</span><span class="s3">(</span><span class="s1">alert</span><span class="s3">, </span><span class="s1">action</span><span class="s3">)</span>
        <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s4">f&quot;Alert with message '</span><span class="s2">{</span><span class="s1">text</span><span class="s2">}</span><span class="s4">' present.&quot;</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">handle_alert</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">action</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s1">ACCEPT</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">timedelta</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot;Handles the current alert and returns its message. 
 
        By default, the alert is accepted, but this can be controlled 
        with the ``action`` argument that supports the following 
        case-insensitive values: 
 
        - ``ACCEPT``: Accept the alert i.e. press ``Ok``. Default. 
        - ``DISMISS``: Dismiss the alert i.e. press ``Cancel``. 
        - ``LEAVE``: Leave the alert open. 
 
        The ``timeout`` argument specifies how long to wait for the alert 
        to appear. If it is not given, the global default `timeout` is used 
        instead. 
 
        Examples: 
        | Handle Alert |                |       | # Accept alert.  | 
        | Handle Alert | action=DISMISS |       | # Dismiss alert. | 
        | Handle Alert | timeout=10 s   |       | # Use custom timeout and accept alert.  | 
        | Handle Alert | DISMISS        | 1 min | # Use custom timeout and dismiss alert. | 
        | ${message} = | Handle Alert   |       | # Accept alert and get its message.     | 
        | ${message} = | Handle Alert   | LEAVE | # Leave alert open and get its message. | 
 
        New in SeleniumLibrary 3.0. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s4">f&quot;HANDLE::</span><span class="s2">{</span><span class="s1">type</span><span class="s3">(</span><span class="s1">timeout</span><span class="s3">)</span><span class="s2">}</span><span class="s4">::</span><span class="s2">{</span><span class="s1">timeout</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
        <span class="s1">alert </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_wait_alert</span><span class="s3">(</span><span class="s1">timeout</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_handle_alert</span><span class="s3">(</span><span class="s1">alert</span><span class="s3">, </span><span class="s1">action</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_handle_alert</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">alert</span><span class="s3">, </span><span class="s1">action</span><span class="s3">):</span>
        <span class="s1">action </span><span class="s3">= </span><span class="s1">action</span><span class="s3">.</span><span class="s1">upper</span><span class="s3">()</span>
        <span class="s1">text </span><span class="s3">= </span><span class="s4">&quot; &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">alert</span><span class="s3">.</span><span class="s1">text</span><span class="s3">.</span><span class="s1">splitlines</span><span class="s3">())</span>
        <span class="s2">if </span><span class="s1">action </span><span class="s3">== </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ACCEPT</span><span class="s3">:</span>
            <span class="s1">alert</span><span class="s3">.</span><span class="s1">accept</span><span class="s3">()</span>
        <span class="s2">elif </span><span class="s1">action </span><span class="s3">== </span><span class="s1">self</span><span class="s3">.</span><span class="s1">DISMISS</span><span class="s3">:</span>
            <span class="s1">alert</span><span class="s3">.</span><span class="s1">dismiss</span><span class="s3">()</span>
        <span class="s2">elif </span><span class="s1">action </span><span class="s3">!= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">LEAVE</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">f&quot;Invalid alert action '</span><span class="s2">{</span><span class="s1">action</span><span class="s2">}</span><span class="s4">'.&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">text</span>

    <span class="s2">def </span><span class="s1">_wait_alert</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s1">timeout </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_timeout</span><span class="s3">(</span><span class="s1">timeout</span><span class="s3">)</span>
        <span class="s1">wait </span><span class="s3">= </span><span class="s1">WebDriverWait</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">)</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">wait</span><span class="s3">.</span><span class="s1">until</span><span class="s3">(</span><span class="s1">EC</span><span class="s3">.</span><span class="s1">alert_is_present</span><span class="s3">())</span>
        <span class="s2">except </span><span class="s1">TimeoutException</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s4">f&quot;Alert not found in </span><span class="s2">{</span><span class="s1">secs_to_timestr</span><span class="s3">(</span><span class="s1">timeout</span><span class="s3">)</span><span class="s2">}</span><span class="s4">.&quot;</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s1">WebDriverException </span><span class="s2">as </span><span class="s1">err</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s4">f&quot;An exception occurred waiting for alert: </span><span class="s2">{</span><span class="s1">err</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
</pre>
</body>
</html>