<html>
<head>
<title>executionresult.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
executionresult.py</font>
</center></td></tr></table>
<pre><span class="s0">#  Copyright 2008-2015 Nokia Networks</span>
<span class="s0">#  Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0">#  you may not use this file except in compliance with the License.</span>
<span class="s0">#  You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="s0">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0">#  See the License for the specific language governing permissions and</span>
<span class="s0">#  limitations under the License.</span>

<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">datetime</span>
<span class="s2">from </span><span class="s1">pathlib </span><span class="s2">import </span><span class="s1">Path</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">overload</span><span class="s3">, </span><span class="s1">Sequence</span><span class="s3">, </span><span class="s1">TextIO</span>

<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">errors </span><span class="s2">import </span><span class="s1">DataError</span>
<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">model </span><span class="s2">import </span><span class="s1">Statistics</span><span class="s3">, </span><span class="s1">SuiteVisitor</span>
<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">utils </span><span class="s2">import </span><span class="s1">JsonDumper</span><span class="s3">, </span><span class="s1">JsonLoader</span><span class="s3">, </span><span class="s1">setter</span>
<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">version </span><span class="s2">import </span><span class="s1">get_full_version</span>

<span class="s2">from </span><span class="s3">.</span><span class="s1">executionerrors </span><span class="s2">import </span><span class="s1">ExecutionErrors</span>
<span class="s2">from </span><span class="s3">.</span><span class="s1">flattenkeywordmatcher </span><span class="s2">import </span><span class="s1">Flattener</span>
<span class="s2">from </span><span class="s3">.</span><span class="s1">model </span><span class="s2">import </span><span class="s1">TestSuite</span>


<span class="s2">def </span><span class="s1">is_json_source</span><span class="s3">(</span><span class="s1">source</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, </span><span class="s1">bytes</span><span class="s3">):</span>
        <span class="s0"># ISO-8859-1 is most likely *not* the right encoding, but decoding bytes</span>
        <span class="s0"># with it always succeeds and characters we care about ought to be correct</span>
        <span class="s0"># at least if the right encoding is UTF-8 or any ISO-8859-x encoding.</span>
        <span class="s1">source </span><span class="s3">= </span><span class="s1">source</span><span class="s3">.</span><span class="s1">decode</span><span class="s3">(</span><span class="s4">&quot;ISO-8859-1&quot;</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, </span><span class="s1">str</span><span class="s3">):</span>
        <span class="s1">source </span><span class="s3">= </span><span class="s1">source</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>
        <span class="s1">first</span><span class="s3">, </span><span class="s1">last </span><span class="s3">= (</span><span class="s1">source</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">source</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">]) </span><span class="s2">if </span><span class="s1">source </span><span class="s2">else </span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">, </span><span class="s4">&quot;&quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">first</span><span class="s3">, </span><span class="s1">last</span><span class="s3">) == (</span><span class="s4">&quot;{&quot;</span><span class="s3">, </span><span class="s4">&quot;}&quot;</span><span class="s3">):</span>
            <span class="s2">return True</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">first</span><span class="s3">, </span><span class="s1">last</span><span class="s3">) == (</span><span class="s4">&quot;&lt;&quot;</span><span class="s3">, </span><span class="s4">&quot;&gt;&quot;</span><span class="s3">):</span>
            <span class="s2">return False</span>
        <span class="s1">path </span><span class="s3">= </span><span class="s1">Path</span><span class="s3">(</span><span class="s1">source</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, </span><span class="s1">Path</span><span class="s3">):</span>
        <span class="s1">path </span><span class="s3">= </span><span class="s1">source</span>
    <span class="s2">elif </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, </span><span class="s4">&quot;name&quot;</span><span class="s3">) </span><span class="s2">and </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">source</span><span class="s3">.</span><span class="s1">name</span><span class="s3">, </span><span class="s1">str</span><span class="s3">):</span>
        <span class="s1">path </span><span class="s3">= </span><span class="s1">Path</span><span class="s3">(</span><span class="s1">source</span><span class="s3">.</span><span class="s1">name</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return False</span>
    <span class="s2">return </span><span class="s1">bool</span><span class="s3">(</span><span class="s1">path </span><span class="s2">and </span><span class="s1">path</span><span class="s3">.</span><span class="s1">suffix</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">() == </span><span class="s4">&quot;.json&quot;</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">Result</span><span class="s3">:</span>
    <span class="s6">&quot;&quot;&quot;Test execution results. 
 
    Can be created based on XML output files using the 
    :func:`~.resultbuilder.ExecutionResult` 
    factory method. Also returned by the 
    :meth:`robot.running.TestSuite.run &lt;robot.running.model.TestSuite.run&gt;` 
    method. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">source</span><span class="s3">: </span><span class="s4">&quot;Path|str|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">suite</span><span class="s3">: </span><span class="s4">&quot;TestSuite|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">errors</span><span class="s3">: </span><span class="s4">&quot;ExecutionErrors|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">rpa</span><span class="s3">: </span><span class="s4">&quot;bool|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">generator</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;unknown&quot;</span><span class="s3">,</span>
        <span class="s1">generation_time</span><span class="s3">: </span><span class="s4">&quot;datetime|str|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">source </span><span class="s3">= </span><span class="s1">Path</span><span class="s3">(</span><span class="s1">source</span><span class="s3">) </span><span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, </span><span class="s1">str</span><span class="s3">) </span><span class="s2">else </span><span class="s1">source</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">suite </span><span class="s3">= </span><span class="s1">suite </span><span class="s2">or </span><span class="s1">TestSuite</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">errors </span><span class="s3">= </span><span class="s1">errors </span><span class="s2">or </span><span class="s1">ExecutionErrors</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">rpa </span><span class="s3">= </span><span class="s1">rpa</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">generator </span><span class="s3">= </span><span class="s1">generator</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">generation_time </span><span class="s3">= </span><span class="s1">generation_time</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_status_rc </span><span class="s3">= </span><span class="s2">True</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_stat_config </span><span class="s3">= {}</span>

    <span class="s3">@</span><span class="s1">setter</span>
    <span class="s2">def </span><span class="s1">rpa</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">rpa</span><span class="s3">: </span><span class="s4">&quot;bool|None&quot;</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;bool|None&quot;</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">rpa </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_set_suite_rpa</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">, </span><span class="s1">rpa</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">rpa</span>

    <span class="s2">def </span><span class="s1">_set_suite_rpa</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">suite</span><span class="s3">, </span><span class="s1">rpa</span><span class="s3">):</span>
        <span class="s1">suite</span><span class="s3">.</span><span class="s1">rpa </span><span class="s3">= </span><span class="s1">rpa</span>
        <span class="s2">for </span><span class="s1">child </span><span class="s2">in </span><span class="s1">suite</span><span class="s3">.</span><span class="s1">suites</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_set_suite_rpa</span><span class="s3">(</span><span class="s1">child</span><span class="s3">, </span><span class="s1">rpa</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">setter</span>
    <span class="s2">def </span><span class="s1">generation_time</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">timestamp</span><span class="s3">: </span><span class="s4">&quot;datetime|str|None&quot;</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;datetime|None&quot;</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">datetime </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return None</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">timestamp</span><span class="s3">, </span><span class="s1">str</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">datetime</span><span class="s3">.</span><span class="s1">fromisoformat</span><span class="s3">(</span><span class="s1">timestamp</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">timestamp</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">statistics</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; Statistics</span><span class="s3">:</span>
        <span class="s6">&quot;&quot;&quot;Execution statistics. 
 
        Statistics are created based on the contained ``suite`` and possible 
        :func:`configuration &lt;configure&gt;`. 
 
        Statistics are created every time this property is accessed. Saving 
        them to a variable is thus often a good idea to avoid re-creating 
        them unnecessarily:: 
 
            from robot.api import ExecutionResult 
 
            result = ExecutionResult('output.xml') 
            result.configure(stat_config={'suite_stat_level': 2, 
                                          'tag_stat_combine': 'tagANDanother'}) 
            stats = result.statistics 
            print(stats.total.failed) 
            print(stats.total.passed) 
            print(stats.tags.combined[0].total) 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">Statistics</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">, </span><span class="s1">rpa</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">rpa</span><span class="s3">, **</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_stat_config</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">return_code</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; int</span><span class="s3">:</span>
        <span class="s6">&quot;&quot;&quot;Execution return code. 
 
        By default, returns the number of failed tests or tasks (max 250), 
        but can be :func:`configured &lt;configure&gt;` to always return 0. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_status_rc</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">min</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">.</span><span class="s1">statistics</span><span class="s3">.</span><span class="s1">failed</span><span class="s3">, </span><span class="s5">250</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s5">0</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">generated_by_robot</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">generator</span><span class="s3">.</span><span class="s1">split</span><span class="s3">()[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">upper</span><span class="s3">() == </span><span class="s4">&quot;ROBOT&quot;</span>

    <span class="s2">def </span><span class="s1">configure</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">status_rc</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">suite_config</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">stat_config</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s6">&quot;&quot;&quot;Configures the result object and objects it contains. 
 
        :param status_rc: If set to ``False``, :attr:`return_code` always 
            returns 0. 
        :param suite_config: A dictionary of configuration options passed 
            to :meth:`~.result.testsuite.TestSuite.configure` method of 
            the contained ``suite``. 
        :param stat_config: A dictionary of configuration options used when 
            creating :attr:`statistics`. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">suite_config</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">.</span><span class="s1">configure</span><span class="s3">(**</span><span class="s1">suite_config</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_status_rc </span><span class="s3">= </span><span class="s1">status_rc</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_stat_config </span><span class="s3">= </span><span class="s1">stat_config </span><span class="s2">or </span><span class="s3">{}</span>

    <span class="s3">@</span><span class="s1">classmethod</span>
    <span class="s2">def </span><span class="s1">from_json</span><span class="s3">(</span>
        <span class="s1">cls</span><span class="s3">,</span>
        <span class="s1">source</span><span class="s3">: </span><span class="s4">&quot;str|bytes|TextIO|Path&quot;</span><span class="s3">,</span>
        <span class="s1">include_keywords</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">flattened_keywords</span><span class="s3">: </span><span class="s1">Sequence</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = (),</span>
        <span class="s1">rpa</span><span class="s3">: </span><span class="s4">&quot;bool|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Result&quot;</span><span class="s3">:</span>
        <span class="s6">&quot;&quot;&quot;Construct a result object from JSON data. 
 
        :param source: JSON data as a string or bytes containing the data 
            directly, an open file object where to read the data from, or a path 
            (``pathlib.Path`` or string) to a UTF-8 encoded file to read. 
        :param include_keywords: When ``False``, keyword and control structure 
            information is not parsed. This can save considerable amount of time 
            and memory. New in RF 7.3.2. 
        :param flattened_keywords: List of patterns controlling what keywords 
            and control structures to flatten. See the documentation of 
            the ``--flattenkeywords`` option for more details. New in RF 7.3.2. 
        :param rpa: Setting ``rpa`` either to ``True`` (RPA mode) or ``False`` 
            (test automation) sets the execution mode explicitly. By default, 
            the mode is got from the parsed data. 
        :returns: :class:`Result` instance. 
 
        The data can contain either: 
 
        - full result data (contains suite information, execution errors, etc.) 
          got, for example, from the :meth:`to_json` method, or 
        - only suite information got, for example, from 
          :meth:`result.testsuite.TestSuite.to_json &lt;TestSuite.to_json&gt;`. 
 
        :attr:`statistics` are populated automatically based on suite information 
        and thus ignored if they are present in the data. 
 
        New in Robot Framework 7.2. 
        &quot;&quot;&quot;</span>
        <span class="s1">loader </span><span class="s3">= </span><span class="s1">cls</span><span class="s3">.</span><span class="s1">_get_json_loader</span><span class="s3">(</span><span class="s1">include_keywords</span><span class="s3">)</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">data </span><span class="s3">= </span><span class="s1">loader</span><span class="s3">.</span><span class="s1">load</span><span class="s3">(</span><span class="s1">source</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">err</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">DataError</span><span class="s3">(</span><span class="s4">f&quot;Loading JSON data failed: </span><span class="s2">{</span><span class="s1">err</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s4">&quot;suite&quot; </span><span class="s2">in </span><span class="s1">data</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">cls</span><span class="s3">.</span><span class="s1">_from_full_json</span><span class="s3">(</span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">cls</span><span class="s3">.</span><span class="s1">_from_suite_json</span><span class="s3">(</span><span class="s1">data</span><span class="s3">)</span>
        <span class="s1">result</span><span class="s3">.</span><span class="s1">rpa </span><span class="s3">= </span><span class="s1">data</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;rpa&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">) </span><span class="s2">if </span><span class="s1">rpa </span><span class="s2">is None else </span><span class="s1">rpa</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, </span><span class="s1">Path</span><span class="s3">):</span>
            <span class="s1">result</span><span class="s3">.</span><span class="s1">source </span><span class="s3">= </span><span class="s1">source</span>
        <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, </span><span class="s1">str</span><span class="s3">) </span><span class="s2">and </span><span class="s1">source</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] != </span><span class="s4">&quot;{&quot; </span><span class="s2">and </span><span class="s1">Path</span><span class="s3">(</span><span class="s1">source</span><span class="s3">).</span><span class="s1">exists</span><span class="s3">():</span>
            <span class="s1">result</span><span class="s3">.</span><span class="s1">source </span><span class="s3">= </span><span class="s1">Path</span><span class="s3">(</span><span class="s1">source</span><span class="s3">)</span>
        <span class="s1">result</span><span class="s3">.</span><span class="s1">handle_suite_teardown_failures</span><span class="s3">()</span>
        <span class="s2">if not </span><span class="s1">include_keywords</span><span class="s3">:</span>
            <span class="s1">result</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">.</span><span class="s1">visit</span><span class="s3">(</span><span class="s1">KeywordRemover</span><span class="s3">())</span>
        <span class="s2">if </span><span class="s1">flattened_keywords</span><span class="s3">:</span>
            <span class="s1">result</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">.</span><span class="s1">visit</span><span class="s3">(</span><span class="s1">Flattener</span><span class="s3">(</span><span class="s1">flattened_keywords</span><span class="s3">))</span>
        <span class="s2">return </span><span class="s1">result</span>

    <span class="s3">@</span><span class="s1">classmethod</span>
    <span class="s2">def </span><span class="s1">_get_json_loader</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">, </span><span class="s1">include_keywords</span><span class="s3">: </span><span class="s1">bool</span><span class="s3">) </span><span class="s1">-&gt; JsonLoader</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">include_keywords</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">JsonLoader</span><span class="s3">()</span>

        <span class="s2">def </span><span class="s1">remove_keywords</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">):</span>
            <span class="s1">obj</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">(</span><span class="s4">&quot;body&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
            <span class="s1">obj</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">(</span><span class="s4">&quot;setup&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
            <span class="s0"># Teardowns cannot be removed yet, because we need to check suite</span>
            <span class="s0"># teardown status. They are removed later using KeywordRemover.</span>
            <span class="s2">return </span><span class="s1">obj</span>

        <span class="s2">return </span><span class="s1">JsonLoader</span><span class="s3">(</span><span class="s1">object_hook</span><span class="s3">=</span><span class="s1">remove_keywords</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">classmethod</span>
    <span class="s2">def </span><span class="s1">_from_full_json</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">, </span><span class="s1">data</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Result&quot;</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">Result</span><span class="s3">(</span>
            <span class="s1">suite</span><span class="s3">=</span><span class="s1">TestSuite</span><span class="s3">.</span><span class="s1">from_dict</span><span class="s3">(</span><span class="s1">data</span><span class="s3">[</span><span class="s4">&quot;suite&quot;</span><span class="s3">]),</span>
            <span class="s1">errors</span><span class="s3">=</span><span class="s1">ExecutionErrors</span><span class="s3">(</span><span class="s1">data</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;errors&quot;</span><span class="s3">)),</span>
            <span class="s1">generator</span><span class="s3">=</span><span class="s1">data</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;generator&quot;</span><span class="s3">),</span>
            <span class="s1">generation_time</span><span class="s3">=</span><span class="s1">data</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;generated&quot;</span><span class="s3">),</span>
        <span class="s3">)</span>

    <span class="s3">@</span><span class="s1">classmethod</span>
    <span class="s2">def </span><span class="s1">_from_suite_json</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">, </span><span class="s1">data</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Result&quot;</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">Result</span><span class="s3">(</span><span class="s1">suite</span><span class="s3">=</span><span class="s1">TestSuite</span><span class="s3">.</span><span class="s1">from_dict</span><span class="s3">(</span><span class="s1">data</span><span class="s3">))</span>

    <span class="s3">@</span><span class="s1">overload</span>
    <span class="s2">def </span><span class="s1">to_json</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">file</span><span class="s3">: </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s3">*,</span>
        <span class="s1">include_statistics</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">ensure_ascii</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">indent</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= </span><span class="s5">0</span><span class="s3">,</span>
        <span class="s1">separators</span><span class="s3">: </span><span class="s4">&quot;tuple[str, str]&quot; </span><span class="s3">= (</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s4">&quot;:&quot;</span><span class="s3">),</span>
    <span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">: ...</span>

    <span class="s3">@</span><span class="s1">overload</span>
    <span class="s2">def </span><span class="s1">to_json</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">file</span><span class="s3">: </span><span class="s4">&quot;TextIO|Path|str&quot;</span><span class="s3">,</span>
        <span class="s3">*,</span>
        <span class="s1">include_statistics</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">ensure_ascii</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">indent</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= </span><span class="s5">0</span><span class="s3">,</span>
        <span class="s1">separators</span><span class="s3">: </span><span class="s4">&quot;tuple[str, str]&quot; </span><span class="s3">= (</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s4">&quot;:&quot;</span><span class="s3">),</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">: ...</span>

    <span class="s2">def </span><span class="s1">to_json</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">file</span><span class="s3">: </span><span class="s4">&quot;None|TextIO|Path|str&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s3">*,</span>
        <span class="s1">include_statistics</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">ensure_ascii</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">indent</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= </span><span class="s5">0</span><span class="s3">,</span>
        <span class="s1">separators</span><span class="s3">: </span><span class="s4">&quot;tuple[str, str]&quot; </span><span class="s3">= (</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s4">&quot;:&quot;</span><span class="s3">),</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;str|None&quot;</span><span class="s3">:</span>
        <span class="s6">&quot;&quot;&quot;Serialize results into JSON. 
 
        The ``file`` parameter controls what to do with the resulting JSON data. 
        It can be: 
 
        - ``None`` (default) to return the data as a string, 
        - an open file object where to write the data to, or 
        - a path (``pathlib.Path`` or string) to a file where to write 
          the data using UTF-8 encoding. 
 
        The ``include_statistics`` controls including statistics information 
        in the resulting JSON data. Statistics are not needed if the serialized 
        JSON data is converted back to a ``Result`` object, but they can be 
        useful for external tools. 
 
        The remaining optional parameters are used for JSON formatting. 
        They are passed directly to the underlying json__ module, but 
        the defaults differ from what ``json`` uses. 
 
        New in Robot Framework 7.2. 
 
        __ https://docs.python.org/3/library/json.html 
        &quot;&quot;&quot;</span>
        <span class="s1">data </span><span class="s3">= {</span>
            <span class="s4">&quot;generator&quot;</span><span class="s3">: </span><span class="s1">get_full_version</span><span class="s3">(</span><span class="s4">&quot;Rebot&quot;</span><span class="s3">),</span>
            <span class="s4">&quot;generated&quot;</span><span class="s3">: </span><span class="s1">datetime</span><span class="s3">.</span><span class="s1">now</span><span class="s3">().</span><span class="s1">isoformat</span><span class="s3">(),</span>
            <span class="s4">&quot;rpa&quot;</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">rpa</span><span class="s3">,</span>
            <span class="s4">&quot;suite&quot;</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">.</span><span class="s1">to_dict</span><span class="s3">(),</span>
        <span class="s3">}</span>
        <span class="s2">if </span><span class="s1">include_statistics</span><span class="s3">:</span>
            <span class="s1">data</span><span class="s3">[</span><span class="s4">&quot;statistics&quot;</span><span class="s3">] = </span><span class="s1">self</span><span class="s3">.</span><span class="s1">statistics</span><span class="s3">.</span><span class="s1">to_dict</span><span class="s3">()</span>
        <span class="s1">data</span><span class="s3">[</span><span class="s4">&quot;errors&quot;</span><span class="s3">] = </span><span class="s1">self</span><span class="s3">.</span><span class="s1">errors</span><span class="s3">.</span><span class="s1">messages</span><span class="s3">.</span><span class="s1">to_dicts</span><span class="s3">()</span>
        <span class="s2">return </span><span class="s1">JsonDumper</span><span class="s3">(</span>
            <span class="s1">ensure_ascii</span><span class="s3">=</span><span class="s1">ensure_ascii</span><span class="s3">,</span>
            <span class="s1">indent</span><span class="s3">=</span><span class="s1">indent</span><span class="s3">,</span>
            <span class="s1">separators</span><span class="s3">=</span><span class="s1">separators</span><span class="s3">,</span>
        <span class="s3">).</span><span class="s1">dump</span><span class="s3">(</span><span class="s1">data</span><span class="s3">, </span><span class="s1">file</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">save</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">target</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">legacy_output</span><span class="s3">=</span><span class="s2">False</span><span class="s3">):</span>
        <span class="s6">&quot;&quot;&quot;Save results as XML or JSON file. 
 
        :param target: Target where to save results to. Can be a path 
            (``pathlib.Path`` or ``str``) or an open file object. If omitted, 
            uses the :attr:`source` which overwrites the original file. 
        :param legacy_output: Save XML results in Robot Framework 6.x compatible 
            format. New in Robot Framework 7.0. 
 
        File type is got based on the ``target``. The type is JSON if the ``target`` 
        is a path that has a ``.json`` suffix or if it is an open file that has 
        a ``name`` attribute with a ``.json`` suffix. Otherwise, the type is XML. 
 
        It is also possible to use :meth:`to_json` for JSON serialization. Compared 
        to this method, it allows returning the JSON in addition to writing it 
        into a file, and it also supports customizing JSON formatting. 
 
        Support for saving results in JSON is new in Robot Framework 7.0. 
        Originally only suite information was saved in that case, but starting 
        from Robot Framework 7.2, also JSON results contain full result data 
        including, for example, execution errors and statistics. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">reporting</span><span class="s3">.</span><span class="s1">outputwriter </span><span class="s2">import </span><span class="s1">LegacyOutputWriter</span><span class="s3">, </span><span class="s1">OutputWriter</span>

        <span class="s1">target </span><span class="s3">= </span><span class="s1">target </span><span class="s2">or </span><span class="s1">self</span><span class="s3">.</span><span class="s1">source</span>
        <span class="s2">if not </span><span class="s1">target</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">&quot;Path required.&quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">is_json_source</span><span class="s3">(</span><span class="s1">target</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">to_json</span><span class="s3">(</span><span class="s1">target</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">writer </span><span class="s3">= </span><span class="s1">OutputWriter </span><span class="s2">if not </span><span class="s1">legacy_output </span><span class="s2">else </span><span class="s1">LegacyOutputWriter</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">visit</span><span class="s3">(</span><span class="s1">writer</span><span class="s3">(</span><span class="s1">target</span><span class="s3">, </span><span class="s1">rpa</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">rpa</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">visit</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">visitor</span><span class="s3">):</span>
        <span class="s6">&quot;&quot;&quot;An entry point to visit the whole result object. 
 
        :param visitor: An instance of :class:`~.visitor.ResultVisitor`. 
 
        Visitors can gather information, modify results, etc. See 
        :mod:`~robot.result` package for a simple usage example. 
 
        Notice that it is also possible to call :meth:`result.suite.visit 
        &lt;robot.result.testsuite.TestSuite.visit&gt;` if there is no need to 
        visit the contained ``statistics`` or ``errors``. 
        &quot;&quot;&quot;</span>
        <span class="s1">visitor</span><span class="s3">.</span><span class="s1">visit_result</span><span class="s3">(</span><span class="s1">self</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">handle_suite_teardown_failures</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6">&quot;&quot;&quot;Internal usage only.&quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">generated_by_robot</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">.</span><span class="s1">handle_suite_teardown_failures</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">set_execution_mode</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">other</span><span class="s3">):</span>
        <span class="s6">&quot;&quot;&quot;Set execution mode based on other result. Internal usage only.&quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">other</span><span class="s3">.</span><span class="s1">rpa </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">pass</span>
        <span class="s2">elif </span><span class="s1">self</span><span class="s3">.</span><span class="s1">rpa </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">rpa </span><span class="s3">= </span><span class="s1">other</span><span class="s3">.</span><span class="s1">rpa</span>
        <span class="s2">elif </span><span class="s1">self</span><span class="s3">.</span><span class="s1">rpa </span><span class="s2">is not </span><span class="s1">other</span><span class="s3">.</span><span class="s1">rpa</span><span class="s3">:</span>
            <span class="s1">this</span><span class="s3">, </span><span class="s1">that </span><span class="s3">= (</span><span class="s4">&quot;task&quot;</span><span class="s3">, </span><span class="s4">&quot;test&quot;</span><span class="s3">) </span><span class="s2">if </span><span class="s1">other</span><span class="s3">.</span><span class="s1">rpa </span><span class="s2">else </span><span class="s3">(</span><span class="s4">&quot;test&quot;</span><span class="s3">, </span><span class="s4">&quot;task&quot;</span><span class="s3">)</span>
            <span class="s2">raise </span><span class="s1">DataError</span><span class="s3">(</span>
                <span class="s4">f&quot;Conflicting execution modes. File '</span><span class="s2">{</span><span class="s1">other</span><span class="s3">.</span><span class="s1">source</span><span class="s2">}</span><span class="s4">' has </span><span class="s2">{</span><span class="s1">this</span><span class="s2">}</span><span class="s4">s &quot;</span>
                <span class="s4">f&quot;but files parsed earlier have </span><span class="s2">{</span><span class="s1">that</span><span class="s2">}</span><span class="s4">s. Use '--rpa' or '--norpa' &quot;</span>
                <span class="s4">f&quot;options to set the execution mode explicitly.&quot;</span>
            <span class="s3">)</span>


<span class="s2">class </span><span class="s1">CombinedResult</span><span class="s3">(</span><span class="s1">Result</span><span class="s3">):</span>
    <span class="s6">&quot;&quot;&quot;Combined results of multiple test executions.&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">results</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">()</span>
        <span class="s2">for </span><span class="s1">result </span><span class="s2">in </span><span class="s1">results </span><span class="s2">or </span><span class="s3">():</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">add_result</span><span class="s3">(</span><span class="s1">result</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">add_result</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">other</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">set_execution_mode</span><span class="s3">(</span><span class="s1">other</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">.</span><span class="s1">suites</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">other</span><span class="s3">.</span><span class="s1">suite</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">errors</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">other</span><span class="s3">.</span><span class="s1">errors</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">KeywordRemover</span><span class="s3">(</span><span class="s1">SuiteVisitor</span><span class="s3">):</span>

    <span class="s2">def </span><span class="s1">start_suite</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">suite</span><span class="s3">):</span>
        <span class="s1">suite</span><span class="s3">.</span><span class="s1">setup </span><span class="s3">= </span><span class="s1">suite</span><span class="s3">.</span><span class="s1">teardown </span><span class="s3">= </span><span class="s2">None</span>

    <span class="s2">def </span><span class="s1">visit_test</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">test</span><span class="s3">):</span>
        <span class="s1">test</span><span class="s3">.</span><span class="s1">setup </span><span class="s3">= </span><span class="s1">test</span><span class="s3">.</span><span class="s1">teardown </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s1">test</span><span class="s3">.</span><span class="s1">body </span><span class="s3">= []</span>
</pre>
</body>
</html>