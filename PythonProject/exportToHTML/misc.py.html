<html>
<head>
<title>misc.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
misc.py</font>
</center></td></tr></table>
<pre><span class="s0">#  Copyright 2008-2015 Nokia Networks</span>
<span class="s0">#  Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0">#  you may not use this file except in compliance with the License.</span>
<span class="s0">#  You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="s0">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0">#  See the License for the specific language governing permissions and</span>
<span class="s0">#  limitations under the License.</span>

<span class="s2">import </span><span class="s1">re</span>

<span class="s2">from </span><span class="s3">.</span><span class="s1">unic </span><span class="s2">import </span><span class="s1">safe_str</span>


<span class="s2">def </span><span class="s1">printable_name</span><span class="s3">(</span><span class="s1">string</span><span class="s3">, </span><span class="s1">code_style</span><span class="s3">=</span><span class="s2">False</span><span class="s3">):</span>
    <span class="s4">&quot;&quot;&quot;Generates and returns printable name from the given string. 
 
    Examples: 
    'simple'           -&gt; 'Simple' 
    'name with spaces' -&gt; 'Name With Spaces' 
    'more   spaces'    -&gt; 'More Spaces' 
    'Cases AND spaces' -&gt; 'Cases AND Spaces' 
    ''                 -&gt; '' 
 
    If 'code_style' is True: 
 
    'mixedCAPSCamel'   -&gt; 'Mixed CAPS Camel' 
    'camelCaseName'    -&gt; 'Camel Case Name' 
    'under_score_name' -&gt; 'Under Score Name' 
    'under_and space'  -&gt; 'Under And Space' 
    'miXed_CAPS_nAMe'  -&gt; 'MiXed CAPS NAMe' 
    ''                 -&gt; '' 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">code_style </span><span class="s2">and </span><span class="s5">&quot;_&quot; </span><span class="s2">in </span><span class="s1">string</span><span class="s3">:</span>
        <span class="s1">string </span><span class="s3">= </span><span class="s1">string</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s5">&quot;_&quot;</span><span class="s3">, </span><span class="s5">&quot; &quot;</span><span class="s3">)</span>
    <span class="s1">parts </span><span class="s3">= </span><span class="s1">string</span><span class="s3">.</span><span class="s1">split</span><span class="s3">()</span>
    <span class="s2">if </span><span class="s1">code_style </span><span class="s2">and </span><span class="s1">len</span><span class="s3">(</span><span class="s1">parts</span><span class="s3">) == </span><span class="s6">1 </span><span class="s2">and not </span><span class="s3">(</span><span class="s1">string</span><span class="s3">.</span><span class="s1">isalpha</span><span class="s3">() </span><span class="s2">and </span><span class="s1">string</span><span class="s3">.</span><span class="s1">islower</span><span class="s3">()):</span>
        <span class="s1">parts </span><span class="s3">= </span><span class="s1">_split_camel_case</span><span class="s3">(</span><span class="s1">parts</span><span class="s3">[</span><span class="s6">0</span><span class="s3">])</span>
    <span class="s2">return </span><span class="s5">&quot; &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">part</span><span class="s3">[</span><span class="s6">0</span><span class="s3">].</span><span class="s1">upper</span><span class="s3">() + </span><span class="s1">part</span><span class="s3">[</span><span class="s6">1</span><span class="s3">:] </span><span class="s2">for </span><span class="s1">part </span><span class="s2">in </span><span class="s1">parts</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_split_camel_case</span><span class="s3">(</span><span class="s1">string</span><span class="s3">):</span>
    <span class="s1">tokens </span><span class="s3">= []</span>
    <span class="s1">token </span><span class="s3">= []</span>
    <span class="s2">for </span><span class="s1">prev</span><span class="s3">, </span><span class="s1">char</span><span class="s3">, </span><span class="s1">next </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s5">&quot; &quot; </span><span class="s3">+ </span><span class="s1">string</span><span class="s3">, </span><span class="s1">string</span><span class="s3">, </span><span class="s1">string</span><span class="s3">[</span><span class="s6">1</span><span class="s3">:] + </span><span class="s5">&quot; &quot;</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">_is_camel_case_boundary</span><span class="s3">(</span><span class="s1">prev</span><span class="s3">, </span><span class="s1">char</span><span class="s3">, </span><span class="s1">next</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">token</span><span class="s3">:</span>
                <span class="s1">tokens</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s5">&quot;&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">token</span><span class="s3">))</span>
            <span class="s1">token </span><span class="s3">= [</span><span class="s1">char</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">token</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">char</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">token</span><span class="s3">:</span>
        <span class="s1">tokens</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s5">&quot;&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">token</span><span class="s3">))</span>
    <span class="s2">return </span><span class="s1">tokens</span>


<span class="s2">def </span><span class="s1">_is_camel_case_boundary</span><span class="s3">(</span><span class="s1">prev</span><span class="s3">, </span><span class="s1">char</span><span class="s3">, </span><span class="s1">next</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">prev</span><span class="s3">.</span><span class="s1">isdigit</span><span class="s3">():</span>
        <span class="s2">return not </span><span class="s1">char</span><span class="s3">.</span><span class="s1">isdigit</span><span class="s3">()</span>
    <span class="s2">if </span><span class="s1">char</span><span class="s3">.</span><span class="s1">isupper</span><span class="s3">():</span>
        <span class="s2">return </span><span class="s1">next</span><span class="s3">.</span><span class="s1">islower</span><span class="s3">() </span><span class="s2">or </span><span class="s1">prev</span><span class="s3">.</span><span class="s1">isalpha</span><span class="s3">() </span><span class="s2">and not </span><span class="s1">prev</span><span class="s3">.</span><span class="s1">isupper</span><span class="s3">()</span>
    <span class="s2">return </span><span class="s1">char</span><span class="s3">.</span><span class="s1">isdigit</span><span class="s3">()</span>


<span class="s2">def </span><span class="s1">plural_or_not</span><span class="s3">(</span><span class="s1">item</span><span class="s3">):</span>
    <span class="s1">count </span><span class="s3">= </span><span class="s1">item </span><span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">item</span><span class="s3">, </span><span class="s1">int</span><span class="s3">) </span><span class="s2">else </span><span class="s1">len</span><span class="s3">(</span><span class="s1">item</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s5">&quot;&quot; </span><span class="s2">if </span><span class="s1">count </span><span class="s2">in </span><span class="s3">(</span><span class="s6">1</span><span class="s3">, -</span><span class="s6">1</span><span class="s3">) </span><span class="s2">else </span><span class="s5">&quot;s&quot;</span>


<span class="s2">def </span><span class="s1">seq2str</span><span class="s3">(</span><span class="s1">sequence</span><span class="s3">, </span><span class="s1">quote</span><span class="s3">=</span><span class="s5">&quot;'&quot;</span><span class="s3">, </span><span class="s1">sep</span><span class="s3">=</span><span class="s5">&quot;, &quot;</span><span class="s3">, </span><span class="s1">lastsep</span><span class="s3">=</span><span class="s5">&quot; and &quot;</span><span class="s3">):</span>
    <span class="s4">&quot;&quot;&quot;Returns sequence in format `'item 1', 'item 2' and 'item 3'`.&quot;&quot;&quot;</span>
    <span class="s1">sequence </span><span class="s3">= [</span><span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">quote</span><span class="s2">}{</span><span class="s1">safe_str</span><span class="s3">(</span><span class="s1">item</span><span class="s3">)</span><span class="s2">}{</span><span class="s1">quote</span><span class="s2">}</span><span class="s5">&quot; </span><span class="s2">for </span><span class="s1">item </span><span class="s2">in </span><span class="s1">sequence</span><span class="s3">]</span>
    <span class="s2">if not </span><span class="s1">sequence</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s5">&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">sequence</span><span class="s3">) == </span><span class="s6">1</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">sequence</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]</span>
    <span class="s1">last_two </span><span class="s3">= </span><span class="s1">lastsep</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">sequence</span><span class="s3">[-</span><span class="s6">2</span><span class="s3">:])</span>
    <span class="s2">return </span><span class="s1">sep</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">sequence</span><span class="s3">[:-</span><span class="s6">2</span><span class="s3">] + [</span><span class="s1">last_two</span><span class="s3">])</span>


<span class="s2">def </span><span class="s1">seq2str2</span><span class="s3">(</span><span class="s1">sequence</span><span class="s3">):</span>
    <span class="s4">&quot;&quot;&quot;Returns sequence in format `[ item 1 | item 2 | ... ]`.&quot;&quot;&quot;</span>
    <span class="s2">if not </span><span class="s1">sequence</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s5">&quot;[ ]&quot;</span>
    <span class="s1">items </span><span class="s3">= </span><span class="s5">&quot; | &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">safe_str</span><span class="s3">(</span><span class="s1">item</span><span class="s3">) </span><span class="s2">for </span><span class="s1">item </span><span class="s2">in </span><span class="s1">sequence</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s5">f&quot;[ </span><span class="s2">{</span><span class="s1">items</span><span class="s2">} </span><span class="s5">]&quot;</span>


<span class="s2">def </span><span class="s1">test_or_task</span><span class="s3">(</span><span class="s1">text</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">rpa</span><span class="s3">: </span><span class="s1">bool</span><span class="s3">):</span>
    <span class="s4">&quot;&quot;&quot;Replace 'test' with 'task' in the given `text` depending on `rpa`. 
 
    If given text is `test`, `test` or `task` is returned directly. Otherwise, 
    pattern `{test}` is searched from the text and occurrences replaced with 
    `test` or `task`. 
 
    In both cases matching the word `test` is case-insensitive and the returned 
    `test` or `task` has exactly same case as the original. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">replace</span><span class="s3">(</span><span class="s1">test</span><span class="s3">):</span>
        <span class="s2">if not </span><span class="s1">rpa</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">test</span>
        <span class="s1">upper </span><span class="s3">= [</span><span class="s1">c</span><span class="s3">.</span><span class="s1">isupper</span><span class="s3">() </span><span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">test</span><span class="s3">]</span>
        <span class="s2">return </span><span class="s5">&quot;&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">upper</span><span class="s3">() </span><span class="s2">if </span><span class="s1">up </span><span class="s2">else </span><span class="s1">c </span><span class="s2">for </span><span class="s1">c</span><span class="s3">, </span><span class="s1">up </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s5">&quot;task&quot;</span><span class="s3">, </span><span class="s1">upper</span><span class="s3">))</span>

    <span class="s2">if </span><span class="s1">text</span><span class="s3">.</span><span class="s1">upper</span><span class="s3">() == </span><span class="s5">&quot;TEST&quot;</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">replace</span><span class="s3">(</span><span class="s1">text</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">re</span><span class="s3">.</span><span class="s1">sub</span><span class="s3">(</span><span class="s5">&quot;{(test)}&quot;</span><span class="s3">, </span><span class="s2">lambda </span><span class="s1">m</span><span class="s3">: </span><span class="s1">replace</span><span class="s3">(</span><span class="s1">m</span><span class="s3">.</span><span class="s1">group</span><span class="s3">(</span><span class="s6">1</span><span class="s3">)), </span><span class="s1">text</span><span class="s3">, </span><span class="s1">flags</span><span class="s3">=</span><span class="s1">re</span><span class="s3">.</span><span class="s1">IGNORECASE</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">isatty</span><span class="s3">(</span><span class="s1">stream</span><span class="s3">):</span>
    <span class="s0"># first check if buffer was detached</span>
    <span class="s2">if </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">stream</span><span class="s3">, </span><span class="s5">&quot;buffer&quot;</span><span class="s3">) </span><span class="s2">and </span><span class="s1">stream</span><span class="s3">.</span><span class="s1">buffer </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s2">return False</span>
    <span class="s2">if not </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">stream</span><span class="s3">, </span><span class="s5">&quot;isatty&quot;</span><span class="s3">):</span>
        <span class="s2">return False</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">stream</span><span class="s3">.</span><span class="s1">isatty</span><span class="s3">()</span>
    <span class="s2">except </span><span class="s1">ValueError</span><span class="s3">:  </span><span class="s0"># Occurs if file is closed.</span>
        <span class="s2">return False</span>


<span class="s2">def </span><span class="s1">parse_re_flags</span><span class="s3">(</span><span class="s1">flags</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s6">0</span>
    <span class="s2">if not </span><span class="s1">flags</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">result</span>
    <span class="s2">for </span><span class="s1">flag </span><span class="s2">in </span><span class="s1">flags</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;|&quot;</span><span class="s3">):</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">re_flag </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">re</span><span class="s3">, </span><span class="s1">flag</span><span class="s3">.</span><span class="s1">upper</span><span class="s3">().</span><span class="s1">strip</span><span class="s3">())</span>
        <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s5">f&quot;Unknown regexp flag: </span><span class="s2">{</span><span class="s1">flag</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">re_flag</span><span class="s3">, </span><span class="s1">re</span><span class="s3">.</span><span class="s1">RegexFlag</span><span class="s3">):</span>
                <span class="s1">result </span><span class="s3">|= </span><span class="s1">re_flag</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s5">f&quot;Unknown regexp flag: </span><span class="s2">{</span><span class="s1">flag</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">result</span>


<span class="s2">class </span><span class="s1">classproperty</span><span class="s3">(</span><span class="s1">property</span><span class="s3">):</span>
    <span class="s4">&quot;&quot;&quot;Property that works with classes in addition to instances. 
 
    Only supports getters. Setters and deleters cannot work with classes due 
    to how the descriptor protocol works, and they are thus explicitly disabled. 
    Metaclasses must be used if they are needed. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fget</span><span class="s3">, </span><span class="s1">fset</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">fdel</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">doc</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">fset</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">setter</span><span class="s3">(</span><span class="s1">fset</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">fdel</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">deleter</span><span class="s3">(</span><span class="s1">fset</span><span class="s3">)</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">fget</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">doc</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">__doc__ </span><span class="s3">= </span><span class="s1">doc</span>

    <span class="s2">def </span><span class="s1">__get__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">instance</span><span class="s3">, </span><span class="s1">owner</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">fget</span><span class="s3">(</span><span class="s1">owner</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">setter</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fset</span><span class="s3">):</span>
        <span class="s2">raise </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;Setters are not supported.&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">deleter</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fset</span><span class="s3">):</span>
        <span class="s2">raise </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">&quot;Deleters are not supported.&quot;</span><span class="s3">)</span>
</pre>
</body>
</html>