<html>
<head>
<title>runkwregister.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
runkwregister.py</font>
</center></td></tr></table>
<pre><span class="s0">#  Copyright 2008-2015 Nokia Networks</span>
<span class="s0">#  Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0">#  you may not use this file except in compliance with the License.</span>
<span class="s0">#  You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="s0">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0">#  See the License for the specific language governing permissions and</span>
<span class="s0">#  limitations under the License.</span>

<span class="s2">import </span><span class="s1">warnings</span>

<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">utils </span><span class="s2">import </span><span class="s1">NormalizedDict</span>


<span class="s2">class </span><span class="s1">_RunKeywordRegister</span><span class="s3">:</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_libs </span><span class="s3">= {}</span>

    <span class="s2">def </span><span class="s1">register_run_keyword</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">libname</span><span class="s3">,</span>
        <span class="s1">keyword</span><span class="s3">,</span>
        <span class="s1">args_to_process</span><span class="s3">,</span>
        <span class="s1">deprecation_warning</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">dry_run</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s4">&quot;&quot;&quot;Deprecated API for registering &quot;run keyword variants&quot;. 
 
        Registered keywords are handled specially by Robot so that: 
 
        - Their arguments are not resolved normally (use ``args_to_process`` 
          to control that). This mainly means replacing variables and handling 
          escapes. 
        - They are not stopped by timeouts. 
        - If there are conflicts with keyword names, these keywords have 
          *lower* precedence than other keywords. 
 
        This API is pretty bad and will be reimplemented in the future. 
        It is thus not considered stable, but external libraries can use it 
        if they really need it and are aware of forthcoming breaking changes. 
 
        Something like this is needed at least internally also in the future. 
        For external libraries we hopefully could provide a better API for 
        running keywords so that they would not need this in the first place. 
 
        For more details see the following issues and issues linked from it: 
        https://github.com/robotframework/robotframework/issues/2190 
 
        :param libname: Name of the library the keyword belongs to. 
        :param keyword: Name of the keyword itself. 
        :param args_to_process: How many arguments to process normally before 
            passing them to the keyword. Other arguments are not touched at all. 
        :param dry_run: When true, this keyword is executed in dry run. Keywords 
            to actually run are got based on the ``name`` argument these 
            keywords must have. 
        :param deprecation_warning: Set to ``False```to avoid the warning. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">deprecation_warning</span><span class="s3">:</span>
            <span class="s1">warnings</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span>
                <span class="s5">&quot;The API to register run keyword variants and to disable variable &quot;</span>
                <span class="s5">&quot;resolving in keyword arguments will change in the future. &quot;</span>
                <span class="s5">&quot;For more information see &quot;</span>
                <span class="s5">&quot;https://github.com/robotframework/robotframework/issues/2190. &quot;</span>
                <span class="s5">&quot;Use with `deprecation_warning=False` to avoid this warning.&quot;</span><span class="s3">,</span>
                <span class="s1">UserWarning</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s2">if </span><span class="s1">libname </span><span class="s2">not in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">[</span><span class="s1">libname</span><span class="s3">] = </span><span class="s1">NormalizedDict</span><span class="s3">(</span><span class="s1">ignore</span><span class="s3">=[</span><span class="s5">&quot;_&quot;</span><span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">[</span><span class="s1">libname</span><span class="s3">][</span><span class="s1">keyword</span><span class="s3">] = (</span><span class="s1">int</span><span class="s3">(</span><span class="s1">args_to_process</span><span class="s3">), </span><span class="s1">dry_run</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">get_args_to_process</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">libname</span><span class="s3">, </span><span class="s1">kwname</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">libname </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_libs </span><span class="s2">and </span><span class="s1">kwname </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">[</span><span class="s1">libname</span><span class="s3">]:</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">[</span><span class="s1">libname</span><span class="s3">][</span><span class="s1">kwname</span><span class="s3">][</span><span class="s6">0</span><span class="s3">]</span>
        <span class="s2">return </span><span class="s3">-</span><span class="s6">1</span>

    <span class="s2">def </span><span class="s1">get_dry_run</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">libname</span><span class="s3">, </span><span class="s1">kwname</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">libname </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_libs </span><span class="s2">and </span><span class="s1">kwname </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">[</span><span class="s1">libname</span><span class="s3">]:</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">[</span><span class="s1">libname</span><span class="s3">][</span><span class="s1">kwname</span><span class="s3">][</span><span class="s6">1</span><span class="s3">]</span>
        <span class="s2">return False</span>

    <span class="s2">def </span><span class="s1">is_run_keyword</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">libname</span><span class="s3">, </span><span class="s1">kwname</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_args_to_process</span><span class="s3">(</span><span class="s1">libname</span><span class="s3">, </span><span class="s1">kwname</span><span class="s3">) &gt;= </span><span class="s6">0</span>


<span class="s1">RUN_KW_REGISTER </span><span class="s3">= </span><span class="s1">_RunKeywordRegister</span><span class="s3">()</span>
</pre>
</body>
</html>