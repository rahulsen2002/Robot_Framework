<html>
<head>
<title>testdoc.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
testdoc.py</font>
</center></td></tr></table>
<pre><span class="s0">#!/usr/bin/env python</span>

<span class="s0">#  Copyright 2008-2015 Nokia Networks</span>
<span class="s0">#  Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0">#  you may not use this file except in compliance with the License.</span>
<span class="s0">#  You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="s0">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0">#  See the License for the specific language governing permissions and</span>
<span class="s0">#  limitations under the License.</span>

<span class="s2">&quot;&quot;&quot;Module implementing the command line entry point for the `Testdoc` tool. 
 
This module can be executed from the command line using the following 
approaches:: 
 
    python -m robot.testdoc 
    python path/to/robot/testdoc.py 
 
Instead of ``python`` it is possible to use also other Python interpreters. 
 
This module also provides :func:`testdoc` and :func:`testdoc_cli` functions 
that can be used programmatically. Other code is for internal usage. 
&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">sys</span>
<span class="s3">import </span><span class="s1">time</span>
<span class="s3">from </span><span class="s1">pathlib </span><span class="s3">import </span><span class="s1">Path</span>

<span class="s3">if </span><span class="s1">__name__ </span><span class="s4">== </span><span class="s5">&quot;__main__&quot; </span><span class="s3">and </span><span class="s5">&quot;robot&quot; </span><span class="s3">not in </span><span class="s1">sys</span><span class="s4">.</span><span class="s1">modules</span><span class="s4">:</span>
    <span class="s3">from </span><span class="s1">pythonpathsetter </span><span class="s3">import </span><span class="s1">set_pythonpath</span>

    <span class="s1">set_pythonpath</span><span class="s4">()</span>

<span class="s3">from </span><span class="s1">robot</span><span class="s4">.</span><span class="s1">conf </span><span class="s3">import </span><span class="s1">RobotSettings</span>
<span class="s3">from </span><span class="s1">robot</span><span class="s4">.</span><span class="s1">htmldata </span><span class="s3">import </span><span class="s1">HtmlFileWriter</span><span class="s4">, </span><span class="s1">JsonWriter</span><span class="s4">, </span><span class="s1">ModelWriter</span><span class="s4">, </span><span class="s1">TESTDOC</span>
<span class="s3">from </span><span class="s1">robot</span><span class="s4">.</span><span class="s1">running </span><span class="s3">import </span><span class="s1">TestSuiteBuilder</span>
<span class="s3">from </span><span class="s1">robot</span><span class="s4">.</span><span class="s1">utils </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">abspath</span><span class="s4">, </span><span class="s1">Application</span><span class="s4">, </span><span class="s1">file_writer</span><span class="s4">, </span><span class="s1">get_link_path</span><span class="s4">, </span><span class="s1">html_escape</span><span class="s4">, </span><span class="s1">html_format</span><span class="s4">,</span>
    <span class="s1">is_list_like</span><span class="s4">, </span><span class="s1">secs_to_timestr</span><span class="s4">, </span><span class="s1">seq2str2</span><span class="s4">, </span><span class="s1">timestr_to_secs</span><span class="s4">, </span><span class="s1">unescape</span>
<span class="s4">)</span>

<span class="s1">USAGE </span><span class="s4">= </span><span class="s5">&quot;&quot;&quot;robot.testdoc -- Robot Framework test data documentation tool 
 
Version:  &lt;VERSION&gt; 
 
Usage:  python -m robot.testdoc [options] data_sources output_file 
 
Testdoc generates a high level test documentation based on Robot Framework 
test data. Generated documentation includes name, documentation and other 
metadata of each test suite and test case, as well as the top-level keywords 
and their arguments. 
 
Options 
======= 
 
  -T --title title       Set the title of the generated documentation. 
                         Underscores in the title are converted to spaces. 
                         The default title is the name of the top level suite. 
  -N --name name         Override the name of the top level suite. 
  -D --doc document      Override the documentation of the top level suite. 
  -M --metadata name:value *  Set/override metadata of the top level suite. 
  -G --settag tag *      Set given tag(s) to all test cases. 
  -t --test name *       Include tests by name. 
  -s --suite name *      Include suites by name. 
  -i --include tag *     Include tests by tags. 
  -e --exclude tag *     Exclude tests by tags. 
  -A --argumentfile path *  Text file to read more arguments from. Use special 
                          path `STDIN` to read contents from the standard input 
                          stream. File can have both options and data sources 
                          one per line. Contents do not need to be escaped but 
                          spaces in the beginning and end of lines are removed. 
                          Empty lines and lines starting with a hash character 
                          (#) are ignored. 
                          Example file: 
                          |  --name Example 
                          |  # This is a comment line 
                          |  my_tests.robot 
                          |  output.html 
                          Examples: 
                          --argumentfile argfile.txt --argumentfile STDIN 
  -h -? --help           Print this help. 
 
All options except --title have exactly same semantics as same options have 
when executing test cases. 
 
Execution 
========= 
 
Data can be given as a single file, directory, or as multiple files and 
directories. In all these cases, the last argument must be the file where 
to write the output. The output is always created in HTML format. 
 
Testdoc works with all interpreters supported by Robot Framework. 
It can be executed as an installed module like 
`python -m robot.testdoc` or as a script like `python path/robot/testdoc.py`. 
 
Examples: 
 
  python -m robot.testdoc my_test.robot testdoc.html 
  python path/to/robot/testdoc.py first_suite.txt second_suite.txt output.html 
 
For more information about Testdoc and other built-in tools, see 
http://robotframework.org/robotframework/#built-in-tools. 
&quot;&quot;&quot;</span>


<span class="s3">class </span><span class="s1">TestDoc</span><span class="s4">(</span><span class="s1">Application</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">Application</span><span class="s4">.</span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">USAGE</span><span class="s4">, </span><span class="s1">arg_limits</span><span class="s4">=(</span><span class="s6">2</span><span class="s4">,))</span>

    <span class="s3">def </span><span class="s1">main</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">datasources</span><span class="s4">, </span><span class="s1">title</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, **</span><span class="s1">options</span><span class="s4">):</span>
        <span class="s1">outfile </span><span class="s4">= </span><span class="s1">abspath</span><span class="s4">(</span><span class="s1">datasources</span><span class="s4">.</span><span class="s1">pop</span><span class="s4">())</span>
        <span class="s1">suite </span><span class="s4">= </span><span class="s1">TestSuiteFactory</span><span class="s4">(</span><span class="s1">datasources</span><span class="s4">, **</span><span class="s1">options</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_write_test_doc</span><span class="s4">(</span><span class="s1">suite</span><span class="s4">, </span><span class="s1">outfile</span><span class="s4">, </span><span class="s1">title</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">console</span><span class="s4">(</span><span class="s1">outfile</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_write_test_doc</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">suite</span><span class="s4">, </span><span class="s1">outfile</span><span class="s4">, </span><span class="s1">title</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">file_writer</span><span class="s4">(</span><span class="s1">outfile</span><span class="s4">, </span><span class="s1">usage</span><span class="s4">=</span><span class="s5">&quot;Testdoc output&quot;</span><span class="s4">) </span><span class="s3">as </span><span class="s1">output</span><span class="s4">:</span>
            <span class="s1">model_writer </span><span class="s4">= </span><span class="s1">TestdocModelWriter</span><span class="s4">(</span><span class="s1">output</span><span class="s4">, </span><span class="s1">suite</span><span class="s4">, </span><span class="s1">title</span><span class="s4">)</span>
            <span class="s1">HtmlFileWriter</span><span class="s4">(</span><span class="s1">output</span><span class="s4">, </span><span class="s1">model_writer</span><span class="s4">).</span><span class="s1">write</span><span class="s4">(</span><span class="s1">TESTDOC</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">TestSuiteFactory</span><span class="s4">(</span><span class="s1">datasources</span><span class="s4">, **</span><span class="s1">options</span><span class="s4">):</span>
    <span class="s1">settings </span><span class="s4">= </span><span class="s1">RobotSettings</span><span class="s4">(</span><span class="s1">options</span><span class="s4">)</span>
    <span class="s3">if not </span><span class="s1">is_list_like</span><span class="s4">(</span><span class="s1">datasources</span><span class="s4">):</span>
        <span class="s1">datasources </span><span class="s4">= [</span><span class="s1">datasources</span><span class="s4">]</span>
    <span class="s1">suite </span><span class="s4">= </span><span class="s1">TestSuiteBuilder</span><span class="s4">(</span><span class="s1">process_curdir</span><span class="s4">=</span><span class="s3">False</span><span class="s4">).</span><span class="s1">build</span><span class="s4">(*</span><span class="s1">datasources</span><span class="s4">)</span>
    <span class="s1">suite</span><span class="s4">.</span><span class="s1">configure</span><span class="s4">(**</span><span class="s1">settings</span><span class="s4">.</span><span class="s1">suite_config</span><span class="s4">)</span>
    <span class="s3">return </span><span class="s1">suite</span>


<span class="s3">class </span><span class="s1">TestdocModelWriter</span><span class="s4">(</span><span class="s1">ModelWriter</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">output</span><span class="s4">, </span><span class="s1">suite</span><span class="s4">, </span><span class="s1">title</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_output </span><span class="s4">= </span><span class="s1">output</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_output_path </span><span class="s4">= </span><span class="s1">getattr</span><span class="s4">(</span><span class="s1">output</span><span class="s4">, </span><span class="s5">&quot;name&quot;</span><span class="s4">, </span><span class="s3">None</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_suite </span><span class="s4">= </span><span class="s1">suite</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_title </span><span class="s4">= </span><span class="s1">title</span><span class="s4">.</span><span class="s1">replace</span><span class="s4">(</span><span class="s5">&quot;_&quot;</span><span class="s4">, </span><span class="s5">&quot; &quot;</span><span class="s4">) </span><span class="s3">if </span><span class="s1">title </span><span class="s3">else </span><span class="s1">suite</span><span class="s4">.</span><span class="s1">name</span>

    <span class="s3">def </span><span class="s1">write</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">line</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_output</span><span class="s4">.</span><span class="s1">write</span><span class="s4">(</span><span class="s5">'&lt;script type=&quot;text/javascript&quot;&gt;</span><span class="s3">\n</span><span class="s5">'</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">write_data</span><span class="s4">()</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_output</span><span class="s4">.</span><span class="s1">write</span><span class="s4">(</span><span class="s5">&quot;&lt;/script&gt;</span><span class="s3">\n</span><span class="s5">&quot;</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">write_data</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">model </span><span class="s4">= {</span>
            <span class="s5">&quot;suite&quot;</span><span class="s4">: </span><span class="s1">JsonConverter</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_output_path</span><span class="s4">).</span><span class="s1">convert</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_suite</span><span class="s4">),</span>
            <span class="s5">&quot;title&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_title</span><span class="s4">,</span>
            <span class="s5">&quot;generated&quot;</span><span class="s4">: </span><span class="s1">int</span><span class="s4">(</span><span class="s1">time</span><span class="s4">.</span><span class="s1">time</span><span class="s4">() * </span><span class="s6">1000</span><span class="s4">),</span>
        <span class="s4">}</span>
        <span class="s1">JsonWriter</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_output</span><span class="s4">).</span><span class="s1">write_json</span><span class="s4">(</span><span class="s5">&quot;testdoc = &quot;</span><span class="s4">, </span><span class="s1">model</span><span class="s4">)</span>


<span class="s3">class </span><span class="s1">JsonConverter</span><span class="s4">:</span>

    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">output_path</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_output_path </span><span class="s4">= </span><span class="s1">output_path</span>

    <span class="s3">def </span><span class="s1">convert</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">suite</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_suite</span><span class="s4">(</span><span class="s1">suite</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_convert_suite</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">suite</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s4">{</span>
            <span class="s5">&quot;source&quot;</span><span class="s4">: </span><span class="s1">str</span><span class="s4">(</span><span class="s1">suite</span><span class="s4">.</span><span class="s1">source </span><span class="s3">or </span><span class="s5">&quot;&quot;</span><span class="s4">),</span>
            <span class="s5">&quot;relativeSource&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_get_relative_source</span><span class="s4">(</span><span class="s1">suite</span><span class="s4">.</span><span class="s1">source</span><span class="s4">),</span>
            <span class="s5">&quot;id&quot;</span><span class="s4">: </span><span class="s1">suite</span><span class="s4">.</span><span class="s1">id</span><span class="s4">,</span>
            <span class="s5">&quot;name&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">suite</span><span class="s4">.</span><span class="s1">name</span><span class="s4">),</span>
            <span class="s5">&quot;fullName&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">suite</span><span class="s4">.</span><span class="s1">full_name</span><span class="s4">),</span>
            <span class="s5">&quot;doc&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_html</span><span class="s4">(</span><span class="s1">suite</span><span class="s4">.</span><span class="s1">doc</span><span class="s4">),</span>
            <span class="s5">&quot;metadata&quot;</span><span class="s4">: [</span>
                <span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">name</span><span class="s4">), </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_html</span><span class="s4">(</span><span class="s1">value</span><span class="s4">))</span>
                <span class="s3">for </span><span class="s1">name</span><span class="s4">, </span><span class="s1">value </span><span class="s3">in </span><span class="s1">suite</span><span class="s4">.</span><span class="s1">metadata</span><span class="s4">.</span><span class="s1">items</span><span class="s4">()</span>
            <span class="s4">],</span>
            <span class="s5">&quot;numberOfTests&quot;</span><span class="s4">: </span><span class="s1">suite</span><span class="s4">.</span><span class="s1">test_count</span><span class="s4">,</span>
            <span class="s5">&quot;suites&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_suites</span><span class="s4">(</span><span class="s1">suite</span><span class="s4">),</span>
            <span class="s5">&quot;tests&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_tests</span><span class="s4">(</span><span class="s1">suite</span><span class="s4">),</span>
            <span class="s5">&quot;keywords&quot;</span><span class="s4">: </span><span class="s1">list</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_keywords</span><span class="s4">((</span><span class="s1">suite</span><span class="s4">.</span><span class="s1">setup</span><span class="s4">, </span><span class="s1">suite</span><span class="s4">.</span><span class="s1">teardown</span><span class="s4">))),</span>
        <span class="s4">}</span>

    <span class="s3">def </span><span class="s1">_get_relative_source</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">source</span><span class="s4">):</span>
        <span class="s3">if not </span><span class="s1">source </span><span class="s3">or not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_output_path</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s5">&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">get_link_path</span><span class="s4">(</span><span class="s1">source</span><span class="s4">, </span><span class="s1">Path</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_output_path</span><span class="s4">).</span><span class="s1">parent</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">item</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">html_escape</span><span class="s4">(</span><span class="s1">item</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_html</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">item</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">html_format</span><span class="s4">(</span><span class="s1">unescape</span><span class="s4">(</span><span class="s1">item</span><span class="s4">))</span>

    <span class="s3">def </span><span class="s1">_convert_suites</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">suite</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s4">[</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_suite</span><span class="s4">(</span><span class="s1">s</span><span class="s4">) </span><span class="s3">for </span><span class="s1">s </span><span class="s3">in </span><span class="s1">suite</span><span class="s4">.</span><span class="s1">suites</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">_convert_tests</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">suite</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s4">[</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_test</span><span class="s4">(</span><span class="s1">t</span><span class="s4">) </span><span class="s3">for </span><span class="s1">t </span><span class="s3">in </span><span class="s1">suite</span><span class="s4">.</span><span class="s1">tests</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">_convert_test</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">test</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">test</span><span class="s4">.</span><span class="s1">setup</span><span class="s4">:</span>
            <span class="s1">test</span><span class="s4">.</span><span class="s1">body</span><span class="s4">.</span><span class="s1">insert</span><span class="s4">(</span><span class="s6">0</span><span class="s4">, </span><span class="s1">test</span><span class="s4">.</span><span class="s1">setup</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">test</span><span class="s4">.</span><span class="s1">teardown</span><span class="s4">:</span>
            <span class="s1">test</span><span class="s4">.</span><span class="s1">body</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">test</span><span class="s4">.</span><span class="s1">teardown</span><span class="s4">)</span>
        <span class="s3">return </span><span class="s4">{</span>
            <span class="s5">&quot;name&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">test</span><span class="s4">.</span><span class="s1">name</span><span class="s4">),</span>
            <span class="s5">&quot;fullName&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">test</span><span class="s4">.</span><span class="s1">full_name</span><span class="s4">),</span>
            <span class="s5">&quot;id&quot;</span><span class="s4">: </span><span class="s1">test</span><span class="s4">.</span><span class="s1">id</span><span class="s4">,</span>
            <span class="s5">&quot;doc&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_html</span><span class="s4">(</span><span class="s1">test</span><span class="s4">.</span><span class="s1">doc</span><span class="s4">),</span>
            <span class="s5">&quot;tags&quot;</span><span class="s4">: [</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">t</span><span class="s4">) </span><span class="s3">for </span><span class="s1">t </span><span class="s3">in </span><span class="s1">test</span><span class="s4">.</span><span class="s1">tags</span><span class="s4">],</span>
            <span class="s5">&quot;timeout&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_get_timeout</span><span class="s4">(</span><span class="s1">test</span><span class="s4">.</span><span class="s1">timeout</span><span class="s4">),</span>
            <span class="s5">&quot;keywords&quot;</span><span class="s4">: </span><span class="s1">list</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_keywords</span><span class="s4">(</span><span class="s1">test</span><span class="s4">.</span><span class="s1">body</span><span class="s4">)),</span>
        <span class="s4">}</span>

    <span class="s3">def </span><span class="s1">_convert_keywords</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">keywords</span><span class="s4">):</span>
        <span class="s3">for </span><span class="s1">kw </span><span class="s3">in </span><span class="s1">keywords</span><span class="s4">:</span>
            <span class="s3">if not </span><span class="s1">kw</span><span class="s4">:</span>
                <span class="s3">continue</span>
            <span class="s3">if </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">type </span><span class="s3">in </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">KEYWORD_TYPES</span><span class="s4">:</span>
                <span class="s3">yield </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_keyword</span><span class="s4">(</span><span class="s1">kw</span><span class="s4">)</span>
            <span class="s3">elif </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">type </span><span class="s4">== </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">FOR</span><span class="s4">:</span>
                <span class="s3">yield </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_for</span><span class="s4">(</span><span class="s1">kw</span><span class="s4">)</span>
            <span class="s3">elif </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">type </span><span class="s4">== </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">WHILE</span><span class="s4">:</span>
                <span class="s3">yield </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_while</span><span class="s4">(</span><span class="s1">kw</span><span class="s4">)</span>
            <span class="s3">elif </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">type </span><span class="s4">== </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">IF_ELSE_ROOT</span><span class="s4">:</span>
                <span class="s3">yield from </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_if</span><span class="s4">(</span><span class="s1">kw</span><span class="s4">)</span>
            <span class="s3">elif </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">type </span><span class="s4">== </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">TRY_EXCEPT_ROOT</span><span class="s4">:</span>
                <span class="s3">yield from </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_try</span><span class="s4">(</span><span class="s1">kw</span><span class="s4">)</span>
            <span class="s3">elif </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">type </span><span class="s4">== </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">VAR</span><span class="s4">:</span>
                <span class="s3">yield </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_convert_var</span><span class="s4">(</span><span class="s1">kw</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_convert_for</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">data</span><span class="s4">):</span>
        <span class="s1">name </span><span class="s4">= </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s5">', '</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">data</span><span class="s4">.</span><span class="s1">assign</span><span class="s4">)</span><span class="s3">} {</span><span class="s1">data</span><span class="s4">.</span><span class="s1">flavor</span><span class="s3">} {</span><span class="s1">seq2str2</span><span class="s4">(</span><span class="s1">data</span><span class="s4">.</span><span class="s1">values</span><span class="s4">)</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s3">return </span><span class="s4">{</span><span class="s5">&quot;type&quot;</span><span class="s4">: </span><span class="s5">&quot;FOR&quot;</span><span class="s4">, </span><span class="s5">&quot;name&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">name</span><span class="s4">), </span><span class="s5">&quot;arguments&quot;</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">}</span>

    <span class="s3">def </span><span class="s1">_convert_while</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">data</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s4">{</span><span class="s5">&quot;type&quot;</span><span class="s4">: </span><span class="s5">&quot;WHILE&quot;</span><span class="s4">, </span><span class="s5">&quot;name&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">data</span><span class="s4">.</span><span class="s1">condition</span><span class="s4">), </span><span class="s5">&quot;arguments&quot;</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">}</span>

    <span class="s3">def </span><span class="s1">_convert_if</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">data</span><span class="s4">):</span>
        <span class="s3">for </span><span class="s1">branch </span><span class="s3">in </span><span class="s1">data</span><span class="s4">.</span><span class="s1">body</span><span class="s4">:</span>
            <span class="s3">yield </span><span class="s4">{</span>
                <span class="s5">&quot;type&quot;</span><span class="s4">: </span><span class="s1">branch</span><span class="s4">.</span><span class="s1">type</span><span class="s4">,</span>
                <span class="s5">&quot;name&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">branch</span><span class="s4">.</span><span class="s1">condition </span><span class="s3">or </span><span class="s5">&quot;&quot;</span><span class="s4">),</span>
                <span class="s5">&quot;arguments&quot;</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
            <span class="s4">}</span>

    <span class="s3">def </span><span class="s1">_convert_try</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">data</span><span class="s4">):</span>
        <span class="s3">for </span><span class="s1">branch </span><span class="s3">in </span><span class="s1">data</span><span class="s4">.</span><span class="s1">body</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">branch</span><span class="s4">.</span><span class="s1">type </span><span class="s4">== </span><span class="s1">branch</span><span class="s4">.</span><span class="s1">EXCEPT</span><span class="s4">:</span>
                <span class="s1">patterns </span><span class="s4">= </span><span class="s5">&quot;, &quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">branch</span><span class="s4">.</span><span class="s1">patterns</span><span class="s4">)</span>
                <span class="s1">as_var </span><span class="s4">= </span><span class="s5">f&quot;AS </span><span class="s3">{</span><span class="s1">branch</span><span class="s4">.</span><span class="s1">assign</span><span class="s3">}</span><span class="s5">&quot; </span><span class="s3">if </span><span class="s1">branch</span><span class="s4">.</span><span class="s1">assign </span><span class="s3">else </span><span class="s5">&quot;&quot;</span>
                <span class="s1">name </span><span class="s4">= </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">patterns</span><span class="s3">} {</span><span class="s1">as_var</span><span class="s3">}</span><span class="s5">&quot;</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">()</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s1">name </span><span class="s4">= </span><span class="s5">&quot;&quot;</span>
            <span class="s3">yield </span><span class="s4">{</span><span class="s5">&quot;type&quot;</span><span class="s4">: </span><span class="s1">branch</span><span class="s4">.</span><span class="s1">type</span><span class="s4">, </span><span class="s5">&quot;name&quot;</span><span class="s4">: </span><span class="s1">name</span><span class="s4">, </span><span class="s5">&quot;arguments&quot;</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">}</span>

    <span class="s3">def </span><span class="s1">_convert_var</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">data</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">data</span><span class="s4">.</span><span class="s1">name</span><span class="s4">[</span><span class="s6">0</span><span class="s4">] == </span><span class="s5">&quot;$&quot; </span><span class="s3">and </span><span class="s1">len</span><span class="s4">(</span><span class="s1">data</span><span class="s4">.</span><span class="s1">value</span><span class="s4">) == </span><span class="s6">1</span><span class="s4">:</span>
            <span class="s1">value </span><span class="s4">= </span><span class="s1">data</span><span class="s4">.</span><span class="s1">value</span><span class="s4">[</span><span class="s6">0</span><span class="s4">]</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">value </span><span class="s4">= </span><span class="s5">&quot;[&quot; </span><span class="s4">+ </span><span class="s5">&quot;, &quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">data</span><span class="s4">.</span><span class="s1">value</span><span class="s4">) + </span><span class="s5">&quot;]&quot;</span>
        <span class="s3">return </span><span class="s4">{</span><span class="s5">&quot;type&quot;</span><span class="s4">: </span><span class="s5">&quot;VAR&quot;</span><span class="s4">, </span><span class="s5">&quot;name&quot;</span><span class="s4">: </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">data</span><span class="s4">.</span><span class="s1">name</span><span class="s3">} </span><span class="s5">= </span><span class="s3">{</span><span class="s1">value</span><span class="s3">}</span><span class="s5">&quot;</span><span class="s4">}</span>

    <span class="s3">def </span><span class="s1">_convert_keyword</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">kw</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s4">{</span>
            <span class="s5">&quot;type&quot;</span><span class="s4">: </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">type</span><span class="s4">,</span>
            <span class="s5">&quot;name&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_get_kw_name</span><span class="s4">(</span><span class="s1">kw</span><span class="s4">)),</span>
            <span class="s5">&quot;arguments&quot;</span><span class="s4">: </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_escape</span><span class="s4">(</span><span class="s5">&quot;, &quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">kw</span><span class="s4">.</span><span class="s1">args</span><span class="s4">)),</span>
        <span class="s4">}</span>

    <span class="s3">def </span><span class="s1">_get_kw_name</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">kw</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">assign</span><span class="s4">:</span>
            <span class="s1">assign </span><span class="s4">= </span><span class="s5">&quot;, &quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">a</span><span class="s4">.</span><span class="s1">rstrip</span><span class="s4">(</span><span class="s5">&quot;= &quot;</span><span class="s4">) </span><span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">assign</span><span class="s4">)</span>
            <span class="s3">return </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">assign</span><span class="s3">} </span><span class="s5">= </span><span class="s3">{</span><span class="s1">kw</span><span class="s4">.</span><span class="s1">name</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s3">return </span><span class="s1">kw</span><span class="s4">.</span><span class="s1">name</span>

    <span class="s3">def </span><span class="s1">_get_timeout</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">timeout </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s5">&quot;&quot;</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">tout </span><span class="s4">= </span><span class="s1">secs_to_timestr</span><span class="s4">(</span><span class="s1">timestr_to_secs</span><span class="s4">(</span><span class="s1">timeout</span><span class="s4">))</span>
        <span class="s3">except </span><span class="s1">ValueError</span><span class="s4">:</span>
            <span class="s1">tout </span><span class="s4">= </span><span class="s1">timeout</span>
        <span class="s3">return </span><span class="s1">tout</span>


<span class="s3">def </span><span class="s1">testdoc_cli</span><span class="s4">(</span><span class="s1">arguments</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Executes `Testdoc` similarly as from the command line. 
 
    :param arguments: command line arguments as a list of strings. 
 
    For programmatic usage the :func:`testdoc` function is typically better. It 
    has a better API for that and does not call :func:`sys.exit` like 
    this function. 
 
    Example:: 
 
        from robot.testdoc import testdoc_cli 
 
        testdoc_cli(['--title', 'Test Plan', 'mytests', 'plan.html']) 
    &quot;&quot;&quot;</span>
    <span class="s1">TestDoc</span><span class="s4">().</span><span class="s1">execute_cli</span><span class="s4">(</span><span class="s1">arguments</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">testdoc</span><span class="s4">(*</span><span class="s1">arguments</span><span class="s4">, **</span><span class="s1">options</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Executes `Testdoc` programmatically. 
 
    Arguments and options have same semantics, and options have same names, 
    as arguments and options to Testdoc. 
 
    Example:: 
 
        from robot.testdoc import testdoc 
 
        testdoc('mytests', 'plan.html', title='Test Plan') 
    &quot;&quot;&quot;</span>
    <span class="s1">TestDoc</span><span class="s4">().</span><span class="s1">execute</span><span class="s4">(*</span><span class="s1">arguments</span><span class="s4">, **</span><span class="s1">options</span><span class="s4">)</span>


<span class="s3">if </span><span class="s1">__name__ </span><span class="s4">== </span><span class="s5">&quot;__main__&quot;</span><span class="s4">:</span>
    <span class="s1">testdoc_cli</span><span class="s4">(</span><span class="s1">sys</span><span class="s4">.</span><span class="s1">argv</span><span class="s4">[</span><span class="s6">1</span><span class="s4">:])</span>
</pre>
</body>
</html>