<html>
<head>
<title>req_command.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #7a7e85;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
req_command.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Contains the RequirementCommand base class. 
 
This class is in a separate module so the commands that do not always 
need PackageFinder capability don't unnecessarily import the 
PackageFinder machinery and all its vendored dependencies, etc. 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">__future__ </span><span class="s2">import </span><span class="s1">annotations</span>

<span class="s2">import </span><span class="s1">logging</span>
<span class="s2">from </span><span class="s1">functools </span><span class="s2">import </span><span class="s1">partial</span>
<span class="s2">from </span><span class="s1">optparse </span><span class="s2">import </span><span class="s1">Values</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Any</span>

<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">build_env </span><span class="s2">import </span><span class="s1">SubprocessBuildEnvironmentInstaller</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">cache </span><span class="s2">import </span><span class="s1">WheelCache</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">cli </span><span class="s2">import </span><span class="s1">cmdoptions</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">cli</span><span class="s3">.</span><span class="s1">index_command </span><span class="s2">import </span><span class="s1">IndexGroupCommand</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">cli</span><span class="s3">.</span><span class="s1">index_command </span><span class="s2">import </span><span class="s1">SessionCommandMixin </span><span class="s2">as </span><span class="s1">SessionCommandMixin</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">exceptions </span><span class="s2">import </span><span class="s1">CommandError</span><span class="s3">, </span><span class="s1">PreviousBuildDirError</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">index</span><span class="s3">.</span><span class="s1">collector </span><span class="s2">import </span><span class="s1">LinkCollector</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">index</span><span class="s3">.</span><span class="s1">package_finder </span><span class="s2">import </span><span class="s1">PackageFinder</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">models</span><span class="s3">.</span><span class="s1">selection_prefs </span><span class="s2">import </span><span class="s1">SelectionPreferences</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">models</span><span class="s3">.</span><span class="s1">target_python </span><span class="s2">import </span><span class="s1">TargetPython</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">network</span><span class="s3">.</span><span class="s1">session </span><span class="s2">import </span><span class="s1">PipSession</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">operations</span><span class="s3">.</span><span class="s1">build</span><span class="s3">.</span><span class="s1">build_tracker </span><span class="s2">import </span><span class="s1">BuildTracker</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">operations</span><span class="s3">.</span><span class="s1">prepare </span><span class="s2">import </span><span class="s1">RequirementPreparer</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">req</span><span class="s3">.</span><span class="s1">constructors </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">install_req_from_editable</span><span class="s3">,</span>
    <span class="s1">install_req_from_line</span><span class="s3">,</span>
    <span class="s1">install_req_from_parsed_requirement</span><span class="s3">,</span>
    <span class="s1">install_req_from_req_string</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">req</span><span class="s3">.</span><span class="s1">req_dependency_group </span><span class="s2">import </span><span class="s1">parse_dependency_groups</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">req</span><span class="s3">.</span><span class="s1">req_file </span><span class="s2">import </span><span class="s1">parse_requirements</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">req</span><span class="s3">.</span><span class="s1">req_install </span><span class="s2">import </span><span class="s1">InstallRequirement</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">resolution</span><span class="s3">.</span><span class="s1">base </span><span class="s2">import </span><span class="s1">BaseResolver</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">utils</span><span class="s3">.</span><span class="s1">temp_dir </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">TempDirectory</span><span class="s3">,</span>
    <span class="s1">TempDirectoryTypeRegistry</span><span class="s3">,</span>
    <span class="s1">tempdir_kinds</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s1">logger </span><span class="s3">= </span><span class="s1">logging</span><span class="s3">.</span><span class="s1">getLogger</span><span class="s3">(</span><span class="s1">__name__</span><span class="s3">)</span>


<span class="s1">KEEPABLE_TEMPDIR_TYPES </span><span class="s3">= [</span>
    <span class="s1">tempdir_kinds</span><span class="s3">.</span><span class="s1">BUILD_ENV</span><span class="s3">,</span>
    <span class="s1">tempdir_kinds</span><span class="s3">.</span><span class="s1">EPHEM_WHEEL_CACHE</span><span class="s3">,</span>
    <span class="s1">tempdir_kinds</span><span class="s3">.</span><span class="s1">REQ_BUILD</span><span class="s3">,</span>
<span class="s3">]</span>


<span class="s2">def </span><span class="s1">with_cleanup</span><span class="s3">(</span><span class="s1">func</span><span class="s3">: </span><span class="s1">Any</span><span class="s3">) </span><span class="s1">-&gt; Any</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Decorator for common logic related to managing temporary 
    directories. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">configure_tempdir_registry</span><span class="s3">(</span><span class="s1">registry</span><span class="s3">: </span><span class="s1">TempDirectoryTypeRegistry</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">for </span><span class="s1">t </span><span class="s2">in </span><span class="s1">KEEPABLE_TEMPDIR_TYPES</span><span class="s3">:</span>
            <span class="s1">registry</span><span class="s3">.</span><span class="s1">set_delete</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s2">False</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">wrapper</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">: </span><span class="s1">RequirementCommand</span><span class="s3">, </span><span class="s1">options</span><span class="s3">: </span><span class="s1">Values</span><span class="s3">, </span><span class="s1">args</span><span class="s3">: </span><span class="s1">list</span><span class="s3">[</span><span class="s1">Any</span><span class="s3">]</span>
    <span class="s3">) </span><span class="s1">-&gt; int </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">assert </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tempdir_registry </span><span class="s2">is not None</span>
        <span class="s2">if </span><span class="s1">options</span><span class="s3">.</span><span class="s1">no_clean</span><span class="s3">:</span>
            <span class="s1">configure_tempdir_registry</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tempdir_registry</span><span class="s3">)</span>

        <span class="s2">try</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">func</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">options</span><span class="s3">, </span><span class="s1">args</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s1">PreviousBuildDirError</span><span class="s3">:</span>
            <span class="s4"># This kind of conflict can occur when the user passes an explicit</span>
            <span class="s4"># build directory with a pre-existing folder. In that case we do</span>
            <span class="s4"># not want to accidentally remove it.</span>
            <span class="s1">configure_tempdir_registry</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tempdir_registry</span><span class="s3">)</span>
            <span class="s2">raise</span>

    <span class="s2">return </span><span class="s1">wrapper</span>


<span class="s2">class </span><span class="s1">RequirementCommand</span><span class="s3">(</span><span class="s1">IndexGroupCommand</span><span class="s3">):</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">: </span><span class="s1">Any</span><span class="s3">, **</span><span class="s1">kw</span><span class="s3">: </span><span class="s1">Any</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kw</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">cmd_opts</span><span class="s3">.</span><span class="s1">add_option</span><span class="s3">(</span><span class="s1">cmdoptions</span><span class="s3">.</span><span class="s1">dependency_groups</span><span class="s3">())</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">cmd_opts</span><span class="s3">.</span><span class="s1">add_option</span><span class="s3">(</span><span class="s1">cmdoptions</span><span class="s3">.</span><span class="s1">no_clean</span><span class="s3">())</span>

    <span class="s3">@</span><span class="s1">staticmethod</span>
    <span class="s2">def </span><span class="s1">determine_resolver_variant</span><span class="s3">(</span><span class="s1">options</span><span class="s3">: </span><span class="s1">Values</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Determines which resolver should be used, based on the given options.&quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s5">&quot;legacy-resolver&quot; </span><span class="s2">in </span><span class="s1">options</span><span class="s3">.</span><span class="s1">deprecated_features_enabled</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s5">&quot;legacy&quot;</span>

        <span class="s2">return </span><span class="s5">&quot;resolvelib&quot;</span>

    <span class="s3">@</span><span class="s1">classmethod</span>
    <span class="s2">def </span><span class="s1">make_requirement_preparer</span><span class="s3">(</span>
        <span class="s1">cls</span><span class="s3">,</span>
        <span class="s1">temp_build_dir</span><span class="s3">: </span><span class="s1">TempDirectory</span><span class="s3">,</span>
        <span class="s1">options</span><span class="s3">: </span><span class="s1">Values</span><span class="s3">,</span>
        <span class="s1">build_tracker</span><span class="s3">: </span><span class="s1">BuildTracker</span><span class="s3">,</span>
        <span class="s1">session</span><span class="s3">: </span><span class="s1">PipSession</span><span class="s3">,</span>
        <span class="s1">finder</span><span class="s3">: </span><span class="s1">PackageFinder</span><span class="s3">,</span>
        <span class="s1">use_user_site</span><span class="s3">: </span><span class="s1">bool</span><span class="s3">,</span>
        <span class="s1">download_dir</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">verbosity</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= </span><span class="s6">0</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; RequirementPreparer</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Create a RequirementPreparer instance for the given parameters. 
        &quot;&quot;&quot;</span>
        <span class="s1">temp_build_dir_path </span><span class="s3">= </span><span class="s1">temp_build_dir</span><span class="s3">.</span><span class="s1">path</span>
        <span class="s2">assert </span><span class="s1">temp_build_dir_path </span><span class="s2">is not None</span>
        <span class="s1">legacy_resolver </span><span class="s3">= </span><span class="s2">False</span>

        <span class="s1">resolver_variant </span><span class="s3">= </span><span class="s1">cls</span><span class="s3">.</span><span class="s1">determine_resolver_variant</span><span class="s3">(</span><span class="s1">options</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">resolver_variant </span><span class="s3">== </span><span class="s5">&quot;resolvelib&quot;</span><span class="s3">:</span>
            <span class="s1">lazy_wheel </span><span class="s3">= </span><span class="s5">&quot;fast-deps&quot; </span><span class="s2">in </span><span class="s1">options</span><span class="s3">.</span><span class="s1">features_enabled</span>
            <span class="s2">if </span><span class="s1">lazy_wheel</span><span class="s3">:</span>
                <span class="s1">logger</span><span class="s3">.</span><span class="s1">warning</span><span class="s3">(</span>
                    <span class="s5">&quot;pip is using lazily downloaded wheels using HTTP &quot;</span>
                    <span class="s5">&quot;range requests to obtain dependency information. &quot;</span>
                    <span class="s5">&quot;This experimental feature is enabled through &quot;</span>
                    <span class="s5">&quot;--use-feature=fast-deps and it is not ready for &quot;</span>
                    <span class="s5">&quot;production.&quot;</span>
                <span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">legacy_resolver </span><span class="s3">= </span><span class="s2">True</span>
            <span class="s1">lazy_wheel </span><span class="s3">= </span><span class="s2">False</span>
            <span class="s2">if </span><span class="s5">&quot;fast-deps&quot; </span><span class="s2">in </span><span class="s1">options</span><span class="s3">.</span><span class="s1">features_enabled</span><span class="s3">:</span>
                <span class="s1">logger</span><span class="s3">.</span><span class="s1">warning</span><span class="s3">(</span>
                    <span class="s5">&quot;fast-deps has no effect when used with the legacy resolver.&quot;</span>
                <span class="s3">)</span>

        <span class="s2">return </span><span class="s1">RequirementPreparer</span><span class="s3">(</span>
            <span class="s1">build_dir</span><span class="s3">=</span><span class="s1">temp_build_dir_path</span><span class="s3">,</span>
            <span class="s1">src_dir</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">src_dir</span><span class="s3">,</span>
            <span class="s1">download_dir</span><span class="s3">=</span><span class="s1">download_dir</span><span class="s3">,</span>
            <span class="s1">build_isolation</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">build_isolation</span><span class="s3">,</span>
            <span class="s1">build_isolation_installer</span><span class="s3">=</span><span class="s1">SubprocessBuildEnvironmentInstaller</span><span class="s3">(</span><span class="s1">finder</span><span class="s3">),</span>
            <span class="s1">check_build_deps</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">check_build_deps</span><span class="s3">,</span>
            <span class="s1">build_tracker</span><span class="s3">=</span><span class="s1">build_tracker</span><span class="s3">,</span>
            <span class="s1">session</span><span class="s3">=</span><span class="s1">session</span><span class="s3">,</span>
            <span class="s1">progress_bar</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">progress_bar</span><span class="s3">,</span>
            <span class="s1">finder</span><span class="s3">=</span><span class="s1">finder</span><span class="s3">,</span>
            <span class="s1">require_hashes</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">require_hashes</span><span class="s3">,</span>
            <span class="s1">use_user_site</span><span class="s3">=</span><span class="s1">use_user_site</span><span class="s3">,</span>
            <span class="s1">lazy_wheel</span><span class="s3">=</span><span class="s1">lazy_wheel</span><span class="s3">,</span>
            <span class="s1">verbosity</span><span class="s3">=</span><span class="s1">verbosity</span><span class="s3">,</span>
            <span class="s1">legacy_resolver</span><span class="s3">=</span><span class="s1">legacy_resolver</span><span class="s3">,</span>
            <span class="s1">resume_retries</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">resume_retries</span><span class="s3">,</span>
        <span class="s3">)</span>

    <span class="s3">@</span><span class="s1">classmethod</span>
    <span class="s2">def </span><span class="s1">make_resolver</span><span class="s3">(</span>
        <span class="s1">cls</span><span class="s3">,</span>
        <span class="s1">preparer</span><span class="s3">: </span><span class="s1">RequirementPreparer</span><span class="s3">,</span>
        <span class="s1">finder</span><span class="s3">: </span><span class="s1">PackageFinder</span><span class="s3">,</span>
        <span class="s1">options</span><span class="s3">: </span><span class="s1">Values</span><span class="s3">,</span>
        <span class="s1">wheel_cache</span><span class="s3">: </span><span class="s1">WheelCache </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">use_user_site</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">ignore_installed</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">ignore_requires_python</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">force_reinstall</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">upgrade_strategy</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s5">&quot;to-satisfy-only&quot;</span><span class="s3">,</span>
        <span class="s1">use_pep517</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">py_version_info</span><span class="s3">: </span><span class="s1">tuple</span><span class="s3">[</span><span class="s1">int</span><span class="s3">, ...] | </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; BaseResolver</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Create a Resolver instance for the given parameters. 
        &quot;&quot;&quot;</span>
        <span class="s1">make_install_req </span><span class="s3">= </span><span class="s1">partial</span><span class="s3">(</span>
            <span class="s1">install_req_from_req_string</span><span class="s3">,</span>
            <span class="s1">isolated</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">isolated_mode</span><span class="s3">,</span>
            <span class="s1">use_pep517</span><span class="s3">=</span><span class="s1">use_pep517</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">resolver_variant </span><span class="s3">= </span><span class="s1">cls</span><span class="s3">.</span><span class="s1">determine_resolver_variant</span><span class="s3">(</span><span class="s1">options</span><span class="s3">)</span>
        <span class="s4"># The long import name and duplicated invocation is needed to convince</span>
        <span class="s4"># Mypy into correctly typechecking. Otherwise it would complain the</span>
        <span class="s4"># &quot;Resolver&quot; class being redefined.</span>
        <span class="s2">if </span><span class="s1">resolver_variant </span><span class="s3">== </span><span class="s5">&quot;resolvelib&quot;</span><span class="s3">:</span>
            <span class="s2">import </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">resolution</span><span class="s3">.</span><span class="s1">resolvelib</span><span class="s3">.</span><span class="s1">resolver</span>

            <span class="s2">return </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">resolution</span><span class="s3">.</span><span class="s1">resolvelib</span><span class="s3">.</span><span class="s1">resolver</span><span class="s3">.</span><span class="s1">Resolver</span><span class="s3">(</span>
                <span class="s1">preparer</span><span class="s3">=</span><span class="s1">preparer</span><span class="s3">,</span>
                <span class="s1">finder</span><span class="s3">=</span><span class="s1">finder</span><span class="s3">,</span>
                <span class="s1">wheel_cache</span><span class="s3">=</span><span class="s1">wheel_cache</span><span class="s3">,</span>
                <span class="s1">make_install_req</span><span class="s3">=</span><span class="s1">make_install_req</span><span class="s3">,</span>
                <span class="s1">use_user_site</span><span class="s3">=</span><span class="s1">use_user_site</span><span class="s3">,</span>
                <span class="s1">ignore_dependencies</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">ignore_dependencies</span><span class="s3">,</span>
                <span class="s1">ignore_installed</span><span class="s3">=</span><span class="s1">ignore_installed</span><span class="s3">,</span>
                <span class="s1">ignore_requires_python</span><span class="s3">=</span><span class="s1">ignore_requires_python</span><span class="s3">,</span>
                <span class="s1">force_reinstall</span><span class="s3">=</span><span class="s1">force_reinstall</span><span class="s3">,</span>
                <span class="s1">upgrade_strategy</span><span class="s3">=</span><span class="s1">upgrade_strategy</span><span class="s3">,</span>
                <span class="s1">py_version_info</span><span class="s3">=</span><span class="s1">py_version_info</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s2">import </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">resolution</span><span class="s3">.</span><span class="s1">legacy</span><span class="s3">.</span><span class="s1">resolver</span>

        <span class="s2">return </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">resolution</span><span class="s3">.</span><span class="s1">legacy</span><span class="s3">.</span><span class="s1">resolver</span><span class="s3">.</span><span class="s1">Resolver</span><span class="s3">(</span>
            <span class="s1">preparer</span><span class="s3">=</span><span class="s1">preparer</span><span class="s3">,</span>
            <span class="s1">finder</span><span class="s3">=</span><span class="s1">finder</span><span class="s3">,</span>
            <span class="s1">wheel_cache</span><span class="s3">=</span><span class="s1">wheel_cache</span><span class="s3">,</span>
            <span class="s1">make_install_req</span><span class="s3">=</span><span class="s1">make_install_req</span><span class="s3">,</span>
            <span class="s1">use_user_site</span><span class="s3">=</span><span class="s1">use_user_site</span><span class="s3">,</span>
            <span class="s1">ignore_dependencies</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">ignore_dependencies</span><span class="s3">,</span>
            <span class="s1">ignore_installed</span><span class="s3">=</span><span class="s1">ignore_installed</span><span class="s3">,</span>
            <span class="s1">ignore_requires_python</span><span class="s3">=</span><span class="s1">ignore_requires_python</span><span class="s3">,</span>
            <span class="s1">force_reinstall</span><span class="s3">=</span><span class="s1">force_reinstall</span><span class="s3">,</span>
            <span class="s1">upgrade_strategy</span><span class="s3">=</span><span class="s1">upgrade_strategy</span><span class="s3">,</span>
            <span class="s1">py_version_info</span><span class="s3">=</span><span class="s1">py_version_info</span><span class="s3">,</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">get_requirements</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">args</span><span class="s3">: </span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">],</span>
        <span class="s1">options</span><span class="s3">: </span><span class="s1">Values</span><span class="s3">,</span>
        <span class="s1">finder</span><span class="s3">: </span><span class="s1">PackageFinder</span><span class="s3">,</span>
        <span class="s1">session</span><span class="s3">: </span><span class="s1">PipSession</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">InstallRequirement</span><span class="s3">]:</span>
        <span class="s0">&quot;&quot;&quot; 
        Parse command-line arguments into the corresponding requirements. 
        &quot;&quot;&quot;</span>
        <span class="s1">requirements</span><span class="s3">: </span><span class="s1">list</span><span class="s3">[</span><span class="s1">InstallRequirement</span><span class="s3">] = []</span>
        <span class="s2">for </span><span class="s1">filename </span><span class="s2">in </span><span class="s1">options</span><span class="s3">.</span><span class="s1">constraints</span><span class="s3">:</span>
            <span class="s2">for </span><span class="s1">parsed_req </span><span class="s2">in </span><span class="s1">parse_requirements</span><span class="s3">(</span>
                <span class="s1">filename</span><span class="s3">,</span>
                <span class="s1">constraint</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
                <span class="s1">finder</span><span class="s3">=</span><span class="s1">finder</span><span class="s3">,</span>
                <span class="s1">options</span><span class="s3">=</span><span class="s1">options</span><span class="s3">,</span>
                <span class="s1">session</span><span class="s3">=</span><span class="s1">session</span><span class="s3">,</span>
            <span class="s3">):</span>
                <span class="s1">req_to_add </span><span class="s3">= </span><span class="s1">install_req_from_parsed_requirement</span><span class="s3">(</span>
                    <span class="s1">parsed_req</span><span class="s3">,</span>
                    <span class="s1">isolated</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">isolated_mode</span><span class="s3">,</span>
                    <span class="s1">user_supplied</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
                <span class="s3">)</span>
                <span class="s1">requirements</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">req_to_add</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">req </span><span class="s2">in </span><span class="s1">args</span><span class="s3">:</span>
            <span class="s1">req_to_add </span><span class="s3">= </span><span class="s1">install_req_from_line</span><span class="s3">(</span>
                <span class="s1">req</span><span class="s3">,</span>
                <span class="s1">comes_from</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
                <span class="s1">isolated</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">isolated_mode</span><span class="s3">,</span>
                <span class="s1">use_pep517</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">use_pep517</span><span class="s3">,</span>
                <span class="s1">user_supplied</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
                <span class="s1">config_settings</span><span class="s3">=</span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">options</span><span class="s3">, </span><span class="s5">&quot;config_settings&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
            <span class="s3">)</span>
            <span class="s1">requirements</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">req_to_add</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">options</span><span class="s3">.</span><span class="s1">dependency_groups</span><span class="s3">:</span>
            <span class="s2">for </span><span class="s1">req </span><span class="s2">in </span><span class="s1">parse_dependency_groups</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">dependency_groups</span><span class="s3">):</span>
                <span class="s1">req_to_add </span><span class="s3">= </span><span class="s1">install_req_from_req_string</span><span class="s3">(</span>
                    <span class="s1">req</span><span class="s3">,</span>
                    <span class="s1">isolated</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">isolated_mode</span><span class="s3">,</span>
                    <span class="s1">use_pep517</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">use_pep517</span><span class="s3">,</span>
                    <span class="s1">user_supplied</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
                <span class="s3">)</span>
                <span class="s1">requirements</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">req_to_add</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">req </span><span class="s2">in </span><span class="s1">options</span><span class="s3">.</span><span class="s1">editables</span><span class="s3">:</span>
            <span class="s1">req_to_add </span><span class="s3">= </span><span class="s1">install_req_from_editable</span><span class="s3">(</span>
                <span class="s1">req</span><span class="s3">,</span>
                <span class="s1">user_supplied</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
                <span class="s1">isolated</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">isolated_mode</span><span class="s3">,</span>
                <span class="s1">use_pep517</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">use_pep517</span><span class="s3">,</span>
                <span class="s1">config_settings</span><span class="s3">=</span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">options</span><span class="s3">, </span><span class="s5">&quot;config_settings&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
            <span class="s3">)</span>
            <span class="s1">requirements</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">req_to_add</span><span class="s3">)</span>

        <span class="s4"># NOTE: options.require_hashes may be set if --require-hashes is True</span>
        <span class="s2">for </span><span class="s1">filename </span><span class="s2">in </span><span class="s1">options</span><span class="s3">.</span><span class="s1">requirements</span><span class="s3">:</span>
            <span class="s2">for </span><span class="s1">parsed_req </span><span class="s2">in </span><span class="s1">parse_requirements</span><span class="s3">(</span>
                <span class="s1">filename</span><span class="s3">, </span><span class="s1">finder</span><span class="s3">=</span><span class="s1">finder</span><span class="s3">, </span><span class="s1">options</span><span class="s3">=</span><span class="s1">options</span><span class="s3">, </span><span class="s1">session</span><span class="s3">=</span><span class="s1">session</span>
            <span class="s3">):</span>
                <span class="s1">req_to_add </span><span class="s3">= </span><span class="s1">install_req_from_parsed_requirement</span><span class="s3">(</span>
                    <span class="s1">parsed_req</span><span class="s3">,</span>
                    <span class="s1">isolated</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">isolated_mode</span><span class="s3">,</span>
                    <span class="s1">use_pep517</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">use_pep517</span><span class="s3">,</span>
                    <span class="s1">user_supplied</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
                    <span class="s1">config_settings</span><span class="s3">=(</span>
                        <span class="s1">parsed_req</span><span class="s3">.</span><span class="s1">options</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s5">&quot;config_settings&quot;</span><span class="s3">)</span>
                        <span class="s2">if </span><span class="s1">parsed_req</span><span class="s3">.</span><span class="s1">options</span>
                        <span class="s2">else None</span>
                    <span class="s3">),</span>
                <span class="s3">)</span>
                <span class="s1">requirements</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">req_to_add</span><span class="s3">)</span>

        <span class="s4"># If any requirement has hash options, enable hash checking.</span>
        <span class="s2">if </span><span class="s1">any</span><span class="s3">(</span><span class="s1">req</span><span class="s3">.</span><span class="s1">has_hash_options </span><span class="s2">for </span><span class="s1">req </span><span class="s2">in </span><span class="s1">requirements</span><span class="s3">):</span>
            <span class="s1">options</span><span class="s3">.</span><span class="s1">require_hashes </span><span class="s3">= </span><span class="s2">True</span>

        <span class="s2">if not </span><span class="s3">(</span>
            <span class="s1">args</span>
            <span class="s2">or </span><span class="s1">options</span><span class="s3">.</span><span class="s1">editables</span>
            <span class="s2">or </span><span class="s1">options</span><span class="s3">.</span><span class="s1">requirements</span>
            <span class="s2">or </span><span class="s1">options</span><span class="s3">.</span><span class="s1">dependency_groups</span>
        <span class="s3">):</span>
            <span class="s1">opts </span><span class="s3">= {</span><span class="s5">&quot;name&quot;</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">}</span>
            <span class="s2">if </span><span class="s1">options</span><span class="s3">.</span><span class="s1">find_links</span><span class="s3">:</span>
                <span class="s2">raise </span><span class="s1">CommandError</span><span class="s3">(</span>
                    <span class="s5">&quot;You must give at least one requirement to {name} &quot;</span>
                    <span class="s5">'(maybe you meant &quot;pip {name} {links}&quot;?)'</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span>
                        <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">opts</span><span class="s3">, </span><span class="s1">links</span><span class="s3">=</span><span class="s5">&quot; &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">find_links</span><span class="s3">))</span>
                    <span class="s3">)</span>
                <span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s2">raise </span><span class="s1">CommandError</span><span class="s3">(</span>
                    <span class="s5">&quot;You must give at least one requirement to {name} &quot;</span>
                    <span class="s5">'(see &quot;pip help {name}&quot;)'</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(**</span><span class="s1">opts</span><span class="s3">)</span>
                <span class="s3">)</span>

        <span class="s2">return </span><span class="s1">requirements</span>

    <span class="s3">@</span><span class="s1">staticmethod</span>
    <span class="s2">def </span><span class="s1">trace_basic_info</span><span class="s3">(</span><span class="s1">finder</span><span class="s3">: </span><span class="s1">PackageFinder</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Trace basic information about the provided objects. 
        &quot;&quot;&quot;</span>
        <span class="s4"># Display where finder is looking for packages</span>
        <span class="s1">search_scope </span><span class="s3">= </span><span class="s1">finder</span><span class="s3">.</span><span class="s1">search_scope</span>
        <span class="s1">locations </span><span class="s3">= </span><span class="s1">search_scope</span><span class="s3">.</span><span class="s1">get_formatted_locations</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s1">locations</span><span class="s3">:</span>
            <span class="s1">logger</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s1">locations</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_build_package_finder</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">options</span><span class="s3">: </span><span class="s1">Values</span><span class="s3">,</span>
        <span class="s1">session</span><span class="s3">: </span><span class="s1">PipSession</span><span class="s3">,</span>
        <span class="s1">target_python</span><span class="s3">: </span><span class="s1">TargetPython </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">ignore_requires_python</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; PackageFinder</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Create a package finder appropriate to this requirement command. 
 
        :param ignore_requires_python: Whether to ignore incompatible 
            &quot;Requires-Python&quot; values in links. Defaults to False. 
        &quot;&quot;&quot;</span>
        <span class="s1">link_collector </span><span class="s3">= </span><span class="s1">LinkCollector</span><span class="s3">.</span><span class="s1">create</span><span class="s3">(</span><span class="s1">session</span><span class="s3">, </span><span class="s1">options</span><span class="s3">=</span><span class="s1">options</span><span class="s3">)</span>
        <span class="s1">selection_prefs </span><span class="s3">= </span><span class="s1">SelectionPreferences</span><span class="s3">(</span>
            <span class="s1">allow_yanked</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
            <span class="s1">format_control</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">format_control</span><span class="s3">,</span>
            <span class="s1">allow_all_prereleases</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">pre</span><span class="s3">,</span>
            <span class="s1">prefer_binary</span><span class="s3">=</span><span class="s1">options</span><span class="s3">.</span><span class="s1">prefer_binary</span><span class="s3">,</span>
            <span class="s1">ignore_requires_python</span><span class="s3">=</span><span class="s1">ignore_requires_python</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s2">return </span><span class="s1">PackageFinder</span><span class="s3">.</span><span class="s1">create</span><span class="s3">(</span>
            <span class="s1">link_collector</span><span class="s3">=</span><span class="s1">link_collector</span><span class="s3">,</span>
            <span class="s1">selection_prefs</span><span class="s3">=</span><span class="s1">selection_prefs</span><span class="s3">,</span>
            <span class="s1">target_python</span><span class="s3">=</span><span class="s1">target_python</span><span class="s3">,</span>
        <span class="s3">)</span>
</pre>
</body>
</html>