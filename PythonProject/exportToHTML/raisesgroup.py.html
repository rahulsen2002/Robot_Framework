<html>
<head>
<title>raisesgroup.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #7a7e85;}
.s5 { color: #6aab73;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
raisesgroup.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">annotations</span>

<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Callable</span><span class="s2">, </span><span class="s1">Union</span>

<span class="s0">from </span><span class="s1">trio</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">Matcher</span><span class="s2">, </span><span class="s1">RaisesGroup</span>
<span class="s0">from </span><span class="s1">typing_extensions </span><span class="s0">import </span><span class="s1">assert_type</span>

<span class="s0">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&lt; (</span><span class="s3">3</span><span class="s2">, </span><span class="s3">11</span><span class="s2">):</span>
    <span class="s0">from </span><span class="s1">exceptiongroup </span><span class="s0">import </span><span class="s1">BaseExceptionGroup</span><span class="s2">, </span><span class="s1">ExceptionGroup</span>

<span class="s4"># split into functions to isolate the different scopes</span>


<span class="s0">def </span><span class="s1">check_matcher_typevar_default</span><span class="s2">(</span><span class="s1">e</span><span class="s2">: </span><span class="s1">Matcher</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s0">assert </span><span class="s1">e</span><span class="s2">.</span><span class="s1">exception_type </span><span class="s0">is not None</span>
    <span class="s1">_exc</span><span class="s2">: </span><span class="s1">type</span><span class="s2">[</span><span class="s1">BaseException</span><span class="s2">] = </span><span class="s1">e</span><span class="s2">.</span><span class="s1">exception_type</span>
    <span class="s4"># this would previously pass, as the type would be `Any`</span>
    <span class="s1">e</span><span class="s2">.</span><span class="s1">exception_type</span><span class="s2">().</span><span class="s1">blah</span><span class="s2">()  </span><span class="s4"># type: ignore</span>


<span class="s0">def </span><span class="s1">check_basic_contextmanager</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s0">with </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">ExceptionGroup</span><span class="s2">(</span><span class="s5">&quot;foo&quot;</span><span class="s2">, (</span><span class="s1">ValueError</span><span class="s2">(),))</span>
    <span class="s1">assert_type</span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">check_basic_matches</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s4"># check that matches gets rid of the naked ValueError in the union</span>
    <span class="s1">exc</span><span class="s2">: </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">] | </span><span class="s1">ValueError </span><span class="s2">= </span><span class="s1">ExceptionGroup</span><span class="s2">(</span><span class="s5">&quot;&quot;</span><span class="s2">, (</span><span class="s1">ValueError</span><span class="s2">(),))</span>
    <span class="s0">if </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">).</span><span class="s1">matches</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">):</span>
        <span class="s1">assert_type</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">])</span>

    <span class="s4"># also check that BaseExceptionGroup shows up for BaseExceptions</span>
    <span class="s0">if </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">KeyboardInterrupt</span><span class="s2">).</span><span class="s1">matches</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">):</span>
        <span class="s1">assert_type</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">BaseExceptionGroup</span><span class="s2">[</span><span class="s1">KeyboardInterrupt</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">check_matches_with_different_exception_type</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s1">e</span><span class="s2">: </span><span class="s1">BaseExceptionGroup</span><span class="s2">[</span><span class="s1">KeyboardInterrupt</span><span class="s2">] = </span><span class="s1">BaseExceptionGroup</span><span class="s2">(</span>
        <span class="s5">&quot;&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s1">KeyboardInterrupt</span><span class="s2">(),),</span>
    <span class="s2">)</span>

    <span class="s4"># note: it might be tempting to have this warn.</span>
    <span class="s4"># however, that isn't possible with current typing</span>
    <span class="s0">if </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">).</span><span class="s1">matches</span><span class="s2">(</span><span class="s1">e</span><span class="s2">):</span>
        <span class="s1">assert_type</span><span class="s2">(</span><span class="s1">e</span><span class="s2">, </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">check_matcher_init</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">check_exc</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">: </span><span class="s1">BaseException</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">)</span>

    <span class="s4"># Check various combinations of constructor signatures.</span>
    <span class="s4"># At least 1 arg must be provided.</span>
    <span class="s1">Matcher</span><span class="s2">()  </span><span class="s4"># type: ignore</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">)</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s5">&quot;regex&quot;</span><span class="s2">)</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s5">&quot;regex&quot;</span><span class="s2">, </span><span class="s1">check_exc</span><span class="s2">)</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">exception_type</span><span class="s2">=</span><span class="s1">ValueError</span><span class="s2">)</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;regex&quot;</span><span class="s2">)</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">check</span><span class="s2">=</span><span class="s1">check_exc</span><span class="s2">)</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;regex&quot;</span><span class="s2">)</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;regex&quot;</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">check_exc</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_filenotfound</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">: </span><span class="s1">FileNotFoundError</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">return not </span><span class="s1">exc</span><span class="s2">.</span><span class="s1">filename</span><span class="s2">.</span><span class="s1">endswith</span><span class="s2">(</span><span class="s5">&quot;.tmp&quot;</span><span class="s2">)</span>

    <span class="s4"># If exception_type is provided, that narrows the `check` method's argument.</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">FileNotFoundError</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">check_filenotfound</span><span class="s2">)</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">check_filenotfound</span><span class="s2">)  </span><span class="s4"># type: ignore</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">check</span><span class="s2">=</span><span class="s1">check_filenotfound</span><span class="s2">)  </span><span class="s4"># type: ignore</span>
    <span class="s1">Matcher</span><span class="s2">(</span><span class="s1">FileNotFoundError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;regex&quot;</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">check_filenotfound</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">raisesgroup_check_type_narrowing</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s6">&quot;&quot;&quot;Check type narrowing on the `check` argument to `RaisesGroup`. 
    All `type: ignore`s are correctly pointing out type errors. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">handle_exc</span><span class="s2">(</span><span class="s1">e</span><span class="s2">: </span><span class="s1">BaseExceptionGroup</span><span class="s2">[</span><span class="s1">BaseException</span><span class="s2">]) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">return True</span>

    <span class="s0">def </span><span class="s1">handle_kbi</span><span class="s2">(</span><span class="s1">e</span><span class="s2">: </span><span class="s1">BaseExceptionGroup</span><span class="s2">[</span><span class="s1">KeyboardInterrupt</span><span class="s2">]) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">return True</span>

    <span class="s0">def </span><span class="s1">handle_value</span><span class="s2">(</span><span class="s1">e</span><span class="s2">: </span><span class="s1">BaseExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">return True</span>

    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">BaseException</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_exc</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">BaseException</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_kbi</span><span class="s2">)  </span><span class="s4"># type: ignore</span>

    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">Exception</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_exc</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">Exception</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_value</span><span class="s2">)  </span><span class="s4"># type: ignore</span>

    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">KeyboardInterrupt</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_exc</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">KeyboardInterrupt</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_kbi</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">KeyboardInterrupt</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_value</span><span class="s2">)  </span><span class="s4"># type: ignore</span>

    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_exc</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_kbi</span><span class="s2">)  </span><span class="s4"># type: ignore</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_value</span><span class="s2">)</span>

    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">KeyboardInterrupt</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_exc</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">KeyboardInterrupt</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_kbi</span><span class="s2">)  </span><span class="s4"># type: ignore</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">KeyboardInterrupt</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_value</span><span class="s2">)  </span><span class="s4"># type: ignore</span>


<span class="s0">def </span><span class="s1">raisesgroup_narrow_baseexceptiongroup</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s6">&quot;&quot;&quot;Check type narrowing specifically for the container exceptiongroup.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">handle_group</span><span class="s2">(</span><span class="s1">e</span><span class="s2">: </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">Exception</span><span class="s2">]) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">return True</span>

    <span class="s0">def </span><span class="s1">handle_group_value</span><span class="s2">(</span><span class="s1">e</span><span class="s2">: </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">return True</span>

    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_group_value</span><span class="s2">)</span>

    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">Exception</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">handle_group</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_matcher_transparent</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s0">with </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">)) </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
        <span class="s2">...</span>
    <span class="s1">_</span><span class="s2">: </span><span class="s1">BaseExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">] = </span><span class="s1">e</span><span class="s2">.</span><span class="s1">value</span>
    <span class="s1">assert_type</span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">check_nested_raisesgroups_contextmanager</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s0">with </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">)) </span><span class="s0">as </span><span class="s1">excinfo</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">ExceptionGroup</span><span class="s2">(</span><span class="s5">&quot;foo&quot;</span><span class="s2">, (</span><span class="s1">ValueError</span><span class="s2">(),))</span>

    <span class="s1">_</span><span class="s2">: </span><span class="s1">BaseExceptionGroup</span><span class="s2">[</span><span class="s1">BaseExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]] = </span><span class="s1">excinfo</span><span class="s2">.</span><span class="s1">value</span>

    <span class="s1">assert_type</span><span class="s2">(</span>
        <span class="s1">excinfo</span><span class="s2">.</span><span class="s1">value</span><span class="s2">,</span>
        <span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]],</span>
    <span class="s2">)</span>

    <span class="s1">assert_type</span><span class="s2">(</span>
        <span class="s1">excinfo</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">exceptions</span><span class="s2">[</span><span class="s3">0</span><span class="s2">],</span>
        <span class="s4"># this union is because of how typeshed defines .exceptions</span>
        <span class="s1">Union</span><span class="s2">[</span>
            <span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">],</span>
            <span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]],</span>
        <span class="s2">],</span>
    <span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_nested_raisesgroups_matches</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s6">&quot;&quot;&quot;Check nested RaisesGroups with .matches&quot;&quot;&quot;</span>
    <span class="s1">exc</span><span class="s2">: </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]] = </span><span class="s1">ExceptionGroup</span><span class="s2">(</span>
        <span class="s5">&quot;&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s1">ExceptionGroup</span><span class="s2">(</span><span class="s5">&quot;&quot;</span><span class="s2">, (</span><span class="s1">ValueError</span><span class="s2">(),)),),</span>
    <span class="s2">)</span>

    <span class="s0">if </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">)).</span><span class="s1">matches</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">):</span>
        <span class="s1">assert_type</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]])</span>


<span class="s0">def </span><span class="s1">check_multiple_exceptions_1</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">)</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">), </span><span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">))</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">))</span>

    <span class="s1">d</span><span class="s2">: </span><span class="s1">RaisesGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">a</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">b</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">c</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">RaisesGroup</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_multiple_exceptions_2</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s4"># This previously failed due to lack of covariance in the TypeVar</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">), </span><span class="s1">Matcher</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">))</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">)</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">TypeError</span><span class="s2">)</span>

    <span class="s1">d</span><span class="s2">: </span><span class="s1">RaisesGroup</span><span class="s2">[</span><span class="s1">Exception</span><span class="s2">]</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">a</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">b</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">c</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">RaisesGroup</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_raisesgroup_overloads</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s4"># allow_unwrapped=True does not allow:</span>
    <span class="s4"># multiple exceptions</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">allow_unwrapped</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)  </span><span class="s4"># type: ignore</span>
    <span class="s4"># nested RaisesGroup</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">), </span><span class="s1">allow_unwrapped</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)  </span><span class="s4"># type: ignore</span>
    <span class="s4"># specifying match</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;foo&quot;</span><span class="s2">, </span><span class="s1">allow_unwrapped</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)  </span><span class="s4"># type: ignore</span>
    <span class="s4"># specifying check</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">, </span><span class="s1">allow_unwrapped</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)  </span><span class="s4"># type: ignore</span>
    <span class="s4"># allowed variants</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">allow_unwrapped</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">allow_unwrapped</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">flatten_subgroups</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">), </span><span class="s1">allow_unwrapped</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s4"># flatten_subgroups=True does not allow nested RaisesGroup</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">), </span><span class="s1">flatten_subgroups</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)  </span><span class="s4"># type: ignore</span>
    <span class="s4"># but rest is plenty fine</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">flatten_subgroups</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;foo&quot;</span><span class="s2">, </span><span class="s1">flatten_subgroups</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">, </span><span class="s1">flatten_subgroups</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">flatten_subgroups</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">Matcher</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">), </span><span class="s1">flatten_subgroups</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s4"># if they're both false we can of course specify nested raisesgroup</span>
    <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">check_triple_nested_raisesgroup</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s0">with </span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">))) </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
        <span class="s1">assert_type</span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]]])</span>


<span class="s0">def </span><span class="s1">check_check_typing</span><span class="s2">() </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s4"># `BaseExceptiongroup` should perhaps be `ExceptionGroup`, but close enough</span>
    <span class="s1">assert_type</span><span class="s2">(</span>
        <span class="s1">RaisesGroup</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">).</span><span class="s1">check</span><span class="s2">,</span>
        <span class="s1">Union</span><span class="s2">[</span>
            <span class="s1">Callable</span><span class="s2">[[</span><span class="s1">BaseExceptionGroup</span><span class="s2">[</span><span class="s1">ValueError</span><span class="s2">]], </span><span class="s1">bool</span><span class="s2">],</span>
            <span class="s0">None</span><span class="s2">,</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
</pre>
</body>
</html>