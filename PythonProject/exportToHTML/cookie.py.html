<html>
<head>
<title>cookie.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
cookie.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright 2008-2011 Nokia Networks</span>
<span class="s0"># Copyright 2011-2016 Ryan Tomac, Ed Manlove and contributors</span>
<span class="s0"># Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0"># you may not use this file except in compliance with the License.</span>
<span class="s0"># You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0"># Unless required by applicable law or agreed to in writing, software</span>
<span class="s0"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0"># See the License for the specific language governing permissions and</span>
<span class="s0"># limitations under the License.</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">datetime</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Union</span><span class="s3">, </span><span class="s1">Optional</span>

<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">libraries</span><span class="s3">.</span><span class="s1">DateTime </span><span class="s2">import </span><span class="s1">convert_date</span>
<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">utils </span><span class="s2">import </span><span class="s1">DotDict</span>

<span class="s2">from </span><span class="s1">SeleniumLibrary</span><span class="s3">.</span><span class="s1">base </span><span class="s2">import </span><span class="s1">LibraryComponent</span><span class="s3">, </span><span class="s1">keyword</span>
<span class="s2">from </span><span class="s1">SeleniumLibrary</span><span class="s3">.</span><span class="s1">errors </span><span class="s2">import </span><span class="s1">CookieNotFound</span>


<span class="s2">class </span><span class="s1">CookieInformation</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">name</span><span class="s3">,</span>
        <span class="s1">value</span><span class="s3">,</span>
        <span class="s1">path</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">domain</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">secure</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">httpOnly</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">expiry</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s3">**</span><span class="s1">extra</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">value </span><span class="s3">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">path </span><span class="s3">= </span><span class="s1">path</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">domain </span><span class="s3">= </span><span class="s1">domain</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">secure </span><span class="s3">= </span><span class="s1">secure</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">httpOnly </span><span class="s3">= </span><span class="s1">httpOnly</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">expiry </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">.</span><span class="s1">fromtimestamp</span><span class="s3">(</span><span class="s1">expiry</span><span class="s3">) </span><span class="s2">if </span><span class="s1">expiry </span><span class="s2">else None</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">extra </span><span class="s3">= </span><span class="s1">extra</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">items </span><span class="s3">= </span><span class="s4">&quot;name value path domain secure httpOnly expiry&quot;</span><span class="s3">.</span><span class="s1">split</span><span class="s3">()</span>
        <span class="s1">string </span><span class="s3">= </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">item</span><span class="s2">}</span><span class="s4">=</span><span class="s2">{</span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">item</span><span class="s3">)</span><span class="s2">}</span><span class="s4">&quot; </span><span class="s2">for </span><span class="s1">item </span><span class="s2">in </span><span class="s1">items</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">extra</span><span class="s3">:</span>
            <span class="s1">string </span><span class="s3">= </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">string</span><span class="s2">}\n</span><span class="s4">extra=</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">extra</span><span class="s2">}\n</span><span class="s4">&quot;</span>
        <span class="s2">return </span><span class="s1">string</span>


<span class="s2">class </span><span class="s1">CookieKeywords</span><span class="s3">(</span><span class="s1">LibraryComponent</span><span class="s3">):</span>
    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">delete_all_cookies</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot;Deletes all cookies.&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">delete_all_cookies</span><span class="s3">()</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">delete_cookie</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">name</span><span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot;Deletes the cookie matching ``name``. 
 
        If the cookie is not found, nothing happens. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">delete_cookie</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_cookies</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">as_dict</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">) </span><span class="s1">-&gt; Union</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">dict</span><span class="s3">]:</span>
        <span class="s5">&quot;&quot;&quot;Returns all cookies of the current page. 
 
        If ``as_dict`` argument evaluates as false, see `Boolean arguments` 
        for more details, then cookie information is returned as 
        a single string in format ``name1=value1; name2=value2; name3=value3``. 
        When ``as_dict`` argument evaluates as true, cookie information 
        is returned as Robot Framework dictionary format. The string format 
        can be used, for example, for logging purposes or in headers when 
        sending HTTP requests. The dictionary format is helpful when 
        the result can be passed to requests library's Create Session 
        keyword's optional cookies parameter. 
 
        The `` as_dict`` argument is new in SeleniumLibrary 3.3 
        &quot;&quot;&quot;</span>
        <span class="s2">if not </span><span class="s1">as_dict</span><span class="s3">:</span>
            <span class="s1">pairs </span><span class="s3">= []</span>
            <span class="s2">for </span><span class="s1">cookie </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">get_cookies</span><span class="s3">():</span>
                <span class="s1">pairs</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">cookie</span><span class="s3">[</span><span class="s4">'name'</span><span class="s3">]</span><span class="s2">}</span><span class="s4">=</span><span class="s2">{</span><span class="s1">cookie</span><span class="s3">[</span><span class="s4">'value'</span><span class="s3">]</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s4">&quot;; &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">pairs</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">pairs </span><span class="s3">= </span><span class="s1">DotDict</span><span class="s3">()</span>
            <span class="s2">for </span><span class="s1">cookie </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">get_cookies</span><span class="s3">():</span>
                <span class="s1">pairs</span><span class="s3">[</span><span class="s1">cookie</span><span class="s3">[</span><span class="s4">&quot;name&quot;</span><span class="s3">]] = </span><span class="s1">cookie</span><span class="s3">[</span><span class="s4">&quot;value&quot;</span><span class="s3">]</span>
            <span class="s2">return </span><span class="s1">pairs</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">get_cookie</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; CookieInformation</span><span class="s3">:</span>
        <span class="s5">&quot;&quot;&quot;Returns information of cookie with ``name`` as an object. 
 
        If no cookie is found with ``name``, keyword fails. The cookie object 
        contains details about the cookie. Attributes available in the object 
        are documented in the table below. 
 
        | = Attribute = |             = Explanation =                                | 
        | name          | The name of a cookie.                                      | 
        | value         | Value of the cookie.                                       | 
        | path          | Indicates a URL path, for example ``/``.                   | 
        | domain        | The domain, the cookie is visible to.                      | 
        | secure        | When true, the cookie is only used with HTTPS connections. | 
        | httpOnly      | When true, the cookie is not accessible via JavaScript.    | 
        | expiry        | Python datetime object indicating when the cookie expires. | 
        | extra         | Possible attributes outside of the WebDriver specification | 
 
        See the 
        [https://w3c.github.io/webdriver/#cookies|WebDriver specification] 
        for details about the cookie information. 
        Notice that ``expiry`` is specified as a 
        [https://docs.python.org/3/library/datetime.html#datetime.datetime|datetime object], 
        not as seconds since Unix Epoch like WebDriver natively does. 
 
        In some cases, example when running a browser in the cloud, it is possible that 
        the cookie contains other attributes than is defined in the 
        [https://w3c.github.io/webdriver/#cookies|WebDriver specification]. 
        These other attributes are available in an ``extra`` attribute in the cookie 
        object and it contains a dictionary of the other attributes. The ``extra`` 
        attribute is new in SeleniumLibrary 4.0. 
 
        Example: 
        | `Add Cookie`      | foo             | bar | 
        | ${cookie} =       | `Get Cookie`    | foo | 
        | `Should Be Equal` | ${cookie.name}  | foo | 
        | `Should Be Equal` | ${cookie.value} | bar | 
        | `Should Be True`  | ${cookie.expiry.year} &gt; 2017 | 
 
        New in SeleniumLibrary 3.0. 
        &quot;&quot;&quot;</span>
        <span class="s1">cookie </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">get_cookie</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)</span>
        <span class="s2">if not </span><span class="s1">cookie</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">CookieNotFound</span><span class="s3">(</span><span class="s4">f&quot;Cookie with name '</span><span class="s2">{</span><span class="s1">name</span><span class="s2">}</span><span class="s4">' not found.&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">CookieInformation</span><span class="s3">(**</span><span class="s1">cookie</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">add_cookie</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
        <span class="s1">value</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
        <span class="s1">path</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">domain</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">secure</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">bool</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">expiry</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot;Adds a cookie to your current session. 
 
        ``name`` and ``value`` are required, ``path``, ``domain``, ``secure`` 
        and ``expiry`` are optional.  Expiry supports the same formats as 
        the [http://robotframework.org/robotframework/latest/libraries/DateTime.html|DateTime] 
        library or an epoch timestamp. 
 
        Example: 
        | `Add Cookie` | foo | bar |                            | 
        | `Add Cookie` | foo | bar | domain=example.com         | 
        | `Add Cookie` | foo | bar | expiry=2027-09-28 16:21:35 | # Expiry as timestamp.     | 
        | `Add Cookie` | foo | bar | expiry=1822137695          | # Expiry as epoch seconds. | 
 
        Prior to SeleniumLibrary 3.0 setting expiry did not work. 
        &quot;&quot;&quot;</span>
        <span class="s1">new_cookie </span><span class="s3">= {</span><span class="s4">&quot;name&quot;</span><span class="s3">: </span><span class="s1">name</span><span class="s3">, </span><span class="s4">&quot;value&quot;</span><span class="s3">: </span><span class="s1">value</span><span class="s3">}</span>
        <span class="s2">if </span><span class="s1">path </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">new_cookie</span><span class="s3">[</span><span class="s4">&quot;path&quot;</span><span class="s3">] = </span><span class="s1">path</span>
        <span class="s2">if </span><span class="s1">domain </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">new_cookie</span><span class="s3">[</span><span class="s4">&quot;domain&quot;</span><span class="s3">] = </span><span class="s1">domain</span>
        <span class="s0"># Secure must be True or False</span>
        <span class="s2">if </span><span class="s1">secure </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">new_cookie</span><span class="s3">[</span><span class="s4">&quot;secure&quot;</span><span class="s3">] = </span><span class="s1">secure</span>
        <span class="s2">if </span><span class="s1">expiry </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">new_cookie</span><span class="s3">[</span><span class="s4">&quot;expiry&quot;</span><span class="s3">] = </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_expiry</span><span class="s3">(</span><span class="s1">expiry</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">add_cookie</span><span class="s3">(</span><span class="s1">new_cookie</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_expiry</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">expiry</span><span class="s3">):</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">int</span><span class="s3">(</span><span class="s1">expiry</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">TypeError</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">int</span><span class="s3">(</span><span class="s1">convert_date</span><span class="s3">(</span><span class="s1">expiry</span><span class="s3">, </span><span class="s1">result_format</span><span class="s3">=</span><span class="s4">&quot;epoch&quot;</span><span class="s3">))</span>
</pre>
</body>
</html>