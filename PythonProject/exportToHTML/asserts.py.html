<html>
<head>
<title>asserts.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
asserts.py</font>
</center></td></tr></table>
<pre><span class="s0">#  Copyright 2008-2015 Nokia Networks</span>
<span class="s0">#  Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0">#  you may not use this file except in compliance with the License.</span>
<span class="s0">#  You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="s0">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0">#  See the License for the specific language governing permissions and</span>
<span class="s0">#  limitations under the License.</span>

<span class="s2">&quot;&quot;&quot;Convenience functions for testing both in unit and higher levels. 
 
Benefits: 
  - Integrates 100% with unittest (see example below) 
  - Can be easily used without unittest (using unittest.TestCase when you 
    only need convenient asserts is not so nice) 
  - Saved typing and shorter lines because no need to have 'self.' before 
    asserts. These are static functions after all so that is OK. 
  - All 'equals' methods (by default) report given values even if optional 
    message given. This behavior can be controlled with the optional values 
    argument. 
 
Drawbacks: 
  - unittest is not able to filter as much non-interesting traceback away 
    as with its own methods because AssertionErrors occur outside. 
 
Most of the functions are copied more or less directly from unittest.TestCase 
which comes with the following license. Further information about unittest in 
general can be found from http://pyunit.sourceforge.net/. This module can be 
used freely in same terms as unittest. 
 
unittest license:: 
 
    Copyright (c) 1999-2003 Steve Purcell 
    This module is free software, and you may redistribute it and/or modify 
    it under the same terms as Python itself, so long as this copyright message 
    and disclaimer are retained in their original form. 
 
    IN NO EVENT SHALL THE AUTHOR BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT, 
    SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OF 
    THIS CODE, EVEN IF THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH 
    DAMAGE. 
 
    THE AUTHOR SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT NOT 
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A 
    PARTICULAR PURPOSE.  THE CODE PROVIDED HEREUNDER IS ON AN &quot;AS IS&quot; BASIS, 
    AND THERE IS NO OBLIGATION WHATSOEVER TO PROVIDE MAINTENANCE, 
    SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS. 
 
Examples:: 
 
    import unittest 
    from robot.utils.asserts import assert_equal 
 
    class MyTests(unittest.TestCase): 
 
        def test_old_style(self): 
            self.assertEqual(1, 2, 'my msg') 
 
        def test_new_style(self): 
            assert_equal(1, 2, 'my msg') 
 
Example output:: 
 
    FF 
    ====================================================================== 
    FAIL: test_old_style (example.MyTests) 
    ---------------------------------------------------------------------- 
    Traceback (most recent call last): 
      File &quot;example.py&quot;, line 7, in test_old_style 
        self.assertEqual(1, 2, 'my msg') 
    AssertionError: my msg 
 
    ====================================================================== 
    FAIL: test_new_style (example.MyTests) 
    ---------------------------------------------------------------------- 
    Traceback (most recent call last): 
      File &quot;example.py&quot;, line 10, in test_new_style 
        assert_equal(1, 2, 'my msg') 
      File &quot;/path/to/robot/utils/asserts.py&quot;, line 181, in assert_equal 
        _report_inequality_failure(first, second, msg, values, '!=') 
      File &quot;/path/to/robot/utils/asserts.py&quot;, line 229, in _report_inequality_failure 
        raise AssertionError(msg) 
    AssertionError: my msg: 1 != 2 
 
    ---------------------------------------------------------------------- 
    Ran 2 tests in 0.000s 
 
    FAILED (failures=2) 
&quot;&quot;&quot;</span>

<span class="s3">from </span><span class="s4">.</span><span class="s1">robottypes </span><span class="s3">import </span><span class="s1">type_name</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">unic </span><span class="s3">import </span><span class="s1">safe_str</span>


<span class="s3">def </span><span class="s1">fail</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail test immediately with the given message.&quot;&quot;&quot;</span>
    <span class="s1">_report_failure</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_false</span><span class="s4">(</span><span class="s1">expr</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail the test if the expression is True.&quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">expr</span><span class="s4">:</span>
        <span class="s1">_report_failure</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_true</span><span class="s4">(</span><span class="s1">expr</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail the test unless the expression is True.&quot;&quot;&quot;</span>
    <span class="s3">if not </span><span class="s1">expr</span><span class="s4">:</span>
        <span class="s1">_report_failure</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_not_none</span><span class="s4">(</span><span class="s1">obj</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">values</span><span class="s4">=</span><span class="s3">True</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail the test if given object is None.&quot;&quot;&quot;</span>
    <span class="s1">_msg </span><span class="s4">= </span><span class="s5">&quot;is None&quot;</span>
    <span class="s3">if </span><span class="s1">obj </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">msg </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s1">_msg</span>
        <span class="s3">elif </span><span class="s1">values </span><span class="s3">is True</span><span class="s4">:</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">msg</span><span class="s3">}</span><span class="s5">: </span><span class="s3">{</span><span class="s1">_msg</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s1">_report_failure</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_none</span><span class="s4">(</span><span class="s1">obj</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">values</span><span class="s4">=</span><span class="s3">True</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail the test if given object is not None.&quot;&quot;&quot;</span>
    <span class="s1">_msg </span><span class="s4">= </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">obj</span><span class="s3">!r} </span><span class="s5">is not None&quot;</span>
    <span class="s3">if </span><span class="s1">obj </span><span class="s3">is not None</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">msg </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s1">_msg</span>
        <span class="s3">elif </span><span class="s1">values </span><span class="s3">is True</span><span class="s4">:</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">msg</span><span class="s3">}</span><span class="s5">: </span><span class="s3">{</span><span class="s1">_msg</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s1">_report_failure</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_raises</span><span class="s4">(</span><span class="s1">exc_class</span><span class="s4">, </span><span class="s1">callable_obj</span><span class="s4">, *</span><span class="s1">args</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail unless an exception of class exc_class is thrown by callable_obj. 
 
    callable_obj is invoked with arguments args and keyword arguments 
    kwargs. If a different type of exception is thrown, it will not be 
    caught, and the test case will be deemed to have suffered an 
    error, exactly as for an unexpected exception. 
 
    If a correct exception is raised, the exception instance is returned 
    by this method. 
    &quot;&quot;&quot;</span>
    <span class="s3">try</span><span class="s4">:</span>
        <span class="s1">callable_obj</span><span class="s4">(*</span><span class="s1">args</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">exc_class </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
        <span class="s3">return </span><span class="s1">err</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">hasattr</span><span class="s4">(</span><span class="s1">exc_class</span><span class="s4">, </span><span class="s5">&quot;__name__&quot;</span><span class="s4">):</span>
            <span class="s1">exc_name </span><span class="s4">= </span><span class="s1">exc_class</span><span class="s4">.</span><span class="s1">__name__</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">exc_name </span><span class="s4">= </span><span class="s1">str</span><span class="s4">(</span><span class="s1">exc_class</span><span class="s4">)</span>
        <span class="s1">_report_failure</span><span class="s4">(</span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">exc_name</span><span class="s3">} </span><span class="s5">not raised&quot;</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_raises_with_msg</span><span class="s4">(</span><span class="s1">exc_class</span><span class="s4">, </span><span class="s1">expected_msg</span><span class="s4">, </span><span class="s1">callable_obj</span><span class="s4">, *</span><span class="s1">args</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Similar to fail_unless_raises but also checks the exception message.&quot;&quot;&quot;</span>
    <span class="s3">try</span><span class="s4">:</span>
        <span class="s1">callable_obj</span><span class="s4">(*</span><span class="s1">args</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">exc_class </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
        <span class="s1">assert_equal</span><span class="s4">(</span><span class="s1">expected_msg</span><span class="s4">, </span><span class="s1">str</span><span class="s4">(</span><span class="s1">err</span><span class="s4">), </span><span class="s5">&quot;Correct exception but wrong message&quot;</span><span class="s4">)</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">hasattr</span><span class="s4">(</span><span class="s1">exc_class</span><span class="s4">, </span><span class="s5">&quot;__name__&quot;</span><span class="s4">):</span>
            <span class="s1">exc_name </span><span class="s4">= </span><span class="s1">exc_class</span><span class="s4">.</span><span class="s1">__name__</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">exc_name </span><span class="s4">= </span><span class="s1">str</span><span class="s4">(</span><span class="s1">exc_class</span><span class="s4">)</span>
        <span class="s1">_report_failure</span><span class="s4">(</span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">exc_name</span><span class="s3">} </span><span class="s5">not raised&quot;</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_equal</span><span class="s4">(</span><span class="s1">first</span><span class="s4">, </span><span class="s1">second</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">values</span><span class="s4">=</span><span class="s3">True</span><span class="s4">, </span><span class="s1">formatter</span><span class="s4">=</span><span class="s1">safe_str</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail if given objects are unequal as determined by the '==' operator.&quot;&quot;&quot;</span>
    <span class="s3">if not </span><span class="s1">first </span><span class="s4">== </span><span class="s1">second</span><span class="s4">:  </span><span class="s0"># noqa: SIM201</span>
        <span class="s1">_report_inequality</span><span class="s4">(</span><span class="s1">first</span><span class="s4">, </span><span class="s1">second</span><span class="s4">, </span><span class="s5">&quot;!=&quot;</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">values</span><span class="s4">, </span><span class="s1">formatter</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_not_equal</span><span class="s4">(</span><span class="s1">first</span><span class="s4">, </span><span class="s1">second</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">values</span><span class="s4">=</span><span class="s3">True</span><span class="s4">, </span><span class="s1">formatter</span><span class="s4">=</span><span class="s1">safe_str</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail if given objects are equal as determined by the '==' operator.&quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">first </span><span class="s4">== </span><span class="s1">second</span><span class="s4">:</span>
        <span class="s1">_report_inequality</span><span class="s4">(</span><span class="s1">first</span><span class="s4">, </span><span class="s1">second</span><span class="s4">, </span><span class="s5">&quot;==&quot;</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">values</span><span class="s4">, </span><span class="s1">formatter</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_almost_equal</span><span class="s4">(</span><span class="s1">first</span><span class="s4">, </span><span class="s1">second</span><span class="s4">, </span><span class="s1">places</span><span class="s4">=</span><span class="s6">7</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">values</span><span class="s4">=</span><span class="s3">True</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail if the two objects are unequal after rounded to given places. 
 
    inequality is determined by object's difference rounded to the 
    given number of decimal places (default 7) and comparing to zero. 
    Note that decimal places (from zero) are usually not the same as 
    significant digits (measured from the most significant digit). 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">round</span><span class="s4">(</span><span class="s1">second </span><span class="s4">- </span><span class="s1">first</span><span class="s4">, </span><span class="s1">places</span><span class="s4">) != </span><span class="s6">0</span><span class="s4">:</span>
        <span class="s1">extra </span><span class="s4">= </span><span class="s5">f&quot;within </span><span class="s3">{</span><span class="s1">places</span><span class="s3">} </span><span class="s5">places&quot;</span>
        <span class="s1">_report_inequality</span><span class="s4">(</span><span class="s1">first</span><span class="s4">, </span><span class="s1">second</span><span class="s4">, </span><span class="s5">&quot;!=&quot;</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">values</span><span class="s4">, </span><span class="s1">extra</span><span class="s4">=</span><span class="s1">extra</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">assert_not_almost_equal</span><span class="s4">(</span><span class="s1">first</span><span class="s4">, </span><span class="s1">second</span><span class="s4">, </span><span class="s1">places</span><span class="s4">=</span><span class="s6">7</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">values</span><span class="s4">=</span><span class="s3">True</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Fail if the two objects are unequal after rounded to given places. 
 
    Equality is determined by object's difference rounded to to the 
    given number of decimal places (default 7) and comparing to zero. 
    Note that decimal places (from zero) are usually not the same as 
    significant digits (measured from the most significant digit). 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">round</span><span class="s4">(</span><span class="s1">second </span><span class="s4">- </span><span class="s1">first</span><span class="s4">, </span><span class="s1">places</span><span class="s4">) == </span><span class="s6">0</span><span class="s4">:</span>
        <span class="s1">extra </span><span class="s4">= </span><span class="s5">f&quot;within </span><span class="s3">{</span><span class="s1">places</span><span class="s3">!r} </span><span class="s5">places&quot;</span>
        <span class="s1">_report_inequality</span><span class="s4">(</span><span class="s1">first</span><span class="s4">, </span><span class="s1">second</span><span class="s4">, </span><span class="s5">&quot;==&quot;</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">values</span><span class="s4">, </span><span class="s1">extra</span><span class="s4">=</span><span class="s1">extra</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">_report_failure</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">):</span>
    <span class="s3">if </span><span class="s1">msg </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">raise </span><span class="s1">AssertionError</span>
    <span class="s3">raise </span><span class="s1">AssertionError</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">_report_inequality</span><span class="s4">(</span>
    <span class="s1">obj1</span><span class="s4">,</span>
    <span class="s1">obj2</span><span class="s4">,</span>
    <span class="s1">delim</span><span class="s4">,</span>
    <span class="s1">msg</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s1">values</span><span class="s4">=</span><span class="s3">False</span><span class="s4">,</span>
    <span class="s1">formatter</span><span class="s4">=</span><span class="s1">safe_str</span><span class="s4">,</span>
    <span class="s1">extra</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
<span class="s4">):</span>
    <span class="s1">_msg </span><span class="s4">= </span><span class="s1">_format_message</span><span class="s4">(</span><span class="s1">obj1</span><span class="s4">, </span><span class="s1">obj2</span><span class="s4">, </span><span class="s1">delim</span><span class="s4">, </span><span class="s1">formatter</span><span class="s4">)</span>
    <span class="s3">if not </span><span class="s1">msg</span><span class="s4">:</span>
        <span class="s1">msg </span><span class="s4">= </span><span class="s1">_msg</span>
    <span class="s3">elif </span><span class="s1">values</span><span class="s4">:</span>
        <span class="s1">msg </span><span class="s4">= </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">msg</span><span class="s3">}</span><span class="s5">: </span><span class="s3">{</span><span class="s1">_msg</span><span class="s3">}</span><span class="s5">&quot;</span>
    <span class="s3">if </span><span class="s1">values </span><span class="s3">and </span><span class="s1">extra</span><span class="s4">:</span>
        <span class="s1">msg </span><span class="s4">+= </span><span class="s5">&quot; &quot; </span><span class="s4">+ </span><span class="s1">extra</span>
    <span class="s3">raise </span><span class="s1">AssertionError</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">_format_message</span><span class="s4">(</span><span class="s1">obj1</span><span class="s4">, </span><span class="s1">obj2</span><span class="s4">, </span><span class="s1">delim</span><span class="s4">, </span><span class="s1">formatter</span><span class="s4">=</span><span class="s1">safe_str</span><span class="s4">):</span>
    <span class="s1">str1 </span><span class="s4">= </span><span class="s1">formatter</span><span class="s4">(</span><span class="s1">obj1</span><span class="s4">)</span>
    <span class="s1">str2 </span><span class="s4">= </span><span class="s1">formatter</span><span class="s4">(</span><span class="s1">obj2</span><span class="s4">)</span>
    <span class="s3">if </span><span class="s1">delim </span><span class="s4">== </span><span class="s5">&quot;!=&quot; </span><span class="s3">and </span><span class="s1">str1 </span><span class="s4">== </span><span class="s1">str2</span><span class="s4">:</span>
        <span class="s3">return </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">str1</span><span class="s3">} </span><span class="s5">(</span><span class="s3">{</span><span class="s1">type_name</span><span class="s4">(</span><span class="s1">obj1</span><span class="s4">)</span><span class="s3">}</span><span class="s5">) != </span><span class="s3">{</span><span class="s1">str2</span><span class="s3">} </span><span class="s5">(</span><span class="s3">{</span><span class="s1">type_name</span><span class="s4">(</span><span class="s1">obj2</span><span class="s4">)</span><span class="s3">}</span><span class="s5">)&quot;</span>
    <span class="s3">return </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">str1</span><span class="s3">} {</span><span class="s1">delim</span><span class="s3">} {</span><span class="s1">str2</span><span class="s3">}</span><span class="s5">&quot;</span>
</pre>
</body>
</html>