<html>
<head>
<title>body.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
body.py</font>
</center></td></tr></table>
<pre><span class="s0">#  Copyright 2008-2015 Nokia Networks</span>
<span class="s0">#  Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0">#  you may not use this file except in compliance with the License.</span>
<span class="s0">#  You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="s0">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0">#  See the License for the specific language governing permissions and</span>
<span class="s0">#  limitations under the License.</span>

<span class="s2">import </span><span class="s1">re</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">Any</span><span class="s3">, </span><span class="s1">Callable</span><span class="s3">, </span><span class="s1">cast</span><span class="s3">, </span><span class="s1">Generic</span><span class="s3">, </span><span class="s1">Iterable</span><span class="s3">, </span><span class="s1">Type</span><span class="s3">, </span><span class="s1">TYPE_CHECKING</span><span class="s3">, </span><span class="s1">TypeVar</span><span class="s3">, </span><span class="s1">Union</span>
<span class="s3">)</span>

<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">errors </span><span class="s2">import </span><span class="s1">DataError</span>
<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">utils </span><span class="s2">import </span><span class="s1">copy_signature</span><span class="s3">, </span><span class="s1">KnownAtRuntime</span>

<span class="s2">from </span><span class="s3">.</span><span class="s1">itemlist </span><span class="s2">import </span><span class="s1">ItemList</span>
<span class="s2">from </span><span class="s3">.</span><span class="s1">modelobject </span><span class="s2">import </span><span class="s1">DataDict</span><span class="s3">, </span><span class="s1">full_name</span><span class="s3">, </span><span class="s1">ModelObject</span>

<span class="s2">if </span><span class="s1">TYPE_CHECKING</span><span class="s3">:</span>
    <span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">running</span><span class="s3">.</span><span class="s1">model </span><span class="s2">import </span><span class="s1">ResourceFile</span><span class="s3">, </span><span class="s1">UserKeyword</span>

    <span class="s2">from </span><span class="s3">.</span><span class="s1">control </span><span class="s2">import </span><span class="s3">(</span>
        <span class="s1">Break</span><span class="s3">, </span><span class="s1">Continue</span><span class="s3">, </span><span class="s1">Error</span><span class="s3">, </span><span class="s1">For</span><span class="s3">, </span><span class="s1">ForIteration</span><span class="s3">, </span><span class="s1">Group</span><span class="s3">, </span><span class="s1">If</span><span class="s3">, </span><span class="s1">IfBranch</span><span class="s3">, </span><span class="s1">Return</span><span class="s3">, </span><span class="s1">Try</span><span class="s3">,</span>
        <span class="s1">TryBranch</span><span class="s3">, </span><span class="s1">Var</span><span class="s3">, </span><span class="s1">While</span><span class="s3">, </span><span class="s1">WhileIteration</span>
    <span class="s3">)</span>
    <span class="s2">from </span><span class="s3">.</span><span class="s1">keyword </span><span class="s2">import </span><span class="s1">Keyword</span>
    <span class="s2">from </span><span class="s3">.</span><span class="s1">message </span><span class="s2">import </span><span class="s1">Message</span>
    <span class="s2">from </span><span class="s3">.</span><span class="s1">testcase </span><span class="s2">import </span><span class="s1">TestCase</span>
    <span class="s2">from </span><span class="s3">.</span><span class="s1">testsuite </span><span class="s2">import </span><span class="s1">TestSuite</span>


<span class="s1">BodyItemParent </span><span class="s3">= </span><span class="s1">Union</span><span class="s3">[</span>
    <span class="s4">&quot;TestSuite&quot;</span><span class="s3">, </span><span class="s4">&quot;TestCase&quot;</span><span class="s3">, </span><span class="s4">&quot;UserKeyword&quot;</span><span class="s3">, </span><span class="s4">&quot;For&quot;</span><span class="s3">, </span><span class="s4">&quot;ForIteration&quot;</span><span class="s3">, </span><span class="s4">&quot;If&quot;</span><span class="s3">, </span><span class="s4">&quot;IfBranch&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;Try&quot;</span><span class="s3">, </span><span class="s4">&quot;TryBranch&quot;</span><span class="s3">, </span><span class="s4">&quot;While&quot;</span><span class="s3">, </span><span class="s4">&quot;Group&quot;</span><span class="s3">, </span><span class="s4">&quot;WhileIteration&quot;</span><span class="s3">, </span><span class="s4">&quot;Keyword&quot;</span><span class="s3">, </span><span class="s4">&quot;Var&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;Return&quot;</span><span class="s3">, </span><span class="s4">&quot;Continue&quot;</span><span class="s3">, </span><span class="s4">&quot;Break&quot;</span><span class="s3">, </span><span class="s4">&quot;Error&quot;</span><span class="s3">, </span><span class="s2">None</span>
<span class="s3">]  </span><span class="s0"># fmt: skip</span>
<span class="s1">BI </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;BI&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;BodyItem&quot;</span><span class="s3">)</span>
<span class="s1">KW </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;KW&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;Keyword&quot;</span><span class="s3">)</span>
<span class="s1">F </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;F&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;For&quot;</span><span class="s3">)</span>
<span class="s1">W </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;W&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;While&quot;</span><span class="s3">)</span>
<span class="s1">G </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;G&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;Group&quot;</span><span class="s3">)</span>
<span class="s1">I </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;I&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;If&quot;</span><span class="s3">)  </span><span class="s0"># noqa: E741</span>
<span class="s1">T </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;T&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;Try&quot;</span><span class="s3">)</span>
<span class="s1">V </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;V&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;Var&quot;</span><span class="s3">)</span>
<span class="s1">R </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;R&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;Return&quot;</span><span class="s3">)</span>
<span class="s1">C </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;Continue&quot;</span><span class="s3">)</span>
<span class="s1">B </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;Break&quot;</span><span class="s3">)</span>
<span class="s1">M </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;M&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;Message&quot;</span><span class="s3">)</span>
<span class="s1">E </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;E&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;Error&quot;</span><span class="s3">)</span>
<span class="s1">IT </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;IT&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;IfBranch|TryBranch&quot;</span><span class="s3">)</span>
<span class="s1">FW </span><span class="s3">= </span><span class="s1">TypeVar</span><span class="s3">(</span><span class="s4">&quot;FW&quot;</span><span class="s3">, </span><span class="s1">bound</span><span class="s3">=</span><span class="s4">&quot;ForIteration|WhileIteration&quot;</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">BodyItem</span><span class="s3">(</span><span class="s1">ModelObject</span><span class="s3">):</span>
    <span class="s1">body</span><span class="s3">: </span><span class="s4">&quot;BaseBody&quot;</span>
    <span class="s1">__slots__ </span><span class="s3">= (</span><span class="s4">&quot;parent&quot;</span><span class="s3">,)</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">id</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;str|None&quot;</span><span class="s3">:</span>
        <span class="s5">&quot;&quot;&quot;Item id in format like ``s1-t3-k1``. 
 
        See :attr:`TestSuite.id &lt;robot.model.testsuite.TestSuite.id&gt;` for 
        more information. 
 
        ``id`` is ``None`` only in these special cases: 
 
        - Keyword uses a placeholder for ``setup`` or ``teardown`` when 
          a ``setup`` or ``teardown`` is not actually used. 
        - With :class:`~robot.model.control.If` and :class:`~robot.model.control.Try` 
          instances representing IF/TRY structure roots. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_id</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_get_id</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">: </span><span class="s4">&quot;BodyItemParent|ResourceFile&quot;</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">if not </span><span class="s1">parent</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s4">&quot;k1&quot;</span>
        <span class="s0"># This algorithm must match the id creation algorithm in the JavaScript side</span>
        <span class="s0"># or linking to warnings and errors won't work.</span>
        <span class="s1">steps </span><span class="s3">= []</span>
        <span class="s2">if </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">, </span><span class="s4">&quot;has_setup&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">):</span>
            <span class="s1">steps</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">.</span><span class="s1">setup</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">, </span><span class="s4">&quot;body&quot;</span><span class="s3">):</span>
            <span class="s1">steps</span><span class="s3">.</span><span class="s1">extend</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">flatten</span><span class="s3">(</span><span class="s1">messages</span><span class="s3">=</span><span class="s2">False</span><span class="s3">))</span>
        <span class="s2">if </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">, </span><span class="s4">&quot;has_teardown&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">):</span>
            <span class="s1">steps</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">.</span><span class="s1">teardown</span><span class="s3">)</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s1">steps</span><span class="s3">.</span><span class="s1">index</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s2">if </span><span class="s1">self </span><span class="s2">in </span><span class="s1">steps </span><span class="s2">else </span><span class="s1">len</span><span class="s3">(</span><span class="s1">steps</span><span class="s3">)</span>
        <span class="s1">pid </span><span class="s3">= </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">id  </span><span class="s0"># IF/TRY root id is None. Avoid calling property twice.</span>
        <span class="s2">return </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">pid</span><span class="s2">}</span><span class="s4">-k</span><span class="s2">{</span><span class="s1">index </span><span class="s3">+ </span><span class="s6">1</span><span class="s2">}</span><span class="s4">&quot; </span><span class="s2">if </span><span class="s1">pid </span><span class="s2">else </span><span class="s4">f&quot;k</span><span class="s2">{</span><span class="s1">index </span><span class="s3">+ </span><span class="s6">1</span><span class="s2">}</span><span class="s4">&quot;</span>

    <span class="s2">def </span><span class="s1">to_dict</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; DataDict</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">NotImplementedError</span>


<span class="s2">class </span><span class="s1">BaseBody</span><span class="s3">(</span><span class="s1">ItemList</span><span class="s3">[</span><span class="s1">BodyItem</span><span class="s3">], </span><span class="s1">Generic</span><span class="s3">[</span><span class="s1">KW</span><span class="s3">, </span><span class="s1">F</span><span class="s3">, </span><span class="s1">W</span><span class="s3">, </span><span class="s1">G</span><span class="s3">, </span><span class="s1">I</span><span class="s3">, </span><span class="s1">T</span><span class="s3">, </span><span class="s1">V</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">C</span><span class="s3">, </span><span class="s1">B</span><span class="s3">, </span><span class="s1">M</span><span class="s3">, </span><span class="s1">E</span><span class="s3">]):</span>
    <span class="s5">&quot;&quot;&quot;Base class for Body and Branches objects.&quot;&quot;&quot;</span>

    <span class="s0"># Set using 'BaseBody.register' when these classes are created.</span>
    <span class="s1">keyword_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">KW</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">for_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">F</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">while_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">W</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">group_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">G</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">if_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">I</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">try_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">T</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">var_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">V</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">return_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">R</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">continue_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">C</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">break_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">B</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">message_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">M</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">error_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">E</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">__slots__ </span><span class="s3">= ()</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">parent</span><span class="s3">: </span><span class="s1">BodyItemParent </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">items</span><span class="s3">: </span><span class="s4">&quot;Iterable[BodyItem|DataDict]&quot; </span><span class="s3">= (),</span>
    <span class="s3">):</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">BodyItem</span><span class="s3">, {</span><span class="s4">&quot;parent&quot;</span><span class="s3">: </span><span class="s1">parent</span><span class="s3">}, </span><span class="s1">items</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_item_from_dict</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">data</span><span class="s3">: </span><span class="s1">DataDict</span><span class="s3">) </span><span class="s1">-&gt; BodyItem</span><span class="s3">:</span>
        <span class="s1">item_type </span><span class="s3">= </span><span class="s1">data</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;type&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">item_type </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">item_class </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">keyword_class</span>
        <span class="s2">elif </span><span class="s1">item_type </span><span class="s3">== </span><span class="s1">BodyItem</span><span class="s3">.</span><span class="s1">IF_ELSE_ROOT</span><span class="s3">:</span>
            <span class="s1">item_class </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">if_class</span>
        <span class="s2">elif </span><span class="s1">item_type </span><span class="s3">== </span><span class="s1">BodyItem</span><span class="s3">.</span><span class="s1">TRY_EXCEPT_ROOT</span><span class="s3">:</span>
            <span class="s1">item_class </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">try_class</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">item_class </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">item_type</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">() + </span><span class="s4">&quot;_class&quot;</span><span class="s3">)</span>
        <span class="s1">item_class </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">Type</span><span class="s3">[</span><span class="s1">BodyItem</span><span class="s3">], </span><span class="s1">item_class</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">item_class</span><span class="s3">.</span><span class="s1">from_dict</span><span class="s3">(</span><span class="s1">data</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">classmethod</span>
    <span class="s2">def </span><span class="s1">register</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">, </span><span class="s1">item_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">BI</span><span class="s3">]) </span><span class="s1">-&gt; Type</span><span class="s3">[</span><span class="s1">BI</span><span class="s3">]:</span>
        <span class="s1">name_parts </span><span class="s3">= [*</span><span class="s1">re</span><span class="s3">.</span><span class="s1">findall</span><span class="s3">(</span><span class="s4">&quot;([A-Z][a-z]+)&quot;</span><span class="s3">, </span><span class="s1">item_class</span><span class="s3">.</span><span class="s1">__name__</span><span class="s3">), </span><span class="s4">&quot;class&quot;</span><span class="s3">]</span>
        <span class="s1">name </span><span class="s3">= </span><span class="s4">&quot;_&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">name_parts</span><span class="s3">).</span><span class="s1">lower</span><span class="s3">()</span>
        <span class="s2">if not </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">, </span><span class="s1">name</span><span class="s3">):</span>
            <span class="s2">raise </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">f&quot;Cannot register '</span><span class="s2">{</span><span class="s1">name</span><span class="s2">}</span><span class="s4">'.&quot;</span><span class="s3">)</span>
        <span class="s1">setattr</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">item_class</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">item_class</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">raise </span><span class="s1">AttributeError</span><span class="s3">(</span>
            <span class="s4">f&quot;'</span><span class="s2">{</span><span class="s1">full_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">)</span><span class="s2">}</span><span class="s4">' object has no attribute 'create'. &quot;</span>
            <span class="s4">f&quot;Use item specific methods like 'create_keyword' instead.&quot;</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_create</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">cls</span><span class="s3">: </span><span class="s4">&quot;Type[BI]&quot;</span><span class="s3">,</span>
        <span class="s1">name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
        <span class="s1">args</span><span class="s3">: </span><span class="s4">&quot;tuple[Any, ...]&quot;</span><span class="s3">,</span>
        <span class="s1">kwargs</span><span class="s3">: </span><span class="s4">&quot;dict[str, Any]&quot;</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; BI</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">cls </span><span class="s2">is </span><span class="s1">KnownAtRuntime</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">f&quot;'</span><span class="s2">{</span><span class="s1">full_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">)</span><span class="s2">}</span><span class="s4">' object does not support '</span><span class="s2">{</span><span class="s1">name</span><span class="s2">}</span><span class="s4">'.&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">))  </span><span class="s0"># type: ignore</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">keyword_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_keyword</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; keyword_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">keyword_class</span><span class="s3">, </span><span class="s4">&quot;create_keyword&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">for_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_for</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; for_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">for_class</span><span class="s3">, </span><span class="s4">&quot;create_for&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">if_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_if</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; if_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">if_class</span><span class="s3">, </span><span class="s4">&quot;create_if&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">try_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_try</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; try_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">try_class</span><span class="s3">, </span><span class="s4">&quot;create_try&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">while_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_while</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; while_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">while_class</span><span class="s3">, </span><span class="s4">&quot;create_while&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">group_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_group</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; group_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">group_class</span><span class="s3">, </span><span class="s4">&quot;create_group&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">var_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_var</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; var_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">var_class</span><span class="s3">, </span><span class="s4">&quot;create_var&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">return_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_return</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; return_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">return_class</span><span class="s3">, </span><span class="s4">&quot;create_return&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">continue_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_continue</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; continue_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">continue_class</span><span class="s3">, </span><span class="s4">&quot;create_continue&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">break_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_break</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; break_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">break_class</span><span class="s3">, </span><span class="s4">&quot;create_break&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">message_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_message</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; message_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">message_class</span><span class="s3">, </span><span class="s4">&quot;create_message&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">error_class</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_error</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; error_class</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">error_class</span><span class="s3">, </span><span class="s4">&quot;create_error&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">filter</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">keywords</span><span class="s3">: </span><span class="s4">&quot;bool|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">messages</span><span class="s3">: </span><span class="s4">&quot;bool|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">predicate</span><span class="s3">: </span><span class="s4">&quot;Callable[[T], bool]|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;list[BodyItem]&quot;</span><span class="s3">:</span>
        <span class="s5">&quot;&quot;&quot;Filter body items based on type and/or custom predicate. 
 
        To include or exclude items based on types, give matching arguments 
        ``True`` or ``False`` values. For example, to include only keywords, 
        use ``body.filter(keywords=True)`` and to exclude messages use 
        ``body.filter(messages=False)``. Including and excluding by types 
        at the same time is not supported and filtering my ``messages`` 
        is supported only if the ``Body`` object actually supports messages. 
 
        Custom ``predicate`` is a callable getting each body item as an argument 
        that must return ``True/False`` depending on should the item be included 
        or not. 
 
        Selected items are returned as a list and the original body is not modified. 
 
        It was earlier possible to filter also based on FOR and IF types. 
        That support was removed in RF 5.0 because it was not considered useful 
        in general and because adding support for all new control structures 
        would have required extra work. To exclude all control structures, use 
        ``body.filter(keywords=True, messages=True)`` and to only include them 
        use ``body.filter(keywords=False``, messages=False)``. For more detailed 
        filtering it is possible to use ``predicate``. 
        &quot;&quot;&quot;</span>
        <span class="s1">by_type </span><span class="s3">= [(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">keyword_class</span><span class="s3">, </span><span class="s1">keywords</span><span class="s3">), (</span><span class="s1">self</span><span class="s3">.</span><span class="s1">message_class</span><span class="s3">, </span><span class="s1">messages</span><span class="s3">)]</span>
        <span class="s1">include </span><span class="s3">= </span><span class="s1">tuple</span><span class="s3">(</span><span class="s1">cls </span><span class="s2">for </span><span class="s1">cls</span><span class="s3">, </span><span class="s1">activated </span><span class="s2">in </span><span class="s1">by_type </span><span class="s2">if </span><span class="s1">activated </span><span class="s2">is True and </span><span class="s1">cls</span><span class="s3">)</span>
        <span class="s1">exclude </span><span class="s3">= </span><span class="s1">tuple</span><span class="s3">(</span><span class="s1">cls </span><span class="s2">for </span><span class="s1">cls</span><span class="s3">, </span><span class="s1">activated </span><span class="s2">in </span><span class="s1">by_type </span><span class="s2">if </span><span class="s1">activated </span><span class="s2">is False and </span><span class="s1">cls</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">include </span><span class="s2">and </span><span class="s1">exclude</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">&quot;Items cannot be both included and excluded by type.&quot;</span><span class="s3">)</span>
        <span class="s1">items </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">self</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">include</span><span class="s3">:</span>
            <span class="s1">items </span><span class="s3">= [</span><span class="s1">item </span><span class="s2">for </span><span class="s1">item </span><span class="s2">in </span><span class="s1">items </span><span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">item</span><span class="s3">, </span><span class="s1">include</span><span class="s3">)]</span>
        <span class="s2">if </span><span class="s1">exclude</span><span class="s3">:</span>
            <span class="s1">items </span><span class="s3">= [</span><span class="s1">item </span><span class="s2">for </span><span class="s1">item </span><span class="s2">in </span><span class="s1">items </span><span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">item</span><span class="s3">, </span><span class="s1">exclude</span><span class="s3">)]</span>
        <span class="s2">if </span><span class="s1">predicate</span><span class="s3">:</span>
            <span class="s1">items </span><span class="s3">= [</span><span class="s1">item </span><span class="s2">for </span><span class="s1">item </span><span class="s2">in </span><span class="s1">items </span><span class="s2">if </span><span class="s1">predicate</span><span class="s3">(</span><span class="s1">item</span><span class="s3">)]</span>
        <span class="s2">return </span><span class="s1">items</span>

    <span class="s2">def </span><span class="s1">flatten</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, **</span><span class="s1">filter_config</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;list[BodyItem]&quot;</span><span class="s3">:</span>
        <span class="s5">&quot;&quot;&quot;Return steps so that IF and TRY structures are flattened. 
 
        Basically the IF/ELSE and TRY/EXCEPT root elements are replaced 
        with their branches. This is how they are shown in the log file. 
 
        ``filter_config`` can be used to filter steps using the :meth:`filter` 
        method before flattening. New in Robot Framework 7.2. 
        &quot;&quot;&quot;</span>
        <span class="s1">roots </span><span class="s3">= </span><span class="s1">BodyItem</span><span class="s3">.</span><span class="s1">IF_ELSE_ROOT</span><span class="s3">, </span><span class="s1">BodyItem</span><span class="s3">.</span><span class="s1">TRY_EXCEPT_ROOT</span>
        <span class="s1">steps </span><span class="s3">= </span><span class="s1">self </span><span class="s2">if not </span><span class="s1">filter_config </span><span class="s2">else </span><span class="s1">self</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(**</span><span class="s1">filter_config</span><span class="s3">)</span>
        <span class="s1">flat </span><span class="s3">= []</span>
        <span class="s2">for </span><span class="s1">item </span><span class="s2">in </span><span class="s1">steps</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">item</span><span class="s3">.</span><span class="s1">type </span><span class="s2">in </span><span class="s1">roots</span><span class="s3">:</span>
                <span class="s1">flat</span><span class="s3">.</span><span class="s1">extend</span><span class="s3">(</span><span class="s1">item</span><span class="s3">.</span><span class="s1">body</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">flat</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">item</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">flat</span>


<span class="s2">class </span><span class="s1">Body</span><span class="s3">(</span><span class="s1">BaseBody</span><span class="s3">[</span>
    <span class="s4">&quot;Keyword&quot;</span><span class="s3">, </span><span class="s4">&quot;For&quot;</span><span class="s3">, </span><span class="s4">&quot;While&quot;</span><span class="s3">, </span><span class="s4">&quot;Group&quot;</span><span class="s3">, </span><span class="s4">&quot;If&quot;</span><span class="s3">, </span><span class="s4">&quot;Try&quot;</span><span class="s3">, </span><span class="s4">&quot;Var&quot;</span><span class="s3">, </span><span class="s4">&quot;Return&quot;</span><span class="s3">, </span><span class="s4">&quot;Continue&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;Break&quot;</span><span class="s3">, </span><span class="s4">&quot;Message&quot;</span><span class="s3">, </span><span class="s4">&quot;Error&quot;</span>
<span class="s3">]):  </span><span class="s0"># fmt: skip</span>
    <span class="s5">&quot;&quot;&quot;A list-like object representing a body of a test, keyword, etc. 
 
    Body contains the keywords and other structures such as FOR loops. 
    &quot;&quot;&quot;</span>

    <span class="s1">__slots__ </span><span class="s3">= ()</span>


<span class="s0"># BaseBranches cannot extend Generic[IT] directly with BaseBody[...].</span>
<span class="s2">class </span><span class="s1">BranchType</span><span class="s3">(</span><span class="s1">Generic</span><span class="s3">[</span><span class="s1">IT</span><span class="s3">]):</span>
    <span class="s1">__slots__ </span><span class="s3">= ()</span>


<span class="s2">class </span><span class="s1">BaseBranches</span><span class="s3">(</span><span class="s1">BaseBody</span><span class="s3">[</span><span class="s1">KW</span><span class="s3">, </span><span class="s1">F</span><span class="s3">, </span><span class="s1">W</span><span class="s3">, </span><span class="s1">G</span><span class="s3">, </span><span class="s1">I</span><span class="s3">, </span><span class="s1">T</span><span class="s3">, </span><span class="s1">V</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">C</span><span class="s3">, </span><span class="s1">B</span><span class="s3">, </span><span class="s1">M</span><span class="s3">, </span><span class="s1">E</span><span class="s3">], </span><span class="s1">BranchType</span><span class="s3">[</span><span class="s1">IT</span><span class="s3">]):</span>
    <span class="s5">&quot;&quot;&quot;A list-like object representing IF and TRY branches.&quot;&quot;&quot;</span>

    <span class="s1">branch_type</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">IT</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">__slots__ </span><span class="s3">= (</span><span class="s4">&quot;branch_class&quot;</span><span class="s3">,)</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">branch_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">IT</span><span class="s3">],</span>
        <span class="s1">parent</span><span class="s3">: </span><span class="s1">BodyItemParent </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">items</span><span class="s3">: </span><span class="s4">&quot;Iterable[IT|DataDict]&quot; </span><span class="s3">= (),</span>
    <span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">branch_class </span><span class="s3">= </span><span class="s1">branch_class</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">, </span><span class="s1">items</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_item_from_dict</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">data</span><span class="s3">: </span><span class="s1">DataDict</span><span class="s3">) </span><span class="s1">-&gt; BodyItem</span><span class="s3">:</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">branch_class</span><span class="s3">.</span><span class="s1">from_dict</span><span class="s3">(</span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s1">DataError</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">super</span><span class="s3">().</span><span class="s1">_item_from_dict</span><span class="s3">(</span><span class="s1">data</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">branch_type</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_branch</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; IT</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">branch_class</span><span class="s3">, </span><span class="s4">&quot;create_branch&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>


<span class="s0"># BaseIterations cannot extend Generic[IT] directly with BaseBody[...].</span>
<span class="s2">class </span><span class="s1">IterationType</span><span class="s3">(</span><span class="s1">Generic</span><span class="s3">[</span><span class="s1">FW</span><span class="s3">]):</span>
    <span class="s1">__slots__ </span><span class="s3">= ()</span>


<span class="s2">class </span><span class="s1">BaseIterations</span><span class="s3">(</span><span class="s1">BaseBody</span><span class="s3">[</span><span class="s1">KW</span><span class="s3">, </span><span class="s1">F</span><span class="s3">, </span><span class="s1">W</span><span class="s3">, </span><span class="s1">G</span><span class="s3">, </span><span class="s1">I</span><span class="s3">, </span><span class="s1">T</span><span class="s3">, </span><span class="s1">V</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">C</span><span class="s3">, </span><span class="s1">B</span><span class="s3">, </span><span class="s1">M</span><span class="s3">, </span><span class="s1">E</span><span class="s3">], </span><span class="s1">IterationType</span><span class="s3">[</span><span class="s1">FW</span><span class="s3">]):</span>
    <span class="s1">iteration_type</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">FW</span><span class="s3">] = </span><span class="s1">KnownAtRuntime</span>
    <span class="s1">__slots__ </span><span class="s3">= (</span><span class="s4">&quot;iteration_class&quot;</span><span class="s3">,)</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">iteration_class</span><span class="s3">: </span><span class="s1">Type</span><span class="s3">[</span><span class="s1">FW</span><span class="s3">],</span>
        <span class="s1">parent</span><span class="s3">: </span><span class="s1">BodyItemParent </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">items</span><span class="s3">: </span><span class="s4">&quot;Iterable[FW|DataDict]&quot; </span><span class="s3">= (),</span>
    <span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">iteration_class </span><span class="s3">= </span><span class="s1">iteration_class</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">, </span><span class="s1">items</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_item_from_dict</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">data</span><span class="s3">: </span><span class="s1">DataDict</span><span class="s3">) </span><span class="s1">-&gt; BodyItem</span><span class="s3">:</span>
        <span class="s0"># Non-iteration data is typically caused by listeners.</span>
        <span class="s2">if </span><span class="s1">data</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;type&quot;</span><span class="s3">) != </span><span class="s4">&quot;ITERATION&quot;</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">super</span><span class="s3">().</span><span class="s1">_item_from_dict</span><span class="s3">(</span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">iteration_class</span><span class="s3">.</span><span class="s1">from_dict</span><span class="s3">(</span><span class="s1">data</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">copy_signature</span><span class="s3">(</span><span class="s1">iteration_type</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">create_iteration</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; FW</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">iteration_class</span><span class="s3">, </span><span class="s4">&quot;iteration_class&quot;</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">)</span>
</pre>
</body>
</html>