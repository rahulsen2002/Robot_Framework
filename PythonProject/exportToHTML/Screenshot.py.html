<html>
<head>
<title>screenshot.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
screenshot.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright 2008-2011 Nokia Networks</span>
<span class="s0"># Copyright 2011-2016 Ryan Tomac, Ed Manlove and contributors</span>
<span class="s0"># Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0"># you may not use this file except in compliance with the License.</span>
<span class="s0"># You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0"># Unless required by applicable law or agreed to in writing, software</span>
<span class="s0"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0"># See the License for the specific language governing permissions and</span>
<span class="s0"># limitations under the License.</span>
<span class="s2">import </span><span class="s1">os</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Optional</span><span class="s3">, </span><span class="s1">Union</span>
<span class="s2">from </span><span class="s1">base64 </span><span class="s2">import </span><span class="s1">b64decode</span>

<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">utils </span><span class="s2">import </span><span class="s1">get_link_path</span>
<span class="s2">from </span><span class="s1">selenium</span><span class="s3">.</span><span class="s1">webdriver</span><span class="s3">.</span><span class="s1">remote</span><span class="s3">.</span><span class="s1">webelement </span><span class="s2">import </span><span class="s1">WebElement</span>
<span class="s2">from </span><span class="s1">selenium</span><span class="s3">.</span><span class="s1">webdriver</span><span class="s3">.</span><span class="s1">common</span><span class="s3">.</span><span class="s1">print_page_options </span><span class="s2">import </span><span class="s1">PrintOptions</span><span class="s3">, </span><span class="s1">Orientation</span>

<span class="s2">from </span><span class="s1">SeleniumLibrary</span><span class="s3">.</span><span class="s1">base </span><span class="s2">import </span><span class="s1">LibraryComponent</span><span class="s3">, </span><span class="s1">keyword</span>
<span class="s2">from </span><span class="s1">SeleniumLibrary</span><span class="s3">.</span><span class="s1">utils</span><span class="s3">.</span><span class="s1">path_formatter </span><span class="s2">import </span><span class="s1">_format_path</span>

<span class="s1">DEFAULT_FILENAME_PAGE </span><span class="s3">= </span><span class="s4">&quot;selenium-screenshot-{index}.png&quot;</span>
<span class="s1">DEFAULT_FILENAME_ELEMENT </span><span class="s3">= </span><span class="s4">&quot;selenium-element-screenshot-{index}.png&quot;</span>
<span class="s1">EMBED </span><span class="s3">= </span><span class="s4">&quot;EMBED&quot;</span>
<span class="s1">DEFAULT_FILENAME_PDF </span><span class="s3">= </span><span class="s4">&quot;selenium-page-{index}.pdf&quot;</span>


<span class="s2">class </span><span class="s1">ScreenshotKeywords</span><span class="s3">(</span><span class="s1">LibraryComponent</span><span class="s3">):</span>
    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">set_screenshot_directory</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">path</span><span class="s3">: </span><span class="s1">Union</span><span class="s3">[</span><span class="s2">None</span><span class="s3">, </span><span class="s1">str</span><span class="s3">]) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s5">&quot;&quot;&quot;Sets the directory for captured screenshots. 
 
        ``path`` argument specifies the absolute path to a directory where 
        the screenshots should be written to. If the directory does not 
        exist, it will be created. The directory can also be set when 
        `importing` the library. If it is not configured anywhere, 
        screenshots are saved to the same directory where Robot Framework's 
        log file is written. 
 
        If ``path`` equals to EMBED (case insensitive) and 
        `Capture Page Screenshot` or `capture Element Screenshot` keywords 
        filename argument is not changed from the default value, then 
        the page or element screenshot is embedded as Base64 image to 
        the log.html. 
 
        The previous value is returned and can be used to restore 
        the original value later if needed. 
 
        Returning the previous value is new in SeleniumLibrary 3.0. 
        The persist argument was removed in SeleniumLibrary 3.2 and 
        EMBED is new in SeleniumLibrary 4.2. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">path </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">path </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s2">elif </span><span class="s1">path</span><span class="s3">.</span><span class="s1">upper</span><span class="s3">() == </span><span class="s1">EMBED</span><span class="s3">:</span>
            <span class="s1">path </span><span class="s3">= </span><span class="s1">EMBED</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">path </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">abspath</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_create_directory</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>
        <span class="s1">previous </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_screenshot_root_directory</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_screenshot_root_directory </span><span class="s3">= </span><span class="s1">path</span>
        <span class="s2">return </span><span class="s1">previous</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">capture_page_screenshot</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s1">DEFAULT_FILENAME_PAGE</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s5">&quot;&quot;&quot;Takes a screenshot of the current page and embeds it into a log file. 
 
        ``filename`` argument specifies the name of the file to write the 
        screenshot into. The directory where screenshots are saved can be 
        set when `importing` the library or by using the `Set Screenshot 
        Directory` keyword. If the directory is not configured, screenshots 
        are saved to the same directory where Robot Framework's log file is 
        written. 
 
        If ``filename`` equals to EMBED (case insensitive), then screenshot 
        is embedded as Base64 image to the log.html. In this case file is not 
        created in the filesystem. 
 
        Starting from SeleniumLibrary 1.8, if ``filename`` contains marker 
        ``{index}``, it will be automatically replaced with an unique running 
        index, preventing files to be overwritten. Indices start from 1, 
        and how they are represented can be customized using Python's 
        [https://docs.python.org/3/library/string.html#format-string-syntax| 
        format string syntax]. 
 
        An absolute path to the created screenshot file is returned or if 
        ``filename``  equals to EMBED, word `EMBED` is returned. 
 
        Support for EMBED is new in SeleniumLibrary 4.2 
 
        Examples: 
        | `Capture Page Screenshot` |                                        | 
        | `File Should Exist`       | ${OUTPUTDIR}/selenium-screenshot-1.png | 
        | ${path} =                 | `Capture Page Screenshot`              | 
        | `File Should Exist`       | ${OUTPUTDIR}/selenium-screenshot-2.png | 
        | `File Should Exist`       | ${path}                                | 
        | `Capture Page Screenshot` | custom_name.png                        | 
        | `File Should Exist`       | ${OUTPUTDIR}/custom_name.png           | 
        | `Capture Page Screenshot` | custom_with_index_{index}.png          | 
        | `File Should Exist`       | ${OUTPUTDIR}/custom_with_index_1.png   | 
        | `Capture Page Screenshot` | formatted_index_{index:03}.png         | 
        | `File Should Exist`       | ${OUTPUTDIR}/formatted_index_001.png   | 
        | `Capture Page Screenshot` | EMBED                                  | 
        | `File Should Not Exist`   | EMBED                                  | 
        &quot;&quot;&quot;</span>
        <span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">current</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s4">&quot;Cannot capture screenshot because no browser is open.&quot;</span><span class="s3">)</span>
            <span class="s2">return</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_decide_embedded</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_capture_page_screen_to_log</span><span class="s3">()</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_capture_page_screenshot_to_file</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_capture_page_screenshot_to_file</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">):</span>
        <span class="s1">path </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_screenshot_path</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_create_directory</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>
        <span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">save_screenshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">):</span>
            <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">f&quot;Failed to save screenshot '</span><span class="s2">{</span><span class="s1">path</span><span class="s2">}</span><span class="s4">'.&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_embed_to_log_as_file</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s6">800</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">path</span>

    <span class="s2">def </span><span class="s1">_capture_page_screen_to_log</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">screenshot_as_base64 </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">get_screenshot_as_base64</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_embed_to_log_as_base64</span><span class="s3">(</span><span class="s1">screenshot_as_base64</span><span class="s3">, </span><span class="s6">800</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">EMBED</span>

    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">capture_element_screenshot</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">locator</span><span class="s3">: </span><span class="s1">Union</span><span class="s3">[</span><span class="s1">WebElement</span><span class="s3">, </span><span class="s1">str</span><span class="s3">],</span>
        <span class="s1">filename</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s1">DEFAULT_FILENAME_ELEMENT</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s5">&quot;&quot;&quot;Captures a screenshot from the element identified by ``locator`` and embeds it into log file. 
 
        See `Capture Page Screenshot` for details about ``filename`` argument. 
        See the `Locating elements` section for details about the locator 
        syntax. 
 
        An absolute path to the created element screenshot is returned. 
 
        Support for capturing the screenshot from an element has limited support 
        among browser vendors. Please check the browser vendor driver documentation 
        does the browser support capturing a screenshot from an element. 
 
        New in SeleniumLibrary 3.3. Support for EMBED is new in SeleniumLibrary 4.2. 
 
        Examples: 
        | `Capture Element Screenshot` | id:image_id |                                | 
        | `Capture Element Screenshot` | id:image_id | ${OUTPUTDIR}/id_image_id-1.png | 
        | `Capture Element Screenshot` | id:image_id | EMBED                          | 
        &quot;&quot;&quot;</span>
        <span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">current</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span>
                <span class="s4">&quot;Cannot capture screenshot from element because no browser is open.&quot;</span>
            <span class="s3">)</span>
            <span class="s2">return</span>
        <span class="s1">element </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">find_element</span><span class="s3">(</span><span class="s1">locator</span><span class="s3">, </span><span class="s1">required</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_decide_embedded</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_capture_element_screen_to_log</span><span class="s3">(</span><span class="s1">element</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_capture_element_screenshot_to_file</span><span class="s3">(</span><span class="s1">element</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_capture_element_screenshot_to_file</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">element</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">):</span>
        <span class="s1">path </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_screenshot_path</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_create_directory</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>
        <span class="s2">if not </span><span class="s1">element</span><span class="s3">.</span><span class="s1">screenshot</span><span class="s3">(</span><span class="s1">path</span><span class="s3">):</span>
            <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">f&quot;Failed to save element screenshot '</span><span class="s2">{</span><span class="s1">path</span><span class="s2">}</span><span class="s4">'.&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_embed_to_log_as_file</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s6">400</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">path</span>

    <span class="s2">def </span><span class="s1">_capture_element_screen_to_log</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">element</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_embed_to_log_as_base64</span><span class="s3">(</span><span class="s1">element</span><span class="s3">.</span><span class="s1">screenshot_as_base64</span><span class="s3">, </span><span class="s6">400</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">EMBED</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">_screenshot_root_directory</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">screenshot_root_directory</span>

    <span class="s3">@</span><span class="s1">_screenshot_root_directory</span><span class="s3">.</span><span class="s1">setter</span>
    <span class="s2">def </span><span class="s1">_screenshot_root_directory</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">value</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ctx</span><span class="s3">.</span><span class="s1">screenshot_root_directory </span><span class="s3">= </span><span class="s1">value</span>

    <span class="s2">def </span><span class="s1">_decide_embedded</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">):</span>
        <span class="s1">filename </span><span class="s3">= </span><span class="s1">filename</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s3">(</span>
            <span class="s1">filename </span><span class="s3">== </span><span class="s1">DEFAULT_FILENAME_PAGE</span>
            <span class="s2">and </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_screenshot_root_directory </span><span class="s3">== </span><span class="s1">EMBED</span>
        <span class="s3">):</span>
            <span class="s2">return True</span>
        <span class="s2">if </span><span class="s3">(</span>
            <span class="s1">filename </span><span class="s3">== </span><span class="s1">DEFAULT_FILENAME_ELEMENT</span>
            <span class="s2">and </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_screenshot_root_directory </span><span class="s3">== </span><span class="s1">EMBED</span>
        <span class="s3">):</span>
            <span class="s2">return True</span>
        <span class="s2">if </span><span class="s1">filename </span><span class="s3">== </span><span class="s1">EMBED</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">():</span>
            <span class="s2">return True</span>
        <span class="s2">return False</span>

    <span class="s2">def </span><span class="s1">_get_screenshot_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_screenshot_root_directory </span><span class="s3">!= </span><span class="s1">EMBED</span><span class="s3">:</span>
            <span class="s1">directory </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_screenshot_root_directory </span><span class="s2">or </span><span class="s1">self</span><span class="s3">.</span><span class="s1">log_dir</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">directory </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">log_dir</span>
        <span class="s1">filename </span><span class="s3">= </span><span class="s1">filename</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;/&quot;</span><span class="s3">, </span><span class="s1">os</span><span class="s3">.</span><span class="s1">sep</span><span class="s3">)</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s6">0</span>
        <span class="s2">while True</span><span class="s3">:</span>
            <span class="s1">index </span><span class="s3">+= </span><span class="s6">1</span>
            <span class="s1">formatted </span><span class="s3">= </span><span class="s1">_format_path</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">, </span><span class="s1">index</span><span class="s3">)</span>
            <span class="s1">path </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">directory</span><span class="s3">, </span><span class="s1">formatted</span><span class="s3">)</span>
            <span class="s0"># filename didn't contain {index} or unique path was found</span>
            <span class="s2">if </span><span class="s1">formatted </span><span class="s3">== </span><span class="s1">filename </span><span class="s2">or not </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">exists</span><span class="s3">(</span><span class="s1">path</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">path</span>

    <span class="s2">def </span><span class="s1">_create_directory</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">path</span><span class="s3">):</span>
        <span class="s1">target_dir </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">dirname</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>
        <span class="s2">if not </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">exists</span><span class="s3">(</span><span class="s1">target_dir</span><span class="s3">):</span>
            <span class="s1">os</span><span class="s3">.</span><span class="s1">makedirs</span><span class="s3">(</span><span class="s1">target_dir</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_embed_to_log_as_base64</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">screenshot_as_base64</span><span class="s3">, </span><span class="s1">width</span><span class="s3">):</span>
        <span class="s0"># base64 image is shown as on its own row and thus previous row is closed on</span>
        <span class="s0"># purpose. Depending on Robot's log structure is a bit risky.</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span>
            <span class="s4">'&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;'</span>
            <span class="s4">'&lt;img alt=&quot;screenshot&quot; class=&quot;robot-seleniumlibrary-screenshot&quot; '</span>
            <span class="s4">f'src=&quot;data:image/png;base64,</span><span class="s2">{</span><span class="s1">screenshot_as_base64</span><span class="s2">}</span><span class="s4">&quot; width=&quot;</span><span class="s2">{</span><span class="s1">width</span><span class="s2">}</span><span class="s4">px&quot;&gt;'</span><span class="s3">,</span>
            <span class="s1">html</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_embed_to_log_as_file</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s1">width</span><span class="s3">):</span>
        <span class="s0"># Image is shown on its own row and thus previous row is closed on</span>
        <span class="s0"># purpose. Depending on Robot's log structure is a bit risky.</span>
        <span class="s1">src </span><span class="s3">= </span><span class="s1">get_link_path</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">log_dir</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span>
            <span class="s4">'&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;'</span>
            <span class="s4">f'&lt;a href=&quot;</span><span class="s2">{</span><span class="s1">src</span><span class="s2">}</span><span class="s4">&quot;&gt;&lt;img src=&quot;</span><span class="s2">{</span><span class="s1">src</span><span class="s2">}</span><span class="s4">&quot; width=&quot;</span><span class="s2">{</span><span class="s1">width</span><span class="s2">}</span><span class="s4">px&quot;&gt;&lt;/a&gt;'</span><span class="s3">,</span>
            <span class="s1">html</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s3">)</span>
    
    <span class="s3">@</span><span class="s1">keyword</span>
    <span class="s2">def </span><span class="s1">print_page_as_pdf</span><span class="s3">(</span><span class="s1">self</span><span class="s3">,</span>
                            <span class="s1">filename</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s1">DEFAULT_FILENAME_PDF</span><span class="s3">,</span>
                            <span class="s1">background</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">bool</span><span class="s3">]  = </span><span class="s2">None</span><span class="s3">,</span>
                            <span class="s1">margin_bottom</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">float</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
                            <span class="s1">margin_left</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">float</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
                            <span class="s1">margin_right</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">float</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
                            <span class="s1">margin_top</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">float</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
                            <span class="s1">orientation</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">Orientation</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
	                        <span class="s1">page_height</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">float</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
                            <span class="s1">page_ranges</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">list</span><span class="s3">]  = </span><span class="s2">None</span><span class="s3">,</span>
                            <span class="s1">page_width</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">float</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
                            <span class="s1">scale</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">float</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
	                        <span class="s1">shrink_to_fit</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">bool</span><span class="s3">]  = </span><span class="s2">None</span><span class="s3">,</span>
                            <span class="s0"># path_to_file=None,</span>
                         <span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot; Print the current page as a PDF 
 
        ``page_ranges`` defaults to `['-']` or &quot;all&quot; pages. ``page_ranges`` takes a list of 
        strings indicating the ranges. 
 
        The page size defaults to 21.59 for ``page_width`` and 27.94 for ``page_height``. 
        This is the equivalent size of US-Letter. The assumed units on these parameters 
        is centimeters. 
 
        The default margin for top, left, bottom, right is `1`. The assumed units on 
        these parameters is centimeters. 
 
        The default ``orientation`` is `portrait`. ``orientation`` can be either `portrait` 
        or `landscape`. 
 
        The default ``scale`` is `1`. ``scale`` must be greater than or equal to `0.1` and 
        less than or equal to `2`. 
 
        ``background`` and ``scale_to_fit`` can be either `${True}` or `${False}`.. 
 
        If all print options are None then a pdf will fail to print silently. 
        &quot;&quot;&quot;</span>

        <span class="s2">if </span><span class="s1">page_ranges </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">page_ranges </span><span class="s3">= [</span><span class="s4">'-'</span><span class="s3">]</span>

        <span class="s1">print_options </span><span class="s3">= </span><span class="s1">PrintOptions</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s1">background </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">background </span><span class="s3">=  </span><span class="s1">background</span>
        <span class="s2">if </span><span class="s1">margin_bottom </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">margin_bottom </span><span class="s3">= </span><span class="s1">margin_bottom</span>
        <span class="s2">if </span><span class="s1">margin_left </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">margin_left </span><span class="s3">= </span><span class="s1">margin_left</span>
        <span class="s2">if </span><span class="s1">margin_right </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">margin_right </span><span class="s3">= </span><span class="s1">margin_right</span>
        <span class="s2">if </span><span class="s1">margin_top </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">margin_top </span><span class="s3">= </span><span class="s1">margin_top</span>
        <span class="s2">if </span><span class="s1">orientation </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">orientation </span><span class="s3">= </span><span class="s1">orientation</span>
        <span class="s2">if </span><span class="s1">page_height </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">page_height </span><span class="s3">= </span><span class="s1">page_height</span>
        <span class="s2">if </span><span class="s1">page_ranges </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">page_ranges </span><span class="s3">= </span><span class="s1">page_ranges</span>
        <span class="s2">if </span><span class="s1">page_width </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">page_width </span><span class="s3">= </span><span class="s1">page_width</span>
        <span class="s2">if </span><span class="s1">scale </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">scale </span><span class="s3">= </span><span class="s1">scale</span>
        <span class="s2">if </span><span class="s1">shrink_to_fit </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">print_options</span><span class="s3">.</span><span class="s1">shrink_to_fit </span><span class="s3">= </span><span class="s1">shrink_to_fit</span>

        <span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">drivers</span><span class="s3">.</span><span class="s1">current</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">info</span><span class="s3">(</span><span class="s4">&quot;Cannot print page to pdf because no browser is open.&quot;</span><span class="s3">)</span>
            <span class="s2">return</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_print_page_as_pdf_to_file</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">, </span><span class="s1">print_options</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_print_page_as_pdf_to_file</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">, </span><span class="s1">options</span><span class="s3">):</span>
        <span class="s1">path </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_pdf_path</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_create_directory</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>
        <span class="s1">pdfdata </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">driver</span><span class="s3">.</span><span class="s1">print_page</span><span class="s3">(</span><span class="s1">options</span><span class="s3">)</span>
        <span class="s2">if not </span><span class="s1">pdfdata</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">f&quot;Failed to print page.&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_save_pdf_to_file</span><span class="s3">(</span><span class="s1">pdfdata</span><span class="s3">, </span><span class="s1">path</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">path</span>

    <span class="s2">def </span><span class="s1">_save_pdf_to_file</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">pdfbase64</span><span class="s3">, </span><span class="s1">path</span><span class="s3">):</span>
        <span class="s1">pdfdata </span><span class="s3">= </span><span class="s1">b64decode</span><span class="s3">(</span><span class="s1">pdfbase64</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">open</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">mode</span><span class="s3">=</span><span class="s4">'wb'</span><span class="s3">) </span><span class="s2">as </span><span class="s1">pdf</span><span class="s3">:</span>
            <span class="s1">pdf</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">pdfdata</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_get_pdf_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">):</span>
        <span class="s1">directory </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">log_dir</span>
        <span class="s1">filename </span><span class="s3">= </span><span class="s1">filename</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;/&quot;</span><span class="s3">, </span><span class="s1">os</span><span class="s3">.</span><span class="s1">sep</span><span class="s3">)</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s6">0</span>
        <span class="s2">while True</span><span class="s3">:</span>
            <span class="s1">index </span><span class="s3">+= </span><span class="s6">1</span>
            <span class="s1">formatted </span><span class="s3">= </span><span class="s1">_format_path</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">, </span><span class="s1">index</span><span class="s3">)</span>
            <span class="s1">path </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">directory</span><span class="s3">, </span><span class="s1">formatted</span><span class="s3">)</span>
            <span class="s0"># filename didn't contain {index} or unique path was found</span>
            <span class="s2">if </span><span class="s1">formatted </span><span class="s3">== </span><span class="s1">filename </span><span class="s2">or not </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">exists</span><span class="s3">(</span><span class="s1">path</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">path</span>
</pre>
</body>
</html>