<html>
<head>
<title>_generated_io_windows.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_generated_io_windows.py</font>
</center></td></tr></table>
<pre><span class="s0"># ***********************************************************</span>
<span class="s0"># ******* WARNING: AUTOGENERATED! ALL EDITS WILL BE LOST ******</span>
<span class="s0"># *************************************************************</span>
<span class="s2">from </span><span class="s1">__future__ </span><span class="s2">import </span><span class="s1">annotations</span>

<span class="s2">import </span><span class="s1">sys</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">TYPE_CHECKING</span>

<span class="s2">from </span><span class="s3">.</span><span class="s1">_ki </span><span class="s2">import </span><span class="s1">enable_ki_protection</span>
<span class="s2">from </span><span class="s3">.</span><span class="s1">_run </span><span class="s2">import </span><span class="s1">GLOBAL_RUN_CONTEXT</span>

<span class="s2">if </span><span class="s1">TYPE_CHECKING</span><span class="s3">:</span>
    <span class="s2">from </span><span class="s1">contextlib </span><span class="s2">import </span><span class="s1">AbstractContextManager</span>

    <span class="s2">from </span><span class="s1">typing_extensions </span><span class="s2">import </span><span class="s1">Buffer</span>

    <span class="s2">from </span><span class="s3">..</span><span class="s1">_file_io </span><span class="s2">import </span><span class="s1">_HasFileNo</span>
    <span class="s2">from </span><span class="s3">.</span><span class="s1">_unbounded_queue </span><span class="s2">import </span><span class="s1">UnboundedQueue</span>
    <span class="s2">from </span><span class="s3">.</span><span class="s1">_windows_cffi </span><span class="s2">import </span><span class="s1">CData</span><span class="s3">, </span><span class="s1">Handle</span>

<span class="s2">assert not </span><span class="s1">TYPE_CHECKING </span><span class="s2">or </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">platform </span><span class="s3">== </span><span class="s4">&quot;win32&quot;</span>


<span class="s1">__all__ </span><span class="s3">= [</span>
    <span class="s4">&quot;current_iocp&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;monitor_completion_key&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;notify_closing&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;readinto_overlapped&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;register_with_iocp&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;wait_overlapped&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;wait_readable&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;wait_writable&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;write_overlapped&quot;</span><span class="s3">,</span>
<span class="s3">]</span>


<span class="s3">@</span><span class="s1">enable_ki_protection</span>
<span class="s2">async def </span><span class="s1">wait_readable</span><span class="s3">(</span><span class="s1">sock</span><span class="s3">: </span><span class="s1">_HasFileNo </span><span class="s3">| </span><span class="s1">int</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s5">&quot;&quot;&quot;Block until the kernel reports that the given object is readable. 
 
    On Unix systems, ``sock`` must either be an integer file descriptor, 
    or else an object with a ``.fileno()`` method which returns an 
    integer file descriptor. Any kind of file descriptor can be passed, 
    though the exact semantics will depend on your kernel. For example, 
    this probably won't do anything useful for on-disk files. 
 
    On Windows systems, ``sock`` must either be an integer ``SOCKET`` 
    handle, or else an object with a ``.fileno()`` method which returns 
    an integer ``SOCKET`` handle. File descriptors aren't supported, 
    and neither are handles that refer to anything besides a 
    ``SOCKET``. 
 
    :raises trio.BusyResourceError: 
        if another task is already waiting for the given socket to 
        become readable. 
    :raises trio.ClosedResourceError: 
        if another task calls :func:`notify_closing` while this 
        function is still working. 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return await </span><span class="s1">GLOBAL_RUN_CONTEXT</span><span class="s3">.</span><span class="s1">runner</span><span class="s3">.</span><span class="s1">io_manager</span><span class="s3">.</span><span class="s1">wait_readable</span><span class="s3">(</span><span class="s1">sock</span><span class="s3">)</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">&quot;must be called from async context&quot;</span><span class="s3">) </span><span class="s2">from None</span>


<span class="s3">@</span><span class="s1">enable_ki_protection</span>
<span class="s2">async def </span><span class="s1">wait_writable</span><span class="s3">(</span><span class="s1">sock</span><span class="s3">: </span><span class="s1">_HasFileNo </span><span class="s3">| </span><span class="s1">int</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s5">&quot;&quot;&quot;Block until the kernel reports that the given object is writable. 
 
    See `wait_readable` for the definition of ``sock``. 
 
    :raises trio.BusyResourceError: 
        if another task is already waiting for the given socket to 
        become writable. 
    :raises trio.ClosedResourceError: 
        if another task calls :func:`notify_closing` while this 
        function is still working. 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return await </span><span class="s1">GLOBAL_RUN_CONTEXT</span><span class="s3">.</span><span class="s1">runner</span><span class="s3">.</span><span class="s1">io_manager</span><span class="s3">.</span><span class="s1">wait_writable</span><span class="s3">(</span><span class="s1">sock</span><span class="s3">)</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">&quot;must be called from async context&quot;</span><span class="s3">) </span><span class="s2">from None</span>


<span class="s3">@</span><span class="s1">enable_ki_protection</span>
<span class="s2">def </span><span class="s1">notify_closing</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">: </span><span class="s1">Handle </span><span class="s3">| </span><span class="s1">int </span><span class="s3">| </span><span class="s1">_HasFileNo</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s5">&quot;&quot;&quot;Notify waiters of the given object that it will be closed. 
 
    Call this before closing a file descriptor (on Unix) or socket (on 
    Windows). This will cause any `wait_readable` or `wait_writable` 
    calls on the given object to immediately wake up and raise 
    `~trio.ClosedResourceError`. 
 
    This doesn't actually close the object â€“ you still have to do that 
    yourself afterwards. Also, you want to be careful to make sure no 
    new tasks start waiting on the object in between when you call this 
    and when it's actually closed. So to close something properly, you 
    usually want to do these steps in order: 
 
    1. Explicitly mark the object as closed, so that any new attempts 
       to use it will abort before they start. 
    2. Call `notify_closing` to wake up any already-existing users. 
    3. Actually close the object. 
 
    It's also possible to do them in a different order if that's more 
    convenient, *but only if* you make sure not to have any checkpoints in 
    between the steps. This way they all happen in a single atomic 
    step, so other tasks won't be able to tell what order they happened 
    in anyway. 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">GLOBAL_RUN_CONTEXT</span><span class="s3">.</span><span class="s1">runner</span><span class="s3">.</span><span class="s1">io_manager</span><span class="s3">.</span><span class="s1">notify_closing</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">)</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">&quot;must be called from async context&quot;</span><span class="s3">) </span><span class="s2">from None</span>


<span class="s3">@</span><span class="s1">enable_ki_protection</span>
<span class="s2">def </span><span class="s1">register_with_iocp</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s1">CData</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s5">&quot;&quot;&quot;TODO: these are implemented, but are currently more of a sketch than 
    anything real. See `#26 
    &lt;https://github.com/python-trio/trio/issues/26&gt;`__ and `#52 
    &lt;https://github.com/python-trio/trio/issues/52&gt;`__. 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">GLOBAL_RUN_CONTEXT</span><span class="s3">.</span><span class="s1">runner</span><span class="s3">.</span><span class="s1">io_manager</span><span class="s3">.</span><span class="s1">register_with_iocp</span><span class="s3">(</span><span class="s1">handle</span><span class="s3">)</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">&quot;must be called from async context&quot;</span><span class="s3">) </span><span class="s2">from None</span>


<span class="s3">@</span><span class="s1">enable_ki_protection</span>
<span class="s2">async def </span><span class="s1">wait_overlapped</span><span class="s3">(</span><span class="s1">handle_</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s1">CData</span><span class="s3">, </span><span class="s1">lpOverlapped</span><span class="s3">: </span><span class="s1">CData </span><span class="s3">| </span><span class="s1">int</span><span class="s3">) </span><span class="s1">-&gt; object</span><span class="s3">:</span>
    <span class="s5">&quot;&quot;&quot;TODO: these are implemented, but are currently more of a sketch than 
    anything real. See `#26 
    &lt;https://github.com/python-trio/trio/issues/26&gt;`__ and `#52 
    &lt;https://github.com/python-trio/trio/issues/52&gt;`__. 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return await </span><span class="s1">GLOBAL_RUN_CONTEXT</span><span class="s3">.</span><span class="s1">runner</span><span class="s3">.</span><span class="s1">io_manager</span><span class="s3">.</span><span class="s1">wait_overlapped</span><span class="s3">(</span>
            <span class="s1">handle_</span><span class="s3">, </span><span class="s1">lpOverlapped</span>
        <span class="s3">)</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">&quot;must be called from async context&quot;</span><span class="s3">) </span><span class="s2">from None</span>


<span class="s3">@</span><span class="s1">enable_ki_protection</span>
<span class="s2">async def </span><span class="s1">write_overlapped</span><span class="s3">(</span>
    <span class="s1">handle</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s1">CData</span><span class="s3">, </span><span class="s1">data</span><span class="s3">: </span><span class="s1">Buffer</span><span class="s3">, </span><span class="s1">file_offset</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= </span><span class="s6">0</span>
<span class="s3">) </span><span class="s1">-&gt; int</span><span class="s3">:</span>
    <span class="s5">&quot;&quot;&quot;TODO: these are implemented, but are currently more of a sketch than 
    anything real. See `#26 
    &lt;https://github.com/python-trio/trio/issues/26&gt;`__ and `#52 
    &lt;https://github.com/python-trio/trio/issues/52&gt;`__. 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return await </span><span class="s1">GLOBAL_RUN_CONTEXT</span><span class="s3">.</span><span class="s1">runner</span><span class="s3">.</span><span class="s1">io_manager</span><span class="s3">.</span><span class="s1">write_overlapped</span><span class="s3">(</span>
            <span class="s1">handle</span><span class="s3">, </span><span class="s1">data</span><span class="s3">, </span><span class="s1">file_offset</span>
        <span class="s3">)</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">&quot;must be called from async context&quot;</span><span class="s3">) </span><span class="s2">from None</span>


<span class="s3">@</span><span class="s1">enable_ki_protection</span>
<span class="s2">async def </span><span class="s1">readinto_overlapped</span><span class="s3">(</span>
    <span class="s1">handle</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s1">CData</span><span class="s3">, </span><span class="s1">buffer</span><span class="s3">: </span><span class="s1">Buffer</span><span class="s3">, </span><span class="s1">file_offset</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= </span><span class="s6">0</span>
<span class="s3">) </span><span class="s1">-&gt; int</span><span class="s3">:</span>
    <span class="s5">&quot;&quot;&quot;TODO: these are implemented, but are currently more of a sketch than 
    anything real. See `#26 
    &lt;https://github.com/python-trio/trio/issues/26&gt;`__ and `#52 
    &lt;https://github.com/python-trio/trio/issues/52&gt;`__. 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return await </span><span class="s1">GLOBAL_RUN_CONTEXT</span><span class="s3">.</span><span class="s1">runner</span><span class="s3">.</span><span class="s1">io_manager</span><span class="s3">.</span><span class="s1">readinto_overlapped</span><span class="s3">(</span>
            <span class="s1">handle</span><span class="s3">, </span><span class="s1">buffer</span><span class="s3">, </span><span class="s1">file_offset</span>
        <span class="s3">)</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">&quot;must be called from async context&quot;</span><span class="s3">) </span><span class="s2">from None</span>


<span class="s3">@</span><span class="s1">enable_ki_protection</span>
<span class="s2">def </span><span class="s1">current_iocp</span><span class="s3">() </span><span class="s1">-&gt; int</span><span class="s3">:</span>
    <span class="s5">&quot;&quot;&quot;TODO: these are implemented, but are currently more of a sketch than 
    anything real. See `#26 
    &lt;https://github.com/python-trio/trio/issues/26&gt;`__ and `#52 
    &lt;https://github.com/python-trio/trio/issues/52&gt;`__. 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">GLOBAL_RUN_CONTEXT</span><span class="s3">.</span><span class="s1">runner</span><span class="s3">.</span><span class="s1">io_manager</span><span class="s3">.</span><span class="s1">current_iocp</span><span class="s3">()</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">&quot;must be called from async context&quot;</span><span class="s3">) </span><span class="s2">from None</span>


<span class="s3">@</span><span class="s1">enable_ki_protection</span>
<span class="s2">def </span><span class="s1">monitor_completion_key</span><span class="s3">() </span><span class="s1">-&gt; </span><span class="s3">(</span>
    <span class="s1">AbstractContextManager</span><span class="s3">[</span><span class="s1">tuple</span><span class="s3">[</span><span class="s1">int</span><span class="s3">, </span><span class="s1">UnboundedQueue</span><span class="s3">[</span><span class="s1">object</span><span class="s3">]]]</span>
<span class="s3">):</span>
    <span class="s5">&quot;&quot;&quot;TODO: these are implemented, but are currently more of a sketch than 
    anything real. See `#26 
    &lt;https://github.com/python-trio/trio/issues/26&gt;`__ and `#52 
    &lt;https://github.com/python-trio/trio/issues/52&gt;`__. 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">GLOBAL_RUN_CONTEXT</span><span class="s3">.</span><span class="s1">runner</span><span class="s3">.</span><span class="s1">io_manager</span><span class="s3">.</span><span class="s1">monitor_completion_key</span><span class="s3">()</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span><span class="s4">&quot;must be called from async context&quot;</span><span class="s3">) </span><span class="s2">from None</span>
</pre>
</body>
</html>