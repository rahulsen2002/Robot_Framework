<html>
<head>
<title>_functions.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_functions.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">annotations</span>

<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">warnings</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Any</span><span class="s2">, </span><span class="s1">Callable</span><span class="s2">, </span><span class="s1">NoReturn</span><span class="s2">, </span><span class="s1">TypeVar</span><span class="s2">, </span><span class="s1">Union</span><span class="s2">, </span><span class="s1">overload</span>

<span class="s0">from </span><span class="s2">. </span><span class="s0">import </span><span class="s1">_suppression</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">_checkers </span><span class="s0">import </span><span class="s1">BINARY_MAGIC_METHODS</span><span class="s2">, </span><span class="s1">check_type_internal</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">_config </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">CollectionCheckStrategy</span><span class="s2">,</span>
    <span class="s1">ForwardRefPolicy</span><span class="s2">,</span>
    <span class="s1">TypeCheckConfiguration</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">_exceptions </span><span class="s0">import </span><span class="s1">TypeCheckError</span><span class="s2">, </span><span class="s1">TypeCheckWarning</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">_memo </span><span class="s0">import </span><span class="s1">TypeCheckMemo</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">_utils </span><span class="s0">import </span><span class="s1">get_stacklevel</span><span class="s2">, </span><span class="s1">qualified_name</span>

<span class="s0">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&gt;= (</span><span class="s3">3</span><span class="s2">, </span><span class="s3">11</span><span class="s2">):</span>
    <span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Literal</span><span class="s2">, </span><span class="s1">Never</span><span class="s2">, </span><span class="s1">TypeAlias</span>
<span class="s0">else</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">typing_extensions </span><span class="s0">import </span><span class="s1">Literal</span><span class="s2">, </span><span class="s1">Never</span><span class="s2">, </span><span class="s1">TypeAlias</span>

<span class="s1">T </span><span class="s2">= </span><span class="s1">TypeVar</span><span class="s2">(</span><span class="s4">&quot;T&quot;</span><span class="s2">)</span>
<span class="s1">TypeCheckFailCallback</span><span class="s2">: </span><span class="s1">TypeAlias </span><span class="s2">= </span><span class="s1">Callable</span><span class="s2">[[</span><span class="s1">TypeCheckError</span><span class="s2">, </span><span class="s1">TypeCheckMemo</span><span class="s2">], </span><span class="s1">Any</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">overload</span>
<span class="s0">def </span><span class="s1">check_type</span><span class="s2">(</span>
    <span class="s1">value</span><span class="s2">: </span><span class="s1">object</span><span class="s2">,</span>
    <span class="s1">expected_type</span><span class="s2">: </span><span class="s1">type</span><span class="s2">[</span><span class="s1">T</span><span class="s2">],</span>
    <span class="s2">*,</span>
    <span class="s1">forward_ref_policy</span><span class="s2">: </span><span class="s1">ForwardRefPolicy </span><span class="s2">= ...,</span>
    <span class="s1">typecheck_fail_callback</span><span class="s2">: </span><span class="s1">TypeCheckFailCallback </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= ...,</span>
    <span class="s1">collection_check_strategy</span><span class="s2">: </span><span class="s1">CollectionCheckStrategy </span><span class="s2">= ...,</span>
<span class="s2">) </span><span class="s1">-&gt; T</span><span class="s2">: ...</span>


<span class="s2">@</span><span class="s1">overload</span>
<span class="s0">def </span><span class="s1">check_type</span><span class="s2">(</span>
    <span class="s1">value</span><span class="s2">: </span><span class="s1">object</span><span class="s2">,</span>
    <span class="s1">expected_type</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">,</span>
    <span class="s2">*,</span>
    <span class="s1">forward_ref_policy</span><span class="s2">: </span><span class="s1">ForwardRefPolicy </span><span class="s2">= ...,</span>
    <span class="s1">typecheck_fail_callback</span><span class="s2">: </span><span class="s1">TypeCheckFailCallback </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= ...,</span>
    <span class="s1">collection_check_strategy</span><span class="s2">: </span><span class="s1">CollectionCheckStrategy </span><span class="s2">= ...,</span>
<span class="s2">) </span><span class="s1">-&gt; Any</span><span class="s2">: ...</span>


<span class="s0">def </span><span class="s1">check_type</span><span class="s2">(</span>
    <span class="s1">value</span><span class="s2">: </span><span class="s1">object</span><span class="s2">,</span>
    <span class="s1">expected_type</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">,</span>
    <span class="s2">*,</span>
    <span class="s1">forward_ref_policy</span><span class="s2">: </span><span class="s1">ForwardRefPolicy </span><span class="s2">= </span><span class="s1">TypeCheckConfiguration</span><span class="s2">().</span><span class="s1">forward_ref_policy</span><span class="s2">,</span>
    <span class="s1">typecheck_fail_callback</span><span class="s2">: </span><span class="s1">TypeCheckFailCallback </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= (</span>
        <span class="s1">TypeCheckConfiguration</span><span class="s2">().</span><span class="s1">typecheck_fail_callback</span>
    <span class="s2">),</span>
    <span class="s1">collection_check_strategy</span><span class="s2">: </span><span class="s1">CollectionCheckStrategy </span><span class="s2">= (</span>
        <span class="s1">TypeCheckConfiguration</span><span class="s2">().</span><span class="s1">collection_check_strategy</span>
    <span class="s2">),</span>
<span class="s2">) </span><span class="s1">-&gt; Any</span><span class="s2">:</span>
    <span class="s5">&quot;&quot;&quot; 
    Ensure that ``value`` matches ``expected_type``. 
 
    The types from the :mod:`typing` module do not support :func:`isinstance` or 
    :func:`issubclass` so a number of type specific checks are required. This function 
    knows which checker to call for which type. 
 
    This function wraps :func:`~.check_type_internal` in the following ways: 
 
    * Respects type checking suppression (:func:`~.suppress_type_checks`) 
    * Forms a :class:`~.TypeCheckMemo` from the current stack frame 
    * Calls the configured type check fail callback if the check fails 
 
    Note that this function is independent of the globally shared configuration in 
    :data:`typeguard.config`. This means that usage within libraries is safe from being 
    affected configuration changes made by other libraries or by the integrating 
    application. Instead, configuration options have the same default values as their 
    corresponding fields in :class:`TypeCheckConfiguration`. 
 
    :param value: value to be checked against ``expected_type`` 
    :param expected_type: a class or generic type instance, or a tuple of such things 
    :param forward_ref_policy: see :attr:`TypeCheckConfiguration.forward_ref_policy` 
    :param typecheck_fail_callback: 
        see :attr`TypeCheckConfiguration.typecheck_fail_callback` 
    :param collection_check_strategy: 
        see :attr:`TypeCheckConfiguration.collection_check_strategy` 
    :return: ``value``, unmodified 
    :raises TypeCheckError: if there is a type mismatch 
 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">type</span><span class="s2">(</span><span class="s1">expected_type</span><span class="s2">) </span><span class="s0">is </span><span class="s1">tuple</span><span class="s2">:</span>
        <span class="s1">expected_type </span><span class="s2">= </span><span class="s1">Union</span><span class="s2">[</span><span class="s1">expected_type</span><span class="s2">]</span>

    <span class="s1">config </span><span class="s2">= </span><span class="s1">TypeCheckConfiguration</span><span class="s2">(</span>
        <span class="s1">forward_ref_policy</span><span class="s2">=</span><span class="s1">forward_ref_policy</span><span class="s2">,</span>
        <span class="s1">typecheck_fail_callback</span><span class="s2">=</span><span class="s1">typecheck_fail_callback</span><span class="s2">,</span>
        <span class="s1">collection_check_strategy</span><span class="s2">=</span><span class="s1">collection_check_strategy</span><span class="s2">,</span>
    <span class="s2">)</span>

    <span class="s0">if </span><span class="s1">_suppression</span><span class="s2">.</span><span class="s1">type_checks_suppressed </span><span class="s0">or </span><span class="s1">expected_type </span><span class="s0">is </span><span class="s1">Any</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">value</span>

    <span class="s1">frame </span><span class="s2">= </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">_getframe</span><span class="s2">(</span><span class="s3">1</span><span class="s2">)</span>
    <span class="s1">memo </span><span class="s2">= </span><span class="s1">TypeCheckMemo</span><span class="s2">(</span><span class="s1">frame</span><span class="s2">.</span><span class="s1">f_globals</span><span class="s2">, </span><span class="s1">frame</span><span class="s2">.</span><span class="s1">f_locals</span><span class="s2">, </span><span class="s1">config</span><span class="s2">=</span><span class="s1">config</span><span class="s2">)</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">check_type_internal</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">expected_type</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
    <span class="s0">except </span><span class="s1">TypeCheckError </span><span class="s0">as </span><span class="s1">exc</span><span class="s2">:</span>
        <span class="s1">exc</span><span class="s2">.</span><span class="s1">append_path_element</span><span class="s2">(</span><span class="s1">qualified_name</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">add_class_prefix</span><span class="s2">=</span><span class="s0">True</span><span class="s2">))</span>
        <span class="s0">if </span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
            <span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise</span>

    <span class="s0">return </span><span class="s1">value</span>


<span class="s0">def </span><span class="s1">check_argument_types</span><span class="s2">(</span>
    <span class="s1">func_name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
    <span class="s1">arguments</span><span class="s2">: </span><span class="s1">dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">[</span><span class="s1">Any</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]],</span>
    <span class="s1">memo</span><span class="s2">: </span><span class="s1">TypeCheckMemo</span><span class="s2">,</span>
<span class="s2">) </span><span class="s1">-&gt; Literal</span><span class="s2">[</span><span class="s0">True</span><span class="s2">]:</span>
    <span class="s0">if </span><span class="s1">_suppression</span><span class="s2">.</span><span class="s1">type_checks_suppressed</span><span class="s2">:</span>
        <span class="s0">return True</span>

    <span class="s0">for </span><span class="s1">argname</span><span class="s2">, (</span><span class="s1">value</span><span class="s2">, </span><span class="s1">annotation</span><span class="s2">) </span><span class="s0">in </span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
        <span class="s0">if </span><span class="s1">annotation </span><span class="s0">is </span><span class="s1">NoReturn </span><span class="s0">or </span><span class="s1">annotation </span><span class="s0">is </span><span class="s1">Never</span><span class="s2">:</span>
            <span class="s1">exc </span><span class="s2">= </span><span class="s1">TypeCheckError</span><span class="s2">(</span>
                <span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">func_name</span><span class="s0">}</span><span class="s4">() was declared never to be called but it was&quot;</span>
            <span class="s2">)</span>
            <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
                <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">raise </span><span class="s1">exc</span>

        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">check_type_internal</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">annotation</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
        <span class="s0">except </span><span class="s1">TypeCheckError </span><span class="s0">as </span><span class="s1">exc</span><span class="s2">:</span>
            <span class="s1">qualname </span><span class="s2">= </span><span class="s1">qualified_name</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">add_class_prefix</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">exc</span><span class="s2">.</span><span class="s1">append_path_element</span><span class="s2">(</span><span class="s4">f'argument &quot;</span><span class="s0">{</span><span class="s1">argname</span><span class="s0">}</span><span class="s4">&quot; (</span><span class="s0">{</span><span class="s1">qualname</span><span class="s0">}</span><span class="s4">)'</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
                <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">raise</span>

    <span class="s0">return True</span>


<span class="s0">def </span><span class="s1">check_return_type</span><span class="s2">(</span>
    <span class="s1">func_name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
    <span class="s1">retval</span><span class="s2">: </span><span class="s1">T</span><span class="s2">,</span>
    <span class="s1">annotation</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">,</span>
    <span class="s1">memo</span><span class="s2">: </span><span class="s1">TypeCheckMemo</span><span class="s2">,</span>
<span class="s2">) </span><span class="s1">-&gt; T</span><span class="s2">:</span>
    <span class="s0">if </span><span class="s1">_suppression</span><span class="s2">.</span><span class="s1">type_checks_suppressed</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">retval</span>

    <span class="s0">if </span><span class="s1">annotation </span><span class="s0">is </span><span class="s1">NoReturn </span><span class="s0">or </span><span class="s1">annotation </span><span class="s0">is </span><span class="s1">Never</span><span class="s2">:</span>
        <span class="s1">exc </span><span class="s2">= </span><span class="s1">TypeCheckError</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">func_name</span><span class="s0">}</span><span class="s4">() was declared never to return but it did&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
            <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">exc</span>

    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">check_type_internal</span><span class="s2">(</span><span class="s1">retval</span><span class="s2">, </span><span class="s1">annotation</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
    <span class="s0">except </span><span class="s1">TypeCheckError </span><span class="s0">as </span><span class="s1">exc</span><span class="s2">:</span>
        <span class="s6"># Allow NotImplemented if this is a binary magic method (__eq__() et al)</span>
        <span class="s0">if </span><span class="s1">retval </span><span class="s0">is </span><span class="s1">NotImplemented </span><span class="s0">and </span><span class="s1">annotation </span><span class="s0">is </span><span class="s1">bool</span><span class="s2">:</span>
            <span class="s6"># This does (and cannot) not check if it's actually a method</span>
            <span class="s1">func_name </span><span class="s2">= </span><span class="s1">func_name</span><span class="s2">.</span><span class="s1">rsplit</span><span class="s2">(</span><span class="s4">&quot;.&quot;</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)[-</span><span class="s3">1</span><span class="s2">]</span>
            <span class="s0">if </span><span class="s1">func_name </span><span class="s0">in </span><span class="s1">BINARY_MAGIC_METHODS</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">retval</span>

        <span class="s1">qualname </span><span class="s2">= </span><span class="s1">qualified_name</span><span class="s2">(</span><span class="s1">retval</span><span class="s2">, </span><span class="s1">add_class_prefix</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">exc</span><span class="s2">.</span><span class="s1">append_path_element</span><span class="s2">(</span><span class="s4">f&quot;the return value (</span><span class="s0">{</span><span class="s1">qualname</span><span class="s0">}</span><span class="s4">)&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
            <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise</span>

    <span class="s0">return </span><span class="s1">retval</span>


<span class="s0">def </span><span class="s1">check_send_type</span><span class="s2">(</span>
    <span class="s1">func_name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
    <span class="s1">sendval</span><span class="s2">: </span><span class="s1">T</span><span class="s2">,</span>
    <span class="s1">annotation</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">,</span>
    <span class="s1">memo</span><span class="s2">: </span><span class="s1">TypeCheckMemo</span><span class="s2">,</span>
<span class="s2">) </span><span class="s1">-&gt; T</span><span class="s2">:</span>
    <span class="s0">if </span><span class="s1">_suppression</span><span class="s2">.</span><span class="s1">type_checks_suppressed</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">sendval</span>

    <span class="s0">if </span><span class="s1">annotation </span><span class="s0">is </span><span class="s1">NoReturn </span><span class="s0">or </span><span class="s1">annotation </span><span class="s0">is </span><span class="s1">Never</span><span class="s2">:</span>
        <span class="s1">exc </span><span class="s2">= </span><span class="s1">TypeCheckError</span><span class="s2">(</span>
            <span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">func_name</span><span class="s0">}</span><span class="s4">() was declared never to be sent a value to but it was&quot;</span>
        <span class="s2">)</span>
        <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
            <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">exc</span>

    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">check_type_internal</span><span class="s2">(</span><span class="s1">sendval</span><span class="s2">, </span><span class="s1">annotation</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
    <span class="s0">except </span><span class="s1">TypeCheckError </span><span class="s0">as </span><span class="s1">exc</span><span class="s2">:</span>
        <span class="s1">qualname </span><span class="s2">= </span><span class="s1">qualified_name</span><span class="s2">(</span><span class="s1">sendval</span><span class="s2">, </span><span class="s1">add_class_prefix</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">exc</span><span class="s2">.</span><span class="s1">append_path_element</span><span class="s2">(</span><span class="s4">f&quot;the value sent to generator (</span><span class="s0">{</span><span class="s1">qualname</span><span class="s0">}</span><span class="s4">)&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
            <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise</span>

    <span class="s0">return </span><span class="s1">sendval</span>


<span class="s0">def </span><span class="s1">check_yield_type</span><span class="s2">(</span>
    <span class="s1">func_name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
    <span class="s1">yieldval</span><span class="s2">: </span><span class="s1">T</span><span class="s2">,</span>
    <span class="s1">annotation</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">,</span>
    <span class="s1">memo</span><span class="s2">: </span><span class="s1">TypeCheckMemo</span><span class="s2">,</span>
<span class="s2">) </span><span class="s1">-&gt; T</span><span class="s2">:</span>
    <span class="s0">if </span><span class="s1">_suppression</span><span class="s2">.</span><span class="s1">type_checks_suppressed</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">yieldval</span>

    <span class="s0">if </span><span class="s1">annotation </span><span class="s0">is </span><span class="s1">NoReturn </span><span class="s0">or </span><span class="s1">annotation </span><span class="s0">is </span><span class="s1">Never</span><span class="s2">:</span>
        <span class="s1">exc </span><span class="s2">= </span><span class="s1">TypeCheckError</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">func_name</span><span class="s0">}</span><span class="s4">() was declared never to yield but it did&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
            <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">exc</span>

    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">check_type_internal</span><span class="s2">(</span><span class="s1">yieldval</span><span class="s2">, </span><span class="s1">annotation</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
    <span class="s0">except </span><span class="s1">TypeCheckError </span><span class="s0">as </span><span class="s1">exc</span><span class="s2">:</span>
        <span class="s1">qualname </span><span class="s2">= </span><span class="s1">qualified_name</span><span class="s2">(</span><span class="s1">yieldval</span><span class="s2">, </span><span class="s1">add_class_prefix</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">exc</span><span class="s2">.</span><span class="s1">append_path_element</span><span class="s2">(</span><span class="s4">f&quot;the yielded value (</span><span class="s0">{</span><span class="s1">qualname</span><span class="s0">}</span><span class="s4">)&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
            <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise</span>

    <span class="s0">return </span><span class="s1">yieldval</span>


<span class="s0">def </span><span class="s1">check_variable_assignment</span><span class="s2">(</span>
    <span class="s1">value</span><span class="s2">: </span><span class="s1">object</span><span class="s2">, </span><span class="s1">varname</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">annotation</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">: </span><span class="s1">TypeCheckMemo</span>
<span class="s2">) </span><span class="s1">-&gt; Any</span><span class="s2">:</span>
    <span class="s0">if </span><span class="s1">_suppression</span><span class="s2">.</span><span class="s1">type_checks_suppressed</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">value</span>

    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">check_type_internal</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">annotation</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
    <span class="s0">except </span><span class="s1">TypeCheckError </span><span class="s0">as </span><span class="s1">exc</span><span class="s2">:</span>
        <span class="s1">qualname </span><span class="s2">= </span><span class="s1">qualified_name</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">add_class_prefix</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">exc</span><span class="s2">.</span><span class="s1">append_path_element</span><span class="s2">(</span><span class="s4">f&quot;value assigned to </span><span class="s0">{</span><span class="s1">varname</span><span class="s0">} </span><span class="s4">(</span><span class="s0">{</span><span class="s1">qualname</span><span class="s0">}</span><span class="s4">)&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
            <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise</span>

    <span class="s0">return </span><span class="s1">value</span>


<span class="s0">def </span><span class="s1">check_multi_variable_assignment</span><span class="s2">(</span>
    <span class="s1">value</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">, </span><span class="s1">targets</span><span class="s2">: </span><span class="s1">list</span><span class="s2">[</span><span class="s1">dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]], </span><span class="s1">memo</span><span class="s2">: </span><span class="s1">TypeCheckMemo</span>
<span class="s2">) </span><span class="s1">-&gt; Any</span><span class="s2">:</span>
    <span class="s0">if </span><span class="s1">max</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">target</span><span class="s2">) </span><span class="s0">for </span><span class="s1">target </span><span class="s0">in </span><span class="s1">targets</span><span class="s2">) == </span><span class="s3">1</span><span class="s2">:</span>
        <span class="s1">iterated_values </span><span class="s2">= [</span><span class="s1">value</span><span class="s2">]</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">iterated_values </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">if not </span><span class="s1">_suppression</span><span class="s2">.</span><span class="s1">type_checks_suppressed</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">expected_types </span><span class="s0">in </span><span class="s1">targets</span><span class="s2">:</span>
            <span class="s1">value_index </span><span class="s2">= </span><span class="s3">0</span>
            <span class="s0">for </span><span class="s1">ann_index</span><span class="s2">, (</span><span class="s1">varname</span><span class="s2">, </span><span class="s1">expected_type</span><span class="s2">) </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span>
                <span class="s1">expected_types</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()</span>
            <span class="s2">):</span>
                <span class="s0">if </span><span class="s1">varname</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s4">&quot;*&quot;</span><span class="s2">):</span>
                    <span class="s1">varname </span><span class="s2">= </span><span class="s1">varname</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:]</span>
                    <span class="s1">keys_left </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">expected_types</span><span class="s2">) - </span><span class="s3">1 </span><span class="s2">- </span><span class="s1">ann_index</span>
                    <span class="s1">next_value_index </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">iterated_values</span><span class="s2">) - </span><span class="s1">keys_left</span>
                    <span class="s1">obj</span><span class="s2">: </span><span class="s1">object </span><span class="s2">= </span><span class="s1">iterated_values</span><span class="s2">[</span><span class="s1">value_index</span><span class="s2">:</span><span class="s1">next_value_index</span><span class="s2">]</span>
                    <span class="s1">value_index </span><span class="s2">= </span><span class="s1">next_value_index</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">obj </span><span class="s2">= </span><span class="s1">iterated_values</span><span class="s2">[</span><span class="s1">value_index</span><span class="s2">]</span>
                    <span class="s1">value_index </span><span class="s2">+= </span><span class="s3">1</span>

                <span class="s0">try</span><span class="s2">:</span>
                    <span class="s1">check_type_internal</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">expected_type</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
                <span class="s0">except </span><span class="s1">TypeCheckError </span><span class="s0">as </span><span class="s1">exc</span><span class="s2">:</span>
                    <span class="s1">qualname </span><span class="s2">= </span><span class="s1">qualified_name</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">add_class_prefix</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
                    <span class="s1">exc</span><span class="s2">.</span><span class="s1">append_path_element</span><span class="s2">(</span><span class="s4">f&quot;value assigned to </span><span class="s0">{</span><span class="s1">varname</span><span class="s0">} </span><span class="s4">(</span><span class="s0">{</span><span class="s1">qualname</span><span class="s0">}</span><span class="s4">)&quot;</span><span class="s2">)</span>
                    <span class="s0">if </span><span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">:</span>
                        <span class="s1">memo</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">typecheck_fail_callback</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">)</span>
                    <span class="s0">else</span><span class="s2">:</span>
                        <span class="s0">raise</span>

    <span class="s0">return </span><span class="s1">iterated_values</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] </span><span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">iterated_values</span><span class="s2">) == </span><span class="s3">1 </span><span class="s0">else </span><span class="s1">iterated_values</span>


<span class="s0">def </span><span class="s1">warn_on_error</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">: </span><span class="s1">TypeCheckError</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">: </span><span class="s1">TypeCheckMemo</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s5">&quot;&quot;&quot; 
    Emit a warning on a type mismatch. 
 
    This is intended to be used as an error handler in 
    :attr:`TypeCheckConfiguration.typecheck_fail_callback`. 
 
    &quot;&quot;&quot;</span>
    <span class="s1">warnings</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s1">TypeCheckWarning</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc</span><span class="s2">)), </span><span class="s1">stacklevel</span><span class="s2">=</span><span class="s1">get_stacklevel</span><span class="s2">())</span>
</pre>
</body>
</html>