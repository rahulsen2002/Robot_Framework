<html>
<head>
<title>_suppression.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_suppression.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">annotations</span>

<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">from </span><span class="s1">collections</span><span class="s2">.</span><span class="s1">abc </span><span class="s0">import </span><span class="s1">Callable</span><span class="s2">, </span><span class="s1">Generator</span>
<span class="s0">from </span><span class="s1">contextlib </span><span class="s0">import </span><span class="s1">contextmanager</span>
<span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">update_wrapper</span>
<span class="s0">from </span><span class="s1">threading </span><span class="s0">import </span><span class="s1">Lock</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">ContextManager</span><span class="s2">, </span><span class="s1">TypeVar</span><span class="s2">, </span><span class="s1">overload</span>

<span class="s0">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&gt;= (</span><span class="s3">3</span><span class="s2">, </span><span class="s3">10</span><span class="s2">):</span>
    <span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">ParamSpec</span>
<span class="s0">else</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">typing_extensions </span><span class="s0">import </span><span class="s1">ParamSpec</span>

<span class="s1">P </span><span class="s2">= </span><span class="s1">ParamSpec</span><span class="s2">(</span><span class="s4">&quot;P&quot;</span><span class="s2">)</span>
<span class="s1">T </span><span class="s2">= </span><span class="s1">TypeVar</span><span class="s2">(</span><span class="s4">&quot;T&quot;</span><span class="s2">)</span>

<span class="s1">type_checks_suppressed </span><span class="s2">= </span><span class="s3">0</span>
<span class="s1">type_checks_suppress_lock </span><span class="s2">= </span><span class="s1">Lock</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">overload</span>
<span class="s0">def </span><span class="s1">suppress_type_checks</span><span class="s2">(</span><span class="s1">func</span><span class="s2">: </span><span class="s1">Callable</span><span class="s2">[</span><span class="s1">P</span><span class="s2">, </span><span class="s1">T</span><span class="s2">]) </span><span class="s1">-&gt; Callable</span><span class="s2">[</span><span class="s1">P</span><span class="s2">, </span><span class="s1">T</span><span class="s2">]: ...</span>


<span class="s2">@</span><span class="s1">overload</span>
<span class="s0">def </span><span class="s1">suppress_type_checks</span><span class="s2">() </span><span class="s1">-&gt; ContextManager</span><span class="s2">[</span><span class="s0">None</span><span class="s2">]: ...</span>


<span class="s0">def </span><span class="s1">suppress_type_checks</span><span class="s2">(</span>
    <span class="s1">func</span><span class="s2">: </span><span class="s1">Callable</span><span class="s2">[</span><span class="s1">P</span><span class="s2">, </span><span class="s1">T</span><span class="s2">] | </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span><span class="s2">,</span>
<span class="s2">) </span><span class="s1">-&gt; Callable</span><span class="s2">[</span><span class="s1">P</span><span class="s2">, </span><span class="s1">T</span><span class="s2">] | </span><span class="s1">ContextManager</span><span class="s2">[</span><span class="s0">None</span><span class="s2">]:</span>
    <span class="s5">&quot;&quot;&quot; 
    Temporarily suppress all type checking. 
 
    This function has two operating modes, based on how it's used: 
 
    #. as a context manager (``with suppress_type_checks(): ...``) 
    #. as a decorator (``@suppress_type_checks``) 
 
    When used as a context manager, :func:`check_type` and any automatically 
    instrumented functions skip the actual type checking. These context managers can be 
    nested. 
 
    When used as a decorator, all type checking is suppressed while the function is 
    running. 
 
    Type checking will resume once no more context managers are active and no decorated 
    functions are running. 
 
    Both operating modes are thread-safe. 
 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">wrapper</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">: </span><span class="s1">P</span><span class="s2">.</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">: </span><span class="s1">P</span><span class="s2">.</span><span class="s1">kwargs</span><span class="s2">) </span><span class="s1">-&gt; T</span><span class="s2">:</span>
        <span class="s0">global </span><span class="s1">type_checks_suppressed</span>

        <span class="s0">with </span><span class="s1">type_checks_suppress_lock</span><span class="s2">:</span>
            <span class="s1">type_checks_suppressed </span><span class="s2">+= </span><span class="s3">1</span>

        <span class="s0">assert </span><span class="s1">func </span><span class="s0">is not None</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">func</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s0">finally</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">type_checks_suppress_lock</span><span class="s2">:</span>
                <span class="s1">type_checks_suppressed </span><span class="s2">-= </span><span class="s3">1</span>

    <span class="s0">def </span><span class="s1">cm</span><span class="s2">() </span><span class="s1">-&gt; Generator</span><span class="s2">[</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">]:</span>
        <span class="s0">global </span><span class="s1">type_checks_suppressed</span>

        <span class="s0">with </span><span class="s1">type_checks_suppress_lock</span><span class="s2">:</span>
            <span class="s1">type_checks_suppressed </span><span class="s2">+= </span><span class="s3">1</span>

        <span class="s0">try</span><span class="s2">:</span>
            <span class="s0">yield</span>
        <span class="s0">finally</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">type_checks_suppress_lock</span><span class="s2">:</span>
                <span class="s1">type_checks_suppressed </span><span class="s2">-= </span><span class="s3">1</span>

    <span class="s0">if </span><span class="s1">func </span><span class="s0">is None</span><span class="s2">:</span>
        <span class="s6"># Context manager mode</span>
        <span class="s0">return </span><span class="s1">contextmanager</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">)()</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s6"># Decorator mode</span>
        <span class="s1">update_wrapper</span><span class="s2">(</span><span class="s1">wrapper</span><span class="s2">, </span><span class="s1">func</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">wrapper</span>
</pre>
</body>
</html>