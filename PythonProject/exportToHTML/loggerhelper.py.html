<html>
<head>
<title>loggerhelper.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
loggerhelper.py</font>
</center></td></tr></table>
<pre><span class="s0">#  Copyright 2008-2015 Nokia Networks</span>
<span class="s0">#  Copyright 2016-     Robot Framework Foundation</span>
<span class="s0">#</span>
<span class="s0">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0">#  you may not use this file except in compliance with the License.</span>
<span class="s0">#  You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="s0">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0">#  See the License for the specific language governing permissions and</span>
<span class="s0">#  limitations under the License.</span>

<span class="s2">import </span><span class="s1">sys</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">datetime</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Callable</span><span class="s3">, </span><span class="s1">Literal</span>

<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">errors </span><span class="s2">import </span><span class="s1">DataError</span>
<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">model </span><span class="s2">import </span><span class="s1">MessageLevel</span>
<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">result </span><span class="s2">import </span><span class="s1">Message </span><span class="s2">as </span><span class="s1">BaseMessage</span>
<span class="s2">from </span><span class="s1">robot</span><span class="s3">.</span><span class="s1">utils </span><span class="s2">import </span><span class="s1">console_encode</span>

<span class="s2">from </span><span class="s3">.</span><span class="s1">loglevel </span><span class="s2">import </span><span class="s1">LEVELS</span>

<span class="s1">PseudoLevel </span><span class="s3">= </span><span class="s1">Literal</span><span class="s3">[</span><span class="s4">&quot;HTML&quot;</span><span class="s3">, </span><span class="s4">&quot;CONSOLE&quot;</span><span class="s3">]</span>


<span class="s2">def </span><span class="s1">write_to_console</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s1">newline</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">stream</span><span class="s3">=</span><span class="s4">&quot;stdout&quot;</span><span class="s3">):</span>
    <span class="s1">msg </span><span class="s3">= </span><span class="s1">str</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">newline</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">+= </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">stream </span><span class="s3">= </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">__stdout__ </span><span class="s2">if </span><span class="s1">stream</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">() != </span><span class="s4">&quot;stderr&quot; </span><span class="s2">else </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">__stderr__</span>
    <span class="s2">if </span><span class="s1">stream</span><span class="s3">:</span>
        <span class="s1">stream</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">console_encode</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s1">stream</span><span class="s3">=</span><span class="s1">stream</span><span class="s3">))</span>
        <span class="s1">stream</span><span class="s3">.</span><span class="s1">flush</span><span class="s3">()</span>


<span class="s2">class </span><span class="s1">AbstractLogger</span><span class="s3">:</span>

    <span class="s2">def </span><span class="s1">trace</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s4">&quot;TRACE&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">debug</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s4">&quot;DEBUG&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">info</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s4">&quot;INFO&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">warn</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s4">&quot;WARN&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">fail</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">html </span><span class="s3">= </span><span class="s2">False</span>
        <span class="s2">if </span><span class="s1">msg</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;*HTML*&quot;</span><span class="s3">):</span>
            <span class="s1">html </span><span class="s3">= </span><span class="s2">True</span>
            <span class="s1">msg </span><span class="s3">= </span><span class="s1">msg</span><span class="s3">[</span><span class="s5">6</span><span class="s3">:].</span><span class="s1">lstrip</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s4">&quot;FAIL&quot;</span><span class="s3">, </span><span class="s1">html</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">skip</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">html </span><span class="s3">= </span><span class="s2">False</span>
        <span class="s2">if </span><span class="s1">msg</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;*HTML*&quot;</span><span class="s3">):</span>
            <span class="s1">html </span><span class="s3">= </span><span class="s2">True</span>
            <span class="s1">msg </span><span class="s3">= </span><span class="s1">msg</span><span class="s3">[</span><span class="s5">6</span><span class="s3">:].</span><span class="s1">lstrip</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s4">&quot;SKIP&quot;</span><span class="s3">, </span><span class="s1">html</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">error</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s4">&quot;ERROR&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">write</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">message</span><span class="s3">, </span><span class="s1">level</span><span class="s3">, </span><span class="s1">html</span><span class="s3">=</span><span class="s2">False</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">message</span><span class="s3">(</span><span class="s1">Message</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">level</span><span class="s3">, </span><span class="s1">html</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">message</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s2">raise </span><span class="s1">NotImplementedError</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">__class__</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">Message</span><span class="s3">(</span><span class="s1">BaseMessage</span><span class="s3">):</span>
    <span class="s6">&quot;&quot;&quot;Represents message logged during execution. 
 
    Most messages are logged by libraries. They typically log strings, but 
    possible non-string items have been converted to strings already before 
    they end up here. 
 
    In addition to strings, Robot Framework itself logs also callables to make 
    constructing messages that are not typically needed lazy. Such messages are 
    resolved when they are accessed. 
 
    Listeners can remove messages by setting the `message` attribute to `None`. 
    These messages are not written to the output.xml at all. 
    &quot;&quot;&quot;</span>

    <span class="s1">__slots__ </span><span class="s3">= (</span><span class="s4">&quot;_message&quot;</span><span class="s3">,)</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">message</span><span class="s3">: </span><span class="s4">&quot;str|None|Callable[[], str|None]&quot; </span><span class="s3">= </span><span class="s4">&quot;&quot;</span><span class="s3">,</span>
        <span class="s1">level</span><span class="s3">: </span><span class="s4">&quot;MessageLevel|PseudoLevel&quot; </span><span class="s3">= </span><span class="s4">&quot;INFO&quot;</span><span class="s3">,</span>
        <span class="s1">html</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">timestamp</span><span class="s3">: </span><span class="s4">&quot;datetime|str|None&quot; </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s1">level</span><span class="s3">, </span><span class="s1">html </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_level_and_html</span><span class="s3">(</span><span class="s1">level</span><span class="s3">, </span><span class="s1">html</span><span class="s3">)</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">level</span><span class="s3">, </span><span class="s1">html</span><span class="s3">, </span><span class="s1">timestamp </span><span class="s2">or </span><span class="s1">datetime</span><span class="s3">.</span><span class="s1">now</span><span class="s3">())</span>

    <span class="s2">def </span><span class="s1">_get_level_and_html</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">level</span><span class="s3">, </span><span class="s1">html</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;tuple[MessageLevel, bool]&quot;</span><span class="s3">:</span>
        <span class="s1">level </span><span class="s3">= </span><span class="s1">level</span><span class="s3">.</span><span class="s1">upper</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s1">level </span><span class="s3">== </span><span class="s4">&quot;HTML&quot;</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s4">&quot;INFO&quot;</span><span class="s3">, </span><span class="s2">True</span>
        <span class="s2">if </span><span class="s1">level </span><span class="s3">== </span><span class="s4">&quot;CONSOLE&quot;</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s4">&quot;INFO&quot;</span><span class="s3">, </span><span class="s1">html</span>
        <span class="s2">if </span><span class="s1">level </span><span class="s2">in </span><span class="s1">LEVELS</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">level</span><span class="s3">, </span><span class="s1">html</span>
        <span class="s2">raise </span><span class="s1">DataError</span><span class="s3">(</span><span class="s4">f&quot;Invalid log level '</span><span class="s2">{</span><span class="s1">level</span><span class="s2">}</span><span class="s4">'.&quot;</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">message</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;str|None&quot;</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">resolve_delayed_message</span><span class="s3">()</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_message</span>

    <span class="s3">@</span><span class="s1">message</span><span class="s3">.</span><span class="s1">setter</span>
    <span class="s2">def </span><span class="s1">message</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">message</span><span class="s3">: </span><span class="s4">&quot;str|None|Callable[[], str|None]&quot;</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">message</span><span class="s3">, </span><span class="s1">str</span><span class="s3">) </span><span class="s2">and </span><span class="s4">&quot;</span><span class="s2">\r\n</span><span class="s4">&quot; </span><span class="s2">in </span><span class="s1">message</span><span class="s3">:</span>
            <span class="s1">message </span><span class="s3">= </span><span class="s1">message</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\r\n</span><span class="s4">&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_message </span><span class="s3">= </span><span class="s1">message</span>

    <span class="s2">def </span><span class="s1">resolve_delayed_message</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">callable</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_message</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">message </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_message</span><span class="s3">()</span>
</pre>
</body>
</html>