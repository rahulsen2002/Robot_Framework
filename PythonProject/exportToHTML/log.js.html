<html>
<head>
<title>log.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
log.js</font>
</center></td></tr></table>
<pre><span class="s0">var </span><span class="s1">LEVELS </span><span class="s2">= {</span><span class="s1">TRACE</span><span class="s2">: </span><span class="s3">0</span><span class="s2">, </span><span class="s1">DEBUG</span><span class="s2">: </span><span class="s3">1</span><span class="s2">, </span><span class="s1">INFO</span><span class="s2">: </span><span class="s3">2</span><span class="s2">, </span><span class="s1">WARN</span><span class="s2">: </span><span class="s3">3</span><span class="s2">, </span><span class="s1">FAIL</span><span class="s2">: </span><span class="s3">4</span><span class="s2">, </span><span class="s1">NONE</span><span class="s2">: </span><span class="s3">5</span><span class="s2">};</span>

<span class="s0">function </span><span class="s1">toggleSuite</span><span class="s2">(</span><span class="s1">suiteId</span><span class="s2">) {</span>
    <span class="s1">toggleElement</span><span class="s2">(</span><span class="s1">suiteId</span><span class="s2">, [</span><span class="s4">'keyword'</span><span class="s2">, </span><span class="s4">'suite'</span><span class="s2">, </span><span class="s4">'test'</span><span class="s2">]);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">toggleTest</span><span class="s2">(</span><span class="s1">testId</span><span class="s2">) {</span>
    <span class="s0">var </span><span class="s1">test </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">testdata</span><span class="s2">.</span><span class="s1">findLoaded</span><span class="s2">(</span><span class="s1">testId</span><span class="s2">);</span>
    <span class="s0">var </span><span class="s1">autoExpand </span><span class="s2">= </span><span class="s1">test</span><span class="s2">.</span><span class="s1">status </span><span class="s2">== </span><span class="s4">&quot;FAIL&quot; </span><span class="s2">|| </span><span class="s1">test</span><span class="s2">.</span><span class="s1">status </span><span class="s2">== </span><span class="s4">&quot;SKIP&quot;</span><span class="s2">;</span>
    <span class="s0">var </span><span class="s1">closed </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'#' </span><span class="s2">+ </span><span class="s1">testId</span><span class="s2">).</span><span class="s1">children</span><span class="s2">(</span><span class="s4">'.element-header'</span><span class="s2">).</span><span class="s1">hasClass</span><span class="s2">(</span><span class="s4">'closed'</span><span class="s2">);</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">autoExpand </span><span class="s2">&amp;&amp; </span><span class="s1">closed</span><span class="s2">)</span>
        <span class="s1">expandFailed</span><span class="s2">(</span><span class="s1">test</span><span class="s2">);</span>
    <span class="s0">else</span>
        <span class="s1">toggleElement</span><span class="s2">(</span><span class="s1">testId</span><span class="s2">, [</span><span class="s4">'keyword'</span><span class="s2">]);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">toggleKeyword</span><span class="s2">(</span><span class="s1">kwId</span><span class="s2">) {</span>
    <span class="s1">toggleElement</span><span class="s2">(</span><span class="s1">kwId</span><span class="s2">, [</span><span class="s4">'keyword'</span><span class="s2">]);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">toggleElement</span><span class="s2">(</span><span class="s1">elementId</span><span class="s2">, </span><span class="s1">childrenNames</span><span class="s2">) {</span>
    <span class="s0">var </span><span class="s1">element </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'#' </span><span class="s2">+ </span><span class="s1">elementId</span><span class="s2">);</span>
    <span class="s0">var </span><span class="s1">children </span><span class="s2">= </span><span class="s1">element</span><span class="s2">.</span><span class="s1">children</span><span class="s2">(</span><span class="s4">'.children'</span><span class="s2">);</span>
    <span class="s1">children</span><span class="s2">.</span><span class="s1">toggle</span><span class="s2">(</span><span class="s3">100</span><span class="s2">, </span><span class="s4">''</span><span class="s2">, </span><span class="s0">function </span><span class="s2">() {</span>
        <span class="s1">element</span><span class="s2">.</span><span class="s1">children</span><span class="s2">(</span><span class="s4">'.element-header'</span><span class="s2">).</span><span class="s1">toggleClass</span><span class="s2">(</span><span class="s4">'closed'</span><span class="s2">);</span>
    <span class="s2">});</span>
    <span class="s1">populateChildren</span><span class="s2">(</span><span class="s1">elementId</span><span class="s2">, </span><span class="s1">children</span><span class="s2">, </span><span class="s1">childrenNames</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">populateChildren</span><span class="s2">(</span><span class="s1">elementId</span><span class="s2">, </span><span class="s1">childElement</span><span class="s2">, </span><span class="s1">childrenNames</span><span class="s2">) {</span>
    <span class="s0">if </span><span class="s2">(!</span><span class="s1">childElement</span><span class="s2">.</span><span class="s1">hasClass</span><span class="s2">(</span><span class="s4">'populated'</span><span class="s2">)) {</span>
        <span class="s0">var </span><span class="s1">element </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">testdata</span><span class="s2">.</span><span class="s1">findLoaded</span><span class="s2">(</span><span class="s1">elementId</span><span class="s2">);</span>
        <span class="s0">var </span><span class="s1">callback </span><span class="s2">= </span><span class="s1">drawCallback</span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">childElement</span><span class="s2">, </span><span class="s1">childrenNames</span><span class="s2">);</span>
        <span class="s1">element</span><span class="s2">.</span><span class="s1">callWhenChildrenReady</span><span class="s2">(</span><span class="s1">callback</span><span class="s2">);</span>
        <span class="s1">childElement</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'populated'</span><span class="s2">);</span>
    <span class="s2">}</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">drawCallback</span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">childElement</span><span class="s2">, </span><span class="s1">childrenNames</span><span class="s2">) {</span>
    <span class="s0">return function </span><span class="s2">() {</span>
        <span class="s1">util</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">childrenNames</span><span class="s2">, </span><span class="s0">function </span><span class="s2">(</span><span class="s1">childName</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">children </span><span class="s2">= </span><span class="s1">element</span><span class="s2">[</span><span class="s1">childName </span><span class="s2">+ </span><span class="s4">'s'</span><span class="s2">]();</span>
            <span class="s1">util</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">children</span><span class="s2">, </span><span class="s0">function </span><span class="s2">(</span><span class="s1">child</span><span class="s2">) {</span>
                <span class="s1">$</span><span class="s2">.</span><span class="s1">tmpl</span><span class="s2">(</span><span class="s1">child</span><span class="s2">.</span><span class="s1">template</span><span class="s2">, </span><span class="s1">child</span><span class="s2">).</span><span class="s1">appendTo</span><span class="s2">(</span><span class="s1">childElement</span><span class="s2">);</span>
            <span class="s2">});</span>
        <span class="s2">});</span>
    <span class="s2">}</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">expandSuite</span><span class="s2">(</span><span class="s1">suite</span><span class="s2">) {</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">suite</span><span class="s2">.</span><span class="s1">status </span><span class="s2">== </span><span class="s4">&quot;FAIL&quot;</span><span class="s2">)</span>
        <span class="s1">expandFailed</span><span class="s2">(</span><span class="s1">suite</span><span class="s2">);</span>
    <span class="s0">else</span>
        <span class="s1">expandElement</span><span class="s2">(</span><span class="s1">suite</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">expandElement</span><span class="s2">(</span><span class="s1">item</span><span class="s2">, </span><span class="s1">retryCount</span><span class="s2">) {</span>
    <span class="s1">retryCount </span><span class="s2">= </span><span class="s0">typeof </span><span class="s1">retryCount </span><span class="s2">!== </span><span class="s4">'undefined' </span><span class="s2">? </span><span class="s1">retryCount </span><span class="s2">: </span><span class="s3">3</span><span class="s2">;</span>
    <span class="s0">var </span><span class="s1">element </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'#' </span><span class="s2">+ </span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">);</span>
    <span class="s0">var </span><span class="s1">children </span><span class="s2">= </span><span class="s1">element</span><span class="s2">.</span><span class="s1">children</span><span class="s2">(</span><span class="s4">'.children'</span><span class="s2">);</span>
    <span class="s5">// .css is faster than .show and .show w/ callback is terribly slow</span>
    <span class="s1">children</span><span class="s2">.</span><span class="s1">css</span><span class="s2">({</span><span class="s4">'display'</span><span class="s2">: </span><span class="s4">'block'</span><span class="s2">});</span>
    <span class="s5">// in rare cases on large logs concurrent expanding fails =&gt; retry</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">children</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s4">'display'</span><span class="s2">) != </span><span class="s4">'block' </span><span class="s2">&amp;&amp; </span><span class="s1">retryCount </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">debug</span><span class="s2">(</span><span class="s4">'expandElement '</span><span class="s2">+</span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">+</span><span class="s4">' failed! planning retry...'</span><span class="s2">);</span>
        <span class="s1">setTimeout</span><span class="s2">(</span><span class="s0">function</span><span class="s2">() { </span><span class="s1">expandElement</span><span class="s2">(</span><span class="s1">item</span><span class="s2">, </span><span class="s1">retryCount</span><span class="s2">-</span><span class="s3">1</span><span class="s2">); }, </span><span class="s3">0</span><span class="s2">);</span>
        <span class="s0">return</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s1">populateChildren</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">, </span><span class="s1">children</span><span class="s2">, </span><span class="s1">item</span><span class="s2">.</span><span class="s1">childrenNames</span><span class="s2">);</span>
    <span class="s1">element</span><span class="s2">.</span><span class="s1">children</span><span class="s2">(</span><span class="s4">'.element-header'</span><span class="s2">).</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'closed'</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">expandElementWithId</span><span class="s2">(</span><span class="s1">elementid</span><span class="s2">) {</span>
    <span class="s1">expandElement</span><span class="s2">(</span><span class="s1">window</span><span class="s2">.</span><span class="s1">testdata</span><span class="s2">.</span><span class="s1">findLoaded</span><span class="s2">(</span><span class="s1">elementid</span><span class="s2">));</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">expandElementsWithIds</span><span class="s2">(</span><span class="s1">ids</span><span class="s2">) {</span>
    <span class="s1">util</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">ids</span><span class="s2">, </span><span class="s1">expandElementWithId</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">loadAndExpandElementIds</span><span class="s2">(</span><span class="s1">ids</span><span class="s2">) {</span>
    <span class="s0">for </span><span class="s2">(</span><span class="s0">var </span><span class="s1">i </span><span class="s0">in </span><span class="s1">ids</span><span class="s2">) {</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">testdata</span><span class="s2">.</span><span class="s1">ensureLoaded</span><span class="s2">(</span><span class="s1">ids</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">expandElementsWithIds</span><span class="s2">);</span>
    <span class="s2">}</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">expandFailed</span><span class="s2">(</span><span class="s1">element</span><span class="s2">) {</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">element</span><span class="s2">.</span><span class="s1">status </span><span class="s2">== </span><span class="s4">&quot;FAIL&quot; </span><span class="s2">|| (</span><span class="s1">element</span><span class="s2">.</span><span class="s1">type </span><span class="s2">== </span><span class="s4">&quot;test&quot; </span><span class="s2">&amp;&amp; </span><span class="s1">element</span><span class="s2">.</span><span class="s1">status </span><span class="s2">== </span><span class="s4">&quot;SKIP&quot;</span><span class="s2">)) {</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">elementsToExpand </span><span class="s2">= [</span><span class="s1">element</span><span class="s2">];</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">expandDecider </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s0">return </span><span class="s1">e</span><span class="s2">.</span><span class="s1">status </span><span class="s2">== </span><span class="s4">&quot;FAIL&quot;</span><span class="s2">;</span>
        <span class="s2">};</span>
        <span class="s1">expandRecursively</span><span class="s2">();</span>
    <span class="s2">}</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">expandAll</span><span class="s2">(</span><span class="s1">elementId</span><span class="s2">) {</span>
    <span class="s1">window</span><span class="s2">.</span><span class="s1">elementsToExpand </span><span class="s2">= [</span><span class="s1">window</span><span class="s2">.</span><span class="s1">testdata</span><span class="s2">.</span><span class="s1">findLoaded</span><span class="s2">(</span><span class="s1">elementId</span><span class="s2">)];</span>
    <span class="s1">window</span><span class="s2">.</span><span class="s1">expandDecider </span><span class="s2">= </span><span class="s0">function </span><span class="s2">() { </span><span class="s0">return true</span><span class="s2">; };</span>
    <span class="s1">expandRecursively</span><span class="s2">();</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">expandRecursively</span><span class="s2">() {</span>
    <span class="s0">if </span><span class="s2">(!</span><span class="s1">window</span><span class="s2">.</span><span class="s1">elementsToExpand</span><span class="s2">.</span><span class="s1">length</span><span class="s2">)</span>
        <span class="s0">return</span><span class="s2">;</span>
    <span class="s0">var </span><span class="s1">element </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">elementsToExpand</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
    <span class="s0">if </span><span class="s2">(!</span><span class="s1">element </span><span class="s2">|| </span><span class="s1">elementHiddenByUser</span><span class="s2">(</span><span class="s1">element</span><span class="s2">.</span><span class="s1">id</span><span class="s2">)) {</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">elementsToExpand </span><span class="s2">= [];</span>
        <span class="s0">return</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s1">expandElement</span><span class="s2">(</span><span class="s1">element</span><span class="s2">);</span>
    <span class="s1">element</span><span class="s2">.</span><span class="s1">callWhenChildrenReady</span><span class="s2">(</span><span class="s0">function </span><span class="s2">() {</span>
        <span class="s0">var </span><span class="s1">children </span><span class="s2">= </span><span class="s1">element</span><span class="s2">.</span><span class="s1">children</span><span class="s2">();</span>
        <span class="s0">for </span><span class="s2">(</span><span class="s0">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">children</span><span class="s2">.</span><span class="s1">length</span><span class="s2">-</span><span class="s3">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i</span><span class="s2">--) {</span>
            <span class="s0">var </span><span class="s1">child </span><span class="s2">= </span><span class="s1">children</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">child</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!= </span><span class="s4">'message' </span><span class="s2">&amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">expandDecider</span><span class="s2">(</span><span class="s1">child</span><span class="s2">))</span>
                <span class="s1">window</span><span class="s2">.</span><span class="s1">elementsToExpand</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">child</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">window</span><span class="s2">.</span><span class="s1">elementsToExpand</span><span class="s2">.</span><span class="s1">length</span><span class="s2">)</span>
            <span class="s1">setTimeout</span><span class="s2">(</span><span class="s1">expandRecursively</span><span class="s2">, </span><span class="s3">0</span><span class="s2">);</span>
    <span class="s2">});</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">elementHiddenByUser</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
    <span class="s0">var </span><span class="s1">element </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'#' </span><span class="s2">+ </span><span class="s1">id</span><span class="s2">);</span>
    <span class="s0">return </span><span class="s2">!</span><span class="s1">element</span><span class="s2">.</span><span class="s1">is</span><span class="s2">(</span><span class="s4">&quot;:visible&quot;</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">collapseAll</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
    <span class="s0">var </span><span class="s1">element </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'#' </span><span class="s2">+ </span><span class="s1">id</span><span class="s2">);</span>
    <span class="s1">element</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.children'</span><span class="s2">).</span><span class="s1">css</span><span class="s2">({</span><span class="s4">'display'</span><span class="s2">: </span><span class="s4">'none'</span><span class="s2">});</span>
    <span class="s1">element</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.element-header'</span><span class="s2">).</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'closed'</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">logLevelSelected</span><span class="s2">(</span><span class="s1">level</span><span class="s2">) {</span>
    <span class="s0">var </span><span class="s1">anchors </span><span class="s2">= </span><span class="s1">getViewAnchorElements</span><span class="s2">();</span>
    <span class="s1">setMessageVisibility</span><span class="s2">(</span><span class="s1">level</span><span class="s2">);</span>
    <span class="s1">scrollToShortestVisibleAnchorElement</span><span class="s2">(</span><span class="s1">anchors</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">getViewAnchorElements</span><span class="s2">() {</span>
    <span class="s0">var </span><span class="s1">elem1 </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">document</span><span class="s2">.</span><span class="s1">elementFromPoint</span><span class="s2">(</span><span class="s3">100</span><span class="s2">, </span><span class="s3">0</span><span class="s2">));</span>
    <span class="s0">var </span><span class="s1">elem2 </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">document</span><span class="s2">.</span><span class="s1">elementFromPoint</span><span class="s2">(</span><span class="s3">100</span><span class="s2">, </span><span class="s3">20</span><span class="s2">));</span>
    <span class="s0">return </span><span class="s2">[</span><span class="s1">elem1</span><span class="s2">, </span><span class="s1">elem2</span><span class="s2">];</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">scrollToShortestVisibleAnchorElement</span><span class="s2">(</span><span class="s1">anchors</span><span class="s2">) {</span>
    <span class="s1">anchors </span><span class="s2">= </span><span class="s1">util</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">anchors</span><span class="s2">, </span><span class="s1">closestVisibleParent</span><span class="s2">);</span>
    <span class="s0">var </span><span class="s1">shortest </span><span class="s2">= </span><span class="s1">anchors</span><span class="s2">[</span><span class="s3">0</span><span class="s2">];</span>
    <span class="s0">for </span><span class="s2">(</span><span class="s0">var </span><span class="s1">i </span><span class="s2">= </span><span class="s3">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">anchors</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++)</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">shortest</span><span class="s2">.</span><span class="s1">height</span><span class="s2">() &gt; </span><span class="s1">anchors</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">height</span><span class="s2">())</span>
            <span class="s1">shortest </span><span class="s2">= </span><span class="s1">anchors</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
    <span class="s1">shortest</span><span class="s2">.</span><span class="s1">get</span><span class="s2">()[</span><span class="s3">0</span><span class="s2">].</span><span class="s1">scrollIntoView</span><span class="s2">(</span><span class="s0">true</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">setMessageVisibility</span><span class="s2">(</span><span class="s1">level</span><span class="s2">) {</span>
    <span class="s1">level </span><span class="s2">= </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">level</span><span class="s2">);</span>
    <span class="s1">changeClassDisplay</span><span class="s2">(</span><span class="s4">&quot;.trace-message&quot;</span><span class="s2">, </span><span class="s1">level </span><span class="s2">&lt;= </span><span class="s1">LEVELS</span><span class="s2">.</span><span class="s1">TRACE</span><span class="s2">);</span>
    <span class="s1">changeClassDisplay</span><span class="s2">(</span><span class="s4">&quot;.debug-message&quot;</span><span class="s2">, </span><span class="s1">level </span><span class="s2">&lt;= </span><span class="s1">LEVELS</span><span class="s2">.</span><span class="s1">DEBUG</span><span class="s2">);</span>
    <span class="s1">changeClassDisplay</span><span class="s2">(</span><span class="s4">&quot;.info-message&quot;</span><span class="s2">, </span><span class="s1">level </span><span class="s2">&lt;= </span><span class="s1">LEVELS</span><span class="s2">.</span><span class="s1">INFO</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">closestVisibleParent</span><span class="s2">(</span><span class="s1">elem</span><span class="s2">) {</span>
    <span class="s0">while </span><span class="s2">(!</span><span class="s1">elem</span><span class="s2">.</span><span class="s1">is</span><span class="s2">(</span><span class="s4">&quot;:visible&quot;</span><span class="s2">))</span>
        <span class="s1">elem </span><span class="s2">= </span><span class="s1">elem</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">();</span>
    <span class="s0">return </span><span class="s1">elem</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">changeClassDisplay</span><span class="s2">(</span><span class="s1">clazz</span><span class="s2">, </span><span class="s1">visible</span><span class="s2">) {</span>
    <span class="s0">var </span><span class="s1">styles </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">styleSheets</span><span class="s2">;</span>
    <span class="s0">for </span><span class="s2">(</span><span class="s0">var </span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">styles</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
        <span class="s0">var </span><span class="s1">rules </span><span class="s2">= </span><span class="s1">getRules</span><span class="s2">(</span><span class="s1">styles</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">rules </span><span class="s2">=== </span><span class="s0">null</span><span class="s2">)</span>
            <span class="s0">continue</span><span class="s2">;</span>
        <span class="s0">for </span><span class="s2">(</span><span class="s0">var </span><span class="s1">j </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">j </span><span class="s2">&lt; </span><span class="s1">rules</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">j</span><span class="s2">++)</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">rules</span><span class="s2">[</span><span class="s1">j</span><span class="s2">].</span><span class="s1">selectorText </span><span class="s2">=== </span><span class="s1">clazz</span><span class="s2">)</span>
                <span class="s1">rules</span><span class="s2">[</span><span class="s1">j</span><span class="s2">].</span><span class="s1">style</span><span class="s2">.</span><span class="s1">display </span><span class="s2">= </span><span class="s1">visible </span><span class="s2">? </span><span class="s4">&quot;table&quot; </span><span class="s2">: </span><span class="s4">&quot;none&quot;</span><span class="s2">;</span>
    <span class="s2">}</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">getRules</span><span class="s2">(</span><span class="s1">style</span><span class="s2">) {</span>
    <span class="s5">// With Chrome external CSS files seem to have only null roles and with</span>
    <span class="s5">// Firefox accessing rules can result to security error.</span>
    <span class="s5">// Neither of these are a problem on with generated logs.</span>
    <span class="s0">try </span><span class="s2">{</span>
        <span class="s0">return </span><span class="s1">style</span><span class="s2">.</span><span class="s1">cssRules </span><span class="s2">|| </span><span class="s1">style</span><span class="s2">.</span><span class="s1">rules</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
        <span class="s0">return null</span><span class="s2">;</span>
    <span class="s2">}</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">selectMessage</span><span class="s2">(</span><span class="s1">parentId</span><span class="s2">) {</span>
    <span class="s0">var </span><span class="s1">element </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'#' </span><span class="s2">+ </span><span class="s1">parentId</span><span class="s2">).</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.message'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">(</span><span class="s3">0</span><span class="s2">);</span>
    <span class="s1">selectText</span><span class="s2">(</span><span class="s1">element</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">selectText</span><span class="s2">(</span><span class="s1">element</span><span class="s2">) {</span>
    <span class="s5">// Based on http://stackoverflow.com/questions/985272</span>
    <span class="s0">var </span><span class="s1">range</span><span class="s2">, </span><span class="s1">selection</span><span class="s2">;</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">document</span><span class="s2">.</span><span class="s1">body</span><span class="s2">.</span><span class="s1">createTextRange</span><span class="s2">) {  </span><span class="s5">// IE 8</span>
        <span class="s1">range </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">body</span><span class="s2">.</span><span class="s1">createTextRange</span><span class="s2">();</span>
        <span class="s1">range</span><span class="s2">.</span><span class="s1">moveToElementText</span><span class="s2">(</span><span class="s1">element</span><span class="s2">);</span>
        <span class="s1">range</span><span class="s2">.</span><span class="s1">select</span><span class="s2">();</span>
    <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">window</span><span class="s2">.</span><span class="s1">getSelection</span><span class="s2">) {  </span><span class="s5">// Others</span>
        <span class="s1">selection </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">getSelection</span><span class="s2">();</span>
        <span class="s1">range </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">createRange</span><span class="s2">();</span>
        <span class="s1">range</span><span class="s2">.</span><span class="s1">selectNodeContents</span><span class="s2">(</span><span class="s1">element</span><span class="s2">);</span>
        <span class="s1">selection</span><span class="s2">.</span><span class="s1">removeAllRanges</span><span class="s2">();</span>
        <span class="s1">selection</span><span class="s2">.</span><span class="s1">addRange</span><span class="s2">(</span><span class="s1">range</span><span class="s2">);</span>
    <span class="s2">}</span>
<span class="s2">}</span>

<span class="s0">function </span><span class="s1">LogLevelController</span><span class="s2">(</span><span class="s1">minLevel</span><span class="s2">, </span><span class="s1">defaultLevel</span><span class="s2">) {</span>
    <span class="s1">minLevel </span><span class="s2">= </span><span class="s1">LEVELS</span><span class="s2">[</span><span class="s1">minLevel</span><span class="s2">];</span>
    <span class="s1">defaultLevel </span><span class="s2">= </span><span class="s1">LEVELS</span><span class="s2">[</span><span class="s1">defaultLevel</span><span class="s2">];</span>

    <span class="s0">function </span><span class="s1">showLogLevelSelector</span><span class="s2">() {</span>
        <span class="s0">return </span><span class="s1">minLevel </span><span class="s2">&lt; </span><span class="s1">LEVELS</span><span class="s2">.</span><span class="s1">INFO</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">function </span><span class="s1">defaultLogLevel</span><span class="s2">() {</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">minLevel </span><span class="s2">&gt; </span><span class="s1">defaultLevel</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">minLevel</span><span class="s2">;</span>
        <span class="s0">return </span><span class="s1">defaultLevel</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">function </span><span class="s1">showTrace</span><span class="s2">() {</span>
        <span class="s0">return </span><span class="s1">minLevel </span><span class="s2">== </span><span class="s1">LEVELS</span><span class="s2">.</span><span class="s1">TRACE</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">return </span><span class="s2">{</span>
        <span class="s1">showLogLevelSelector</span><span class="s2">: </span><span class="s1">showLogLevelSelector</span><span class="s2">,</span>
        <span class="s1">defaultLogLevel</span><span class="s2">: </span><span class="s1">defaultLogLevel</span><span class="s2">,</span>
        <span class="s1">showTrace</span><span class="s2">: </span><span class="s1">showTrace</span>
    <span class="s2">};</span>
<span class="s2">}</span>
</pre>
</body>
</html>